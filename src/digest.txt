Directory structure:
└── src/
    ├── index.html
    ├── main.server.ts
    ├── main.ts
    ├── run.bat
    ├── styles.css
    ├── app/
    │   ├── app.component.css
    │   ├── app.component.html
    │   ├── app.component.spec.ts
    │   ├── app.component.ts
    │   ├── app.config.server.ts
    │   ├── app.config.ts
    │   ├── app.routes.ts
    │   ├── index.ts
    │   ├── about-us/
    │   │   ├── about-us.component.css
    │   │   ├── about-us.component.html
    │   │   ├── about-us.component.spec.ts
    │   │   └── about-us.component.ts
    │   ├── add-property/
    │   │   ├── add-property.component.css
    │   │   ├── add-property.component.html
    │   │   ├── add-property.component.spec.ts
    │   │   └── add-property.component.ts
    │   ├── chat-bot/
    │   │   ├── chat-bot.component.css
    │   │   ├── chat-bot.component.html
    │   │   ├── chat-bot.component.spec.ts
    │   │   └── chat-bot.component.ts
    │   ├── favorites/
    │   │   ├── favorites.component.css
    │   │   ├── favorites.component.html
    │   │   ├── favorites.component.spec.ts
    │   │   └── favorites.component.ts
    │   ├── filters/
    │   │   ├── filters.component.css
    │   │   ├── filters.component.html
    │   │   ├── filters.component.spec.ts
    │   │   └── filters.component.ts
    │   ├── forget-pass/
    │   │   ├── forget-pass.component.css
    │   │   ├── forget-pass.component.html
    │   │   ├── forget-pass.component.spec.ts
    │   │   └── forget-pass.component.ts
    │   ├── guards/
    │   │   └── auth.guard.ts
    │   ├── home/
    │   │   ├── home.component.css
    │   │   ├── home.component.html
    │   │   ├── home.component.spec.ts
    │   │   └── home.component.ts
    │   ├── interceptors/
    │   │   └── auth.interceptor.ts
    │   ├── log-in/
    │   │   ├── log-in.component.css
    │   │   ├── log-in.component.html
    │   │   ├── log-in.component.spec.ts
    │   │   └── log-in.component.ts
    │   ├── models/
    │   │   ├── property.model.ts
    │   │   └── user.model.ts
    │   ├── my-properties/
    │   │   ├── my-properties.component.css
    │   │   ├── my-properties.component.html
    │   │   ├── my-properties.component.spec.ts
    │   │   └── my-properties.component.ts
    │   ├── otp-verification/
    │   │   ├── otp-verification.component.css
    │   │   ├── otp-verification.component.html
    │   │   ├── otp-verification.component.spec.ts
    │   │   └── otp-verification.component.ts
    │   ├── payment/
    │   │   ├── payment.component.css
    │   │   ├── payment.component.html
    │   │   ├── payment.component.spec.ts
    │   │   └── payment.component.ts
    │   ├── profile/
    │   │   ├── profile.component.css
    │   │   ├── profile.component.html
    │   │   ├── profile.component.spec.ts
    │   │   └── profile.component.ts
    │   ├── property-detail/
    │   │   ├── property-detail.component.css
    │   │   ├── property-detail.component.html
    │   │   ├── property-detail.component.spec.ts
    │   │   └── property-detail.component.ts
    │   ├── reset-password/
    │   │   ├── reset-password.component.css
    │   │   ├── reset-password.component.html
    │   │   ├── reset-password.component.spec.ts
    │   │   └── reset-password.component.ts
    │   ├── services/
    │   │   ├── amenities.service.ts
    │   │   ├── auth.service.ts
    │   │   ├── payment.service.ts
    │   │   └── property.service.ts
    │   └── sign-up/
    │       ├── sign-up.component.css
    │       ├── sign-up.component.html
    │       ├── sign-up.component.spec.ts
    │       └── sign-up.component.ts
    └── assets/
        ├── .gitkeep
        └── images/
            └── background.webp

================================================
File: index.html
================================================
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Xv3</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<script src="https://js.stripe.com/v3/"></script>
<!-- AOS Animate on Scroll Library -->
<link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">


</head>
<body>
  <app-root></app-root>









  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
  AOS.init();
</script>

</body>
</html>


================================================
File: main.server.ts
================================================
import { bootstrapApplication } from '@angular/platform-browser';
import { AppComponent } from './app/app.component';
import { config } from './app/app.config.server';

const bootstrap = () => bootstrapApplication(AppComponent, config);

export default bootstrap;



================================================
File: main.ts
================================================
import { bootstrapApplication } from '@angular/platform-browser';
import { appConfig } from './app/app.config';
import { AppComponent } from './app/app.component';

bootstrapApplication(AppComponent, appConfig)
  .catch((err) => console.error(err));


================================================
File: run.bat
================================================
@echo off
REM Batch script to run back.py from the current directory
gitingest . --exclude-pattern "digest.txt"

IF EXIST back.py (
    python back.py
) ELSE (
    echo Error: back.py not found in the current directory.
)



================================================
File: styles.css
================================================
/* أضف هذا في ملف styles.css العام للتطبيق */

/* تحديد اللون الأساسي للتطبيق */
:root {
    --primary-color: #08227B;
  }
  
  /* أنماط الأزرار الأساسية */
  .btn-primary {
    background-color: #08227B !important;
    border-color: #08227B !important;
    color: white !important;
  }
  
  .btn-outline-primary {
    color: #08227B !important;
    border-color: #08227B !important;
  }
  
  .btn-outline-primary:hover {
    background-color: #08227B !important;
    border-color: #08227B !important;
    color: white !important;
  }
  
  /* تنسيقات SweetAlert2 */
  .swal2-icon.swal2-info {
    color: #08227B !important;
    border-color: #08227B !important;
  }
  
  .swal2-styled.swal2-confirm {
    background-color: #08227B !important;
  }


================================================
File: app/app.component.css
================================================
/* General styles for the signup page */
.container {
    display: flex;
    height: 100vh;
    width: 100%;
    font-family: Arial, sans-serif;
  }
  
  /* Left side - Form inputs */
  .form-side {
    width: 50%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 40px;
    overflow-y: auto;
  }
  
  .form-container {
    width: 100%;
    max-width: 450px;
  }
  
  .title {
    font-size: 2.5rem;
    color: #0c2b7a;
    margin-bottom: 30px;
    font-weight: bold;
  }
  
  /* Form row for split inputs */
  .form-row {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
  }
  
  .form-group {
    margin-bottom: 20px;
  }
  
  .half {
    width: 50%;
  }
  
  label {
    display: block;
    font-size: 1rem;
    color: #0c2b7a;
    margin-bottom: 8px;
  }
  
  .form-control {
    width: 100%;
    padding: 15px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    font-size: 16px;
    outline: none;
    transition: border-color 0.3s;
  }
  
  .form-control:focus {
    border-color: #0c2b7a;
  }
  
  .form-control.invalid {
    border-color: #ff3860;
  }
  
  .error-message {
    color: #ff3860;
    font-size: 14px;
    margin-top: 5px;
  }
  
  /* Phone input with country code */
  .phone-input {
    display: flex;
    gap: 10px;
  }
  
  .country-code {
    width: 80px;
  }
  
  .code-select {
    width: 100%;
    padding: 15px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    font-size: 16px;
    outline: none;
    background-color: white;
  }
  
  .phone {
    flex: 1;
  }
  
  /* Dropdown styles */
  .dropdown {
    position: relative;
  }
  
  .dropdown select {
    appearance: none;
    width: 100%;
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="6" viewBox="0 0 12 6"><path d="M0 0l6 6 6-6z" fill="%23666"/></svg>');
    background-repeat: no-repeat;
    background-position: right 15px center;
    padding-right: 30px;
  }
  
  /* Date input styles */
  .date-input {
    position: relative;
  }
  
  .calendar-icon {
    position: absolute;
    top: 50%;
    right: 15px;
    transform: translateY(-50%);
    color: #666;
    pointer-events: none;
  }
  
  /* Password input styles */
  .password-input {
    position: relative;
  }
  
  .toggle-password {
    position: absolute;
    top: 50%;
    right: 15px;
    transform: translateY(-50%);
    color: #666;
    cursor: pointer;
  }
  
  /* Terms checkbox styles */
  .terms-group {
    margin-bottom: 30px;
  }
  
  .checkbox-container {
    display: flex;
    align-items: center;
  }
  
  .checkbox {
    margin-right: 10px;
    width: 20px;
    height: 20px;
    accent-color: #0c2b7a;
  }
  
  .terms-label {
    font-size: 14px;
    color: #333;
  }
  
  .terms-link {
    color: #0c2b7a;
    text-decoration: none;
    cursor: pointer;
  }
  
  /* Signup button */
  .signup-btn {
    width: 100%;
    padding: 15px;
    background-color: #0c2b7a;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s;
    margin-bottom: 20px;
  }
  
  .signup-btn:hover {
    background-color: #091e55;
  }
  
  /* Google signup */
  .google-signup {
    margin-bottom: 20px;
  }
  
  .google-btn {
    width: 100%;
    padding: 15px;
    background-color: white;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    transition: background-color 0.3s;
  }
  
  .google-btn:hover {
    background-color: #f5f5f5;
  }
  
  .google-btn img {
    width: 20px;
    height: 20px;
  }
  
  /* Login link */
  .login-link {
    text-align: center;
    font-size: 16px;
  }
  
  .login-link span {
    color: #666;
  }
  
  .login-link a {
    color: #0c2b7a;
    font-weight: bold;
    text-decoration: none;
    margin-left: 5px;
  }
  
  /* Right side - Blue background with image */
  .image-side {
    width: 50%;
    background-color: #0c2b7a; /* Deep blue color from the design */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
  }
  
  .close-button {
    position: absolute;
    top: 20px;
    right: 20px;
  }
  
  .close-btn {
    background: transparent;
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
  }
  
  .image-container {
    width: 70%;
    max-width: 400px;
    display: flex;
    justify-content: center;
  }
  
  .image-container img {
    max-width: 100%;
    height: auto;
  }
  
  /* Responsive design */
  @media (max-width: 768px) {
    .container {
      flex-direction: column-reverse;
    }
    
    .image-side {
      width: 100%;
      height: 30vh;
    }
    
    .form-side {
      width: 100%;
      height: 70vh;
      padding: 20px;
    }
    
    .form-row {
      flex-direction: column;
      gap: 0;
    }
    
    .half {
      width: 100%;
    }
  }


================================================
File: app/app.component.html
================================================
<!-- app.compnent.html-->
<router-outlet></router-outlet><!-- Check if your app.component.html has this router-outlet tag -->



================================================
File: app/app.component.spec.ts
================================================
//app.component.spec.ts
import { TestBed } from '@angular/core/testing';
import { AppComponent } from './app.component';

describe('AppComponent', () => {
  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [AppComponent],
    }).compileComponents();
  });

  it('should create the app', () => {
    const fixture = TestBed.createComponent(AppComponent);
    const app = fixture.componentInstance;
    expect(app).toBeTruthy();
  });

  it(`should have the 'xv3' title`, () => {
    const fixture = TestBed.createComponent(AppComponent);
    const app = fixture.componentInstance;
    expect(app.title).toEqual('xv3');
  });

  it('should render title', () => {
    const fixture = TestBed.createComponent(AppComponent);
    fixture.detectChanges();
    const compiled = fixture.nativeElement as HTMLElement;
    expect(compiled.querySelector('h1')?.textContent).toContain('Hello, xv3');
  });
});



================================================
File: app/app.component.ts
================================================
//app.component.ts
import { Component } from '@angular/core';
import { RouterOutlet } from '@angular/router';

@Component({
  selector: 'app-root',
  standalone: true,
  imports: [RouterOutlet],
  template: `<router-outlet></router-outlet>`,
  styleUrls: ['./app.component.css']
})
export class AppComponent {
  title = 'Dizon';
}


================================================
File: app/app.config.server.ts
================================================
//app.config.server.ts
import { mergeApplicationConfig, ApplicationConfig } from '@angular/core';
import { provideServerRendering } from '@angular/platform-server';
import { appConfig } from './app.config';

const serverConfig: ApplicationConfig = {
  providers: [
    provideServerRendering()
  ]
};

export const config = mergeApplicationConfig(appConfig, serverConfig);



================================================
File: app/app.config.ts
================================================
import { ApplicationConfig } from '@angular/core';
import { provideRouter } from '@angular/router';
import { routes } from './app.routes';
import { provideHttpClient, withInterceptors, withFetch } from '@angular/common/http';
import { authInterceptor } from './interceptors/auth.interceptor';
import { CookieService } from 'ngx-cookie-service';
import { AuthService } from './services/auth.service';
import { PropertyService } from './services/property.service';
import { AmenitiesService } from './services/amenities.service';
import { PaymentService } from './services/payment.service';

export const appConfig: ApplicationConfig = {
  providers: [
    provideRouter(routes),
    provideHttpClient(
      withFetch(),
      withInterceptors([authInterceptor])
    ),
    CookieService,
    AuthService,
    PropertyService,
    AmenitiesService,
    PaymentService
  ]
};



================================================
File: app/app.routes.ts
================================================
import { Routes } from '@angular/router';
import { 
  LogInComponent,
  ForgetPassComponent,
  OtpVerificationComponent,
  ResetPasswordComponent,
  HomeComponent
} from './index';
import { SignUpComponent } from './sign-up/sign-up.component';
import { AddPropertyComponent } from './add-property/add-property.component';
import { FavoritesComponent } from './favorites/favorites.component';
import { ChatBotComponent } from './chat-bot/chat-bot.component';
import { PropertyDetailComponent } from './property-detail/property-detail.component';
import { ProfileComponent } from './profile/profile.component';
import { authGuard } from './guards/auth.guard';
import { AboutUsComponent } from './about-us/about-us.component';
import { MyPropertiesComponent } from './my-properties/my-properties.component'; // إضافة هذا

export const routes: Routes = [
  // Default route redirects to login
  { path: '', redirectTo: '/log-in', pathMatch: 'full' },
  
  // Authentication routes
  { path: 'log-in', component: LogInComponent },
  { path: 'sign-up', component: SignUpComponent },
  { path: 'forget-pass', component: ForgetPassComponent },
  { path: 'otp-verification', component: OtpVerificationComponent },
  { path: 'reset-password', component: ResetPasswordComponent },
  
  // Protected routes
  { path: 'home', component: HomeComponent, canActivate: [authGuard] },
  { path: 'property/:id', component: PropertyDetailComponent, canActivate: [authGuard] },
  { path: 'add-property', component: AddPropertyComponent, canActivate: [authGuard] },
  { path: 'favorites', component: FavoritesComponent, canActivate: [authGuard] },
  { path: 'chat-bot', component: ChatBotComponent, canActivate: [authGuard] },
  { path: 'profile', component: ProfileComponent, canActivate: [authGuard] },
  { path: 'about-us', component: AboutUsComponent , canActivate: [authGuard] },
  {path:'my-properties',component:MyPropertiesComponent , canActivate: [authGuard]},
  // Wildcard route
  { path: '**', redirectTo: '/log-in' }
];


================================================
File: app/index.ts
================================================
// app/index.ts
// Export all components for easy imports
export * from './log-in/log-in.component';
export * from './sign-up/sign-up.component';
export * from './forget-pass/forget-pass.component';
export * from './otp-verification/otp-verification.component';
export * from './reset-password/reset-password.component';
export * from './home/home.component';
export * from './property-detail/property-detail.component';


================================================
File: app/about-us/about-us.component.css
================================================



================================================
File: app/about-us/about-us.component.html
================================================
<style>
  body {
    font-family: 'Tajawal', sans-serif; /* Ø£Ùˆ 'Poppins' Ù„Ùˆ ØªØ­Ø¨ */
  }

  .about-section {
    background: linear-gradient(to right, #243B55, #141E30); /* ØªØ¯Ø±Ø¬ Ø£Ù†Ø¹Ù… */
    color: white;
    padding: 60px 20px;
  }

  .about-title {
    font-size: 3.5rem;
    font-weight: bold;
    margin-bottom: 20px;
    text-align: center;
    font-family: 'Tajawal', sans-serif;
  }

  .about-subtitle {
    font-size: 2.1rem;
    text-align: center;
    margin-bottom: 40px;
    opacity: 0.9;
  }

  .custom-list li {
    background: transparent;
    border: none;
    color: white;
    font-weight: 500;
    padding-left: 0;
  }

  .team-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border-radius: 15px;
    overflow: hidden;
    border: none;
  }

  .team-card:hover {
    transform: scale(1.05);
    box-shadow: 0 0 20px rgba(255, 255, 255, 0.15);
  }

  .team-card .card-body {
    background-color: white;
    color: #08227B;
    font-weight: 600;
    font-family: 'Tajawal', sans-serif;
  }

  .list-group-numbered > .list-group-item::before {
    color: #FFD700;
    font-weight: bold;
  }
</style>


<div class="about-section">
  <div class="container">
    <h1 class="about-title">About Dizon</h1>
    <p class="about-subtitle">
      Dizon is a digital property management designed by 8 Computer Science students to transform the real estate experience in Egypt.
    </p>

    <!-- Project Overview -->
    <div class="mb-5">
      <p class="lead">
        Dizon offers an AI-powered property management system with voice interaction, personalized search, OCR-powered document handling, secure payments, and smart dashboards.
      </p>
      <p class="lead">
        It brings together listings, automation, and future scalabilityâ€”making it the fast, smart, and reliable solution for modern real estate.
      </p>
    </div>

    <!-- Beneficiaries -->
    <div class="mb-4">
      <h3 class="fw-bold">Beneficiaries</h3>
      <ul class="list-group custom-list">
        <li class="list-group-item">â€¢ Property Owners & Investors</li>
        <li class="list-group-item">â€¢ Home Buyers & Renters</li>
        <li class="list-group-item">â€¢ Real Estate Agents & Brokers</li>
        <li class="list-group-item">â€¢ General Users and Professionals</li>
      </ul>
    </div>

    <!-- Objectives -->
    <div class="mb-5">
      <h3 class="fw-bold">Objectives</h3>
      <ul class="list-group list-group-numbered custom-list">
        <li class="list-group-item">Redefine Real Estate Transactions</li>
        <li class="list-group-item">Integrate AI, Voice, and Automation</li>
        <li class="list-group-item">Dual Search: Filters + Chatbot</li>
        <li class="list-group-item">Smart Listings & Voice Chatbot</li>
        <li class="list-group-item">Personalized Recommendations</li>
        <li class="list-group-item">Responsive Cross-Device Interface</li>
        <li class="list-group-item">Sponsored Ads & Secure Payments</li>
        <li class="list-group-item">OCR Image-Based Search</li>
        <li class="list-group-item">Robust Backend & AI Integration</li>
        <li class="list-group-item">Quality Assurance & Testing</li>
      </ul>
    </div>

    <!-- Meet the Team -->
    <div>
      <h3 class="text-center fw-bold mb-4">Meet the Team</h3>
      <div class="row g-4 justify-content-center">
        <!-- Each team member card -->
        <div class="col-6 col-md-3 col-lg-3">
          <div class="card team-card text-center h-100">
            <img src="assets/images/profile.jpeg" class="card-img-top" alt="Team Member">
            <div class="card-body">Ibrahim Mohamed El-Toukhy</div>
          </div>
        </div>
        <div class="col-6 col-md-3 col-lg-3">
          <div class="card team-card text-center h-100">
            <img src="assets/images/profile.jpeg" class="card-img-top" alt="Team Member">
            <div class="card-body">Habiba Mostafa Abdel-Zaher</div>
          </div>
        </div>
        <div class="col-6 col-md-3 col-lg-3">
          <div class="card team-card text-center h-100">
            <img src="assets/images/profile.jpeg" class="card-img-top" alt="Team Member">
            <div class="card-body">Moamen Youssef Ebrahim</div>
          </div>
        </div>
        <div class="col-6 col-md-3 col-lg-3">
          <div class="card team-card text-center h-100">
            <img src="assets/images/profile.jpeg" class="card-img-top" alt="Team Member">
            <div class="card-body">Ibrahim Mohamed Ahmed</div>
          </div>
        </div>
        <div class="col-6 col-md-3 col-lg-3">
          <div class="card team-card text-center h-100">
            <img src="assets/images/profile.jpeg" class="card-img-top" alt="Team Member">
            <div class="card-body">Abdelrahman Ayman Sayed</div>
          </div>
        </div>
        <div class="col-6 col-md-3 col-lg-3">
          <div class="card team-card text-center h-100">
            <img src="assets/images/profile.jpeg" class="card-img-top" alt="Team Member">
            <div class="card-body">Ahmed Meselhy</div>
          </div>
        </div>
        <div class="col-6 col-md-3 col-lg-3">
          <div class="card team-card text-center h-100">
            <img src="assets/images/profile.jpeg" class="card-img-top" alt="Team Member">
            <div class="card-body">Ahmed Wagdy</div>
          </div>
        </div>
        <div class="col-6 col-md-3 col-lg-3">
          <div class="card team-card text-center h-100">
            <img src="assets/images/profile.jpeg" class="card-img-top" alt="Team Member">
            <div class="card-body">Abouzaid</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



================================================
File: app/about-us/about-us.component.spec.ts
================================================
import { ComponentFixture, TestBed } from '@angular/core/testing';

import { AboutUsComponent } from './about-us.component';

describe('AboutUsComponent', () => {
  let component: AboutUsComponent;
  let fixture: ComponentFixture<AboutUsComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [AboutUsComponent]
    })
    .compileComponents();
    
    fixture = TestBed.createComponent(AboutUsComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});



================================================
File: app/about-us/about-us.component.ts
================================================
import { Component } from '@angular/core';

@Component({
  selector: 'app-about-us',
  standalone: true,
  imports: [],
  templateUrl: './about-us.component.html',
  styleUrl: './about-us.component.css'
})
export class AboutUsComponent {

}



================================================
File: app/add-property/add-property.component.css
================================================
.payment-notice {
  background: #f8f9fa;
  border: 1px solid #dee2e6;
  border-radius: 8px;
  padding: 0;
}

.payment-info-card {
  padding: 20px;
  background: white;
  border: 2px solid #08227B;
  border-radius: 8px;
  position: relative;
}

.payment-info-card::before {
  content: '';
  position: absolute;
  top: -1px;
  left: -1px;
  right: -1px;
  bottom: -1px;
  background: linear-gradient(45deg, #08227B, #061a5f);
  border-radius: 8px;
  z-index: -1;
}

.payment-icon {
  width: 60px;
  height: 60px;
  background: linear-gradient(135deg, #08227B, #061a5f);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 20px;
  flex-shrink: 0;
}

.payment-icon i {
  font-size: 24px;
  color: white;
}

.payment-content h5 {
  color: #08227B;
  margin-bottom: 8px;
  font-weight: 600;
}

.payment-content p {
  color: #333;
  margin-bottom: 5px;
}

.modal {
  background: rgba(0, 0, 0, 0.5);
}

.modal.show {
  display: block !important;
}

.modal-backdrop {
  background: rgba(0, 0, 0, 0.5);
}

.modal-backdrop.show {
  opacity: 1;
}

.image-preview-card {
  position: relative;
  border: 2px solid #e9ecef;
  border-radius: 8px;
  overflow: hidden;
  transition: all 0.3s ease;
}

.image-preview-card:hover {
  border-color: #08227B;
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(8, 34, 123, 0.2);
}

.image-preview-card img {
  width: 100%;
  height: 150px;
  object-fit: cover;
}

.remove-btn {
  position: absolute;
  top: 5px;
  right: 5px;
  width: 25px;
  height: 25px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.image-preview-card:hover .remove-btn {
  opacity: 1;
}

.form-section {
  background: white;
  border: 1px solid #e9ecef;
  border-radius: 10px;
  padding: 25px;
  margin-bottom: 25px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

.section-title {
  color: #08227B;
  font-weight: 600;
  margin-bottom: 20px;
  padding-bottom: 10px;
  border-bottom: 2px solid #f8f9fa;
  display: flex;
  align-items: center;
  gap: 10px;
}

.section-title::before {
  content: '';
  width: 4px;
  height: 25px;
  background: linear-gradient(135deg, #08227B, #061a5f);
  border-radius: 2px;
}

.amenities-group {
  margin-bottom: 25px;
  padding: 20px;
  background: #f8f9fa;
  border-radius: 8px;
  border: 1px solid #e9ecef;
}

.amenities-subtitle {
  color: #495057;
  font-weight: 600;
  margin-bottom: 15px;
  font-size: 16px;
}

.form-check-input:checked {
  background-color: #08227B;
  border-color: #08227B;
}

.form-check-input:focus {
  border-color: #08227B;
  outline: 0;
  box-shadow: 0 0 0 0.25rem rgba(8, 34, 123, 0.25);
}

.btn-primary {
  background: linear-gradient(135deg, #08227B, #061a5f);
  border: none;
  font-weight: 600;
  padding: 12px 30px;
  border-radius: 8px;
  transition: all 0.3s ease;
}

.btn-primary:hover {
  background: linear-gradient(135deg, #061a5f, #08227B);
  transform: translateY(-1px);
  box-shadow: 0 4px 15px rgba(8, 34, 123, 0.3);
}

.btn-secondary {
  background: #6c757d;
  border: none;
  font-weight: 600;
  padding: 12px 30px;
  border-radius: 8px;
  transition: all 0.3s ease;
}

.btn-secondary:hover {
  background: #5a6268;
  transform: translateY(-1px);
}

/* ✅ أنماط جديدة للحقول المضافة */

/* Location URL Input with Auto Generate Button */
.location-url-wrapper {
  position: relative;
}

.btn-outline-primary {
  color: #08227B;
  border-color: #08227B;
  background: transparent;
  transition: all 0.3s ease;
}

.btn-outline-primary:hover {
  background-color: #08227B;
  border-color: #08227B;
  color: white;
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(8, 34, 123, 0.2);
}

.btn-outline-primary:focus {
  box-shadow: 0 0 0 0.25rem rgba(8, 34, 123, 0.25);
}

/* Auto Generate Button Styling */
.btn-sm {
  padding: 0.25rem 0.75rem;
  font-size: 0.875rem;
  border-radius: 0.375rem;
  font-weight: 500;
}

/* Form Text Styling */
.form-text {
  margin-top: 0.375rem;
  font-size: 0.875rem;
  color: #6c757d;
}

.form-text .text-muted {
  color: #6c757d !important;
}

.form-text i {
  margin-right: 0.25rem;
}

/* Enhanced Form Control Styling */
.form-control:focus {
  border-color: #08227B;
  box-shadow: 0 0 0 0.25rem rgba(8, 34, 123, 0.25);
}

.form-select:focus {
  border-color: #08227B;
  box-shadow: 0 0 0 0.25rem rgba(8, 34, 123, 0.25);
}

/* Invalid Input Styling */
.form-control.is-invalid {
  border-color: #dc3545;
  box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.25);
}

.form-select.is-invalid {
  border-color: #dc3545;
  box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.25);
}

.invalid-feedback {
  display: block;
  width: 100%;
  margin-top: 0.25rem;
  font-size: 0.875rem;
  color: #dc3545;
}

/* Page Title Styling */
.page-title {
  color: #08227B;
  font-weight: bold;
  font-size: 2rem;
  margin-bottom: 0;
}

/* Loading States */
.spinner-border-sm {
  width: 1rem;
  height: 1rem;
}

.spinner-border {
  width: 2rem;
  height: 2rem;
  border-width: 0.25em;
}

/* Alert Styling */
.alert-success {
  background-color: #d1edff;
  border-color: #08227B;
  color: #08227B;
}

.alert-success .bi {
  color: #08227B;
}

/* Enhanced Button Styling */
.btn:disabled {
  opacity: 0.65;
  cursor: not-allowed;
}

.btn-lg {
  padding: 0.75rem 1.5rem;
  font-size: 1.125rem;
  border-radius: 0.5rem;
}

/* Location Section Specific Styling */
.location-section {
  background: #f8f9fa;
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 20px;
}

/* Auto Generate Button Icon */
.bi-geo-alt {
  font-size: 1rem;
  margin-right: 0.25rem;
}

/* Listing Type Dropdown */
.listing-type-wrapper {
  position: relative;
}

/* Enhanced Tooltips */
[title] {
  cursor: help;
}

/* Success/Error States for URL field */
.url-valid {
  border-left: 4px solid #28a745;
  padding-left: 12px;
}

.url-invalid {
  border-left: 4px solid #dc3545;
  padding-left: 12px;
}

/* Loading Overlay */
.loading-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(255, 255, 255, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  border-radius: 8px;
}

/* Form Validation Enhancement */
.was-validated .form-control:valid {
  border-color: #28a745;
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%2328a745' d='m2.3 6.73.94-.94 2.94 2.94L6.5 8.5z'/%3e%3c/svg%3e");
}

/* Responsive Design */
@media (max-width: 768px) {
  .form-section {
    padding: 20px;
    margin-bottom: 20px;
  }

  .payment-info-card {
    padding: 15px;
  }

  .payment-icon {
    width: 50px;
    height: 50px;
    margin-right: 15px;
  }

  .payment-icon i {
    font-size: 20px;
  }

  .amenities-group {
    padding: 15px;
  }

  .modal-dialog {
    margin: 10px;
  }

  .image-preview-card img {
    height: 120px;
  }

  .page-title {
    font-size: 1.5rem;
  }

  .btn-lg {
    padding: 0.5rem 1rem;
    font-size: 1rem;
  }

  /* Mobile-friendly Auto Generate Button */
  .btn-sm {
    padding: 0.375rem 0.5rem;
    font-size: 0.75rem;
  }

  .form-text {
    font-size: 0.75rem;
  }
}

@media (max-width: 576px) {
  .payment-info-card {
    flex-direction: column;
    text-align: center;
  }

  .payment-icon {
    margin-right: 0;
    margin-bottom: 15px;
    align-self: center;
  }

  .btn-outline-primary {
    width: 100%;
    margin-top: 10px;
    margin-left: 0 !important;
  }

  .d-flex.justify-content-between {
    flex-direction: column;
    gap: 15px;
  }

  .section-title {
    font-size: 1.25rem;
  }
}

/* Animation for Auto Generate Button */
@keyframes generate {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

.btn-outline-primary:active {
  animation: generate 0.2s ease-in-out;
}

/* Custom styling for URL input when auto-generated */
.auto-generated-url {
  background-color: #e8f5e8;
  border-color: #28a745;
  transition: background-color 0.3s ease;
}

.auto-generated-url:focus {
  background-color: white;
}


================================================
File: app/add-property/add-property.component.html
================================================
<!-- Add Property Component HTML with Payment Integration -->
<div class="container py-4">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="page-title">Add New Property</h1>
    <button class="btn btn-outline-secondary" (click)="goBack()">
      <i class="bi bi-arrow-left"></i> Back
    </button>
  </div>

  <!-- Payment Status Alert -->
  <div *ngIf="paymentCompleted" class="alert alert-success d-flex align-items-center mb-4">
    <i class="bi bi-check-circle-fill me-2"></i>
    <div>
      <strong>Payment Successful!</strong> Your payment has been processed. Now completing property listing...
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3">Loading amenities...</p>
  </div>

  <!-- Main Form -->
  <div *ngIf="!isLoading" class="row">
    <div class="col-12">
      <form [formGroup]="propertyForm" (ngSubmit)="onSubmit()" class="property-form">
        
        <!-- Basic Information Section -->
        <div class="form-section">
          <h3 class="section-title">Basic Information</h3>
          
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="title" class="form-label">Property Title *</label>
                <input 
                  type="text" 
                  id="title"
                  formControlName="title" 
                  class="form-control"
                  [class.is-invalid]="submitted && f['title'].errors"
                  placeholder="e.g., Modern 3BR Apartment in Cairo"
                >
                <div *ngIf="submitted && f['title'].errors" class="invalid-feedback">
                  <div *ngIf="f['title'].errors['required']">Property title is required</div>
                  <div *ngIf="f['title'].errors['minlength']">Title must be at least 3 characters</div>
                </div>
              </div>
            </div>
            
            <div class="col-md-3">
              <div class="mb-3">
                <label for="price" class="form-label">Price (EGP) *</label>
                <input 
                  type="number" 
                  id="price"
                  formControlName="price" 
                  class="form-control"
                  [class.is-invalid]="submitted && f['price'].errors"
                  placeholder="e.g., 250000"
                >
                <div *ngIf="submitted && f['price'].errors" class="invalid-feedback">
                  <div *ngIf="f['price'].errors['required']">Price is required</div>
                  <div *ngIf="f['price'].errors['min']">Price must be greater than 0</div>
                </div>
              </div>
            </div>

            <div class="col-md-3">
              <div class="mb-3">
                <label for="listingType" class="form-label">Listing Type *</label>
                <select 
                  id="listingType"
                  formControlName="listingType" 
                  class="form-select"
                  [class.is-invalid]="submitted && f['listingType'].errors"
                >
                  <option value="">Select listing type</option>
                  <option *ngFor="let type of listingTypes" [value]="type">{{ type }}</option>
                </select>
                <div *ngIf="submitted && f['listingType'].errors" class="invalid-feedback">
                  Listing type is required
                </div>
              </div>
            </div>
          </div>

          <div class="mb-3">
            <label for="description" class="form-label">Description *</label>
            <textarea 
              id="description"
              formControlName="description" 
              class="form-control"
              rows="4"
              [class.is-invalid]="submitted && f['description'].errors"
              placeholder="Describe your property, its features, and what makes it special..."
            ></textarea>
            <div *ngIf="submitted && f['description'].errors" class="invalid-feedback">
              <div *ngIf="f['description'].errors['required']">Description is required</div>
              <div *ngIf="f['description'].errors['minlength']">Description must be at least 10 characters</div>
            </div>
          </div>
        </div>

        <!-- Property Details Section -->
        <div class="form-section">
          <h3 class="section-title">Property Details</h3>
          
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="propertyType" class="form-label">Property Type *</label>
                <select 
                  id="propertyType"
                  formControlName="propertyType" 
                  class="form-select"
                  [class.is-invalid]="submitted && f['propertyType'].errors"
                >
                  <option value="">Select property type</option>
                  <option *ngFor="let type of propertyTypes" [value]="type">{{ type }}</option>
                </select>
                <div *ngIf="submitted && f['propertyType'].errors" class="invalid-feedback">
                  Property type is required
                </div>
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="mb-3">
                <label for="size" class="form-label">Size (mÂ²) *</label>
                <input 
                  type="number" 
                  id="size"
                  formControlName="size" 
                  class="form-control"
                  [class.is-invalid]="submitted && f['size'].errors"
                  placeholder="e.g., 120"
                >
                <div *ngIf="submitted && f['size'].errors" class="invalid-feedback">
                  <div *ngIf="f['size'].errors['required']">Size is required</div>
                  <div *ngIf="f['size'].errors['min']">Size must be greater than 0</div>
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="bedrooms" class="form-label">Bedrooms *</label>
                <input 
                  type="number" 
                  id="bedrooms"
                  formControlName="bedrooms" 
                  class="form-control"
                  [class.is-invalid]="submitted && f['bedrooms'].errors"
                  placeholder="e.g., 3"
                  min="0"
                >
                <div *ngIf="submitted && f['bedrooms'].errors" class="invalid-feedback">
                  <div *ngIf="f['bedrooms'].errors['required']">Number of bedrooms is required</div>
                  <div *ngIf="f['bedrooms'].errors['min']">Bedrooms cannot be negative</div>
                </div>
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="mb-3">
                <label for="bathrooms" class="form-label">Bathrooms *</label>
                <input 
                  type="number" 
                  id="bathrooms"
                  formControlName="bathrooms" 
                  class="form-control"
                  [class.is-invalid]="submitted && f['bathrooms'].errors"
                  placeholder="e.g., 2"
                  min="1"
                >
                <div *ngIf="submitted && f['bathrooms'].errors" class="invalid-feedback">
                  <div *ngIf="f['bathrooms'].errors['required']">Number of bathrooms is required</div>
                  <div *ngIf="f['bathrooms'].errors['min']">At least 1 bathroom is required</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Location Section -->
        <div class="form-section">
          <h3 class="section-title">Location</h3>
          
          <div class="row">
            <div class="col-md-4">
              <div class="mb-3">
                <label for="governate" class="form-label">Governorate *</label>
                <select 
                  id="governate"
                  formControlName="governate" 
                  class="form-select"
                  [class.is-invalid]="submitted && f['governate'].errors"
                  (change)="generateLocationUrl()"
                >
                  <option value="">Select governorate</option>
                  <option *ngFor="let gov of governorates" [value]="gov">{{ gov }}</option>
                </select>
                <div *ngIf="submitted && f['governate'].errors" class="invalid-feedback">
                  Governorate is required
                </div>
              </div>
            </div>
            
            <div class="col-md-4">
              <div class="mb-3">
                <label for="city" class="form-label">City *</label>
                <select 
                  id="city"
                  formControlName="city" 
                  class="form-select"
                  [class.is-invalid]="submitted && f['city'].errors"
                  (change)="generateLocationUrl()"
                >
                  <option value="">Select city</option>
                  <option *ngFor="let city of cities" [value]="city">{{ city }}</option>
                </select>
                <div *ngIf="submitted && f['city'].errors" class="invalid-feedback">
                  City is required
                </div>
              </div>
            </div>
            
            <div class="col-md-4">
              <div class="mb-3">
                <label for="street" class="form-label">Street Address *</label>
                <input 
                  type="text" 
                  id="street"
                  formControlName="street" 
                  class="form-control"
                  [class.is-invalid]="submitted && f['street'].errors"
                  placeholder="e.g., 123 Tahrir Street"
                  (blur)="generateLocationUrl()"
                >
                <div *ngIf="submitted && f['street'].errors" class="invalid-feedback">
                  Street address is required
                </div>
              </div>
            </div>
          </div>

          <!-- Location URL Field -->
          <div class="row">
            <div class="col-12">
              <div class="mb-3">
                <label for="locationUrl" class="form-label">
                  Location URL (Google Maps) *
                  <button 
                    type="button" 
                    class="btn btn-sm btn-outline-primary ms-2"
                    (click)="generateLocationUrl()"
                    title="Auto-generate Google Maps URL"
                  >
                    <i class="bi bi-geo-alt"></i> Auto Generate
                  </button>
                </label>
                <input 
                  type="url" 
                  id="locationUrl"
                  formControlName="locationUrl" 
                  class="form-control"
                  [class.is-invalid]="submitted && f['locationUrl'].errors"
                  placeholder="https://maps.google.com/..."
                >
                <div *ngIf="submitted && f['locationUrl'].errors" class="invalid-feedback">
                  <div *ngIf="f['locationUrl'].errors['required']">Location URL is required</div>
                  <div *ngIf="f['locationUrl'].errors['pattern']">Please enter a valid URL (must start with http:// or https://)</div>
                </div>
                <div class="form-text">
                  <small class="text-muted">
                    <i class="bi bi-info-circle"></i>
                    You can paste a Google Maps link or click "Auto Generate" to create one automatically from your address.
                  </small>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Images Section -->
        <div class="form-section">
          <h3 class="section-title">Property Images</h3>
          
          <div class="mb-3">
            <label for="images" class="form-label">Upload Images (Max 10) *</label>
            <input 
              type="file" 
              id="images"
              class="form-control"
              accept="image/*"
              multiple
              (change)="onImageFilesSelected($event)"
            >
            <div class="form-text">Select multiple images to showcase your property. Supported formats: JPG, PNG, WebP</div>
          </div>

          <!-- Image Previews -->
          <div *ngIf="imagePreviews.length > 0" class="image-previews">
            <div class="row g-3">
              <div class="col-md-3" *ngFor="let preview of imagePreviews; let i = index">
                <div class="image-preview-card">
                  <img [src]="preview" class="img-fluid rounded" alt="Property image">
                  <button type="button" class="btn btn-danger btn-sm remove-btn" (click)="removeImage(i)">
                    <i class="bi bi-x"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Amenities Section -->
        <div class="form-section">
          <h3 class="section-title">Amenities & Features</h3>
          
          <!-- Internal Amenities -->
          <div class="amenities-group">
            <h5 class="amenities-subtitle">Internal Amenities</h5>
            <div class="row">
              <div class="col-md-4" *ngFor="let amenity of internalAmenities">
                <div class="form-check mb-2">
                  <input 
                    class="form-check-input" 
                    type="checkbox" 
                    [id]="'internal-' + amenity.amenityId"
                    [checked]="isAmenitySelected(amenity.amenityId, 'internal')"
                    (change)="onAmenityChange($event, amenity.amenityId, 'internal')"
                  >
                  <label class="form-check-label" [for]="'internal-' + amenity.amenityId">
                    {{ amenity.name }}
                  </label>
                </div>
              </div>
            </div>
          </div>

          <!-- External Amenities -->
          <div class="amenities-group">
            <h5 class="amenities-subtitle">External Amenities</h5>
            <div class="row">
              <div class="col-md-4" *ngFor="let amenity of externalAmenities">
                <div class="form-check mb-2">
                  <input 
                    class="form-check-input" 
                    type="checkbox" 
                    [id]="'external-' + amenity.amenityId"
                    [checked]="isAmenitySelected(amenity.amenityId, 'external')"
                    (change)="onAmenityChange($event, amenity.amenityId, 'external')"
                  >
                  <label class="form-check-label" [for]="'external-' + amenity.amenityId">
                    {{ amenity.name }}
                  </label>
                </div>
              </div>
            </div>
          </div>

          <!-- Accessibility Features -->
          <div class="amenities-group">
            <h5 class="amenities-subtitle">Accessibility Features</h5>
            <div class="row">
              <div class="col-md-4" *ngFor="let amenity of accessibilityAmenities">
                <div class="form-check mb-2">
                  <input 
                    class="form-check-input" 
                    type="checkbox" 
                    [id]="'accessibility-' + amenity.amenityId"
                    [checked]="isAmenitySelected(amenity.amenityId, 'accessibility')"
                    (change)="onAmenityChange($event, amenity.amenityId, 'accessibility')"
                  >
                  <label class="form-check-label" [for]="'accessibility-' + amenity.amenityId">
                    {{ amenity.name }}
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Payment Notice Section -->
        <div class="form-section payment-notice">
          <div class="payment-info-card">
            <div class="d-flex align-items-center">
              <div class="payment-icon">
                <i class="bi bi-credit-card"></i>
              </div>
              <div class="payment-content">
                <h5>Property Listing Fee</h5>
                <p class="mb-0">A one-time fee of <strong>${{ paymentAmount }}</strong> is required to list your property on our platform.</p>
                <small class="text-muted">Secure payment powered by Stripe</small>
              </div>
            </div>
          </div>
        </div>

        <!-- Submit Section -->
        <div class="form-section">
          <div class="d-flex justify-content-between">
            <button type="button" class="btn btn-secondary" (click)="goBack()" [disabled]="isSubmitting">
              Cancel
            </button>
            
            <button type="submit" class="btn btn-primary btn-lg" [disabled]="isSubmitting">
              <span *ngIf="!isSubmitting">
                <i class="bi bi-credit-card"></i> Proceed to Payment
              </span>
              <span *ngIf="isSubmitting">
                <span class="spinner-border spinner-border-sm me-2"></span>
                Processing...
              </span>
            </button>
          </div>
        </div>

      </form>
    </div>
  </div>
</div>

<!-- Payment Modal -->
<div class="modal" [class.show]="showPaymentModal" [style.display]="showPaymentModal ? 'block' : 'none'">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="bi bi-credit-card"></i>
          Complete Payment
        </h5>
        <button type="button" class="btn-close" (click)="onPaymentCancel()"></button>
      </div>
      <div class="modal-body p-0">
        <app-payment
          [showPayment]="showPaymentModal"
          [paymentAmount]="paymentAmount"
          (paymentSuccess)="onPaymentSuccess($event)"
          (paymentCancel)="onPaymentCancel()">
        </app-payment>
      </div>
    </div>
  </div>
</div>

<!-- Modal Backdrop -->
<div class="modal-backdrop" 
     [class.show]="showPaymentModal" 
     [style.display]="showPaymentModal ? 'block' : 'none'"
     (click)="onPaymentCancel()">
</div>


================================================
File: app/add-property/add-property.component.spec.ts
================================================
import { ComponentFixture, TestBed } from '@angular/core/testing';

import { AddPropertyComponent } from './add-property.component';

describe('AddPropertyComponent', () => {
  let component: AddPropertyComponent;
  let fixture: ComponentFixture<AddPropertyComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [AddPropertyComponent]
    })
    .compileComponents();
    
    fixture = TestBed.createComponent(AddPropertyComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});



================================================
File: app/add-property/add-property.component.ts
================================================
import { Component, OnInit, OnDestroy } from '@angular/core';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule, FormBuilder, FormGroup, Validators, FormArray } from '@angular/forms';
import { Router } from '@angular/router';
import { Subscription } from 'rxjs';
import Swal from 'sweetalert2';
import { PropertyService } from '../services/property.service';
import { AmenitiesService, Amenity, AmenityType } from '../services/amenities.service';
import { AuthService } from '../services/auth.service';
import { PaymentComponent } from '../payment/payment.component';

@Component({
  selector: 'app-add-property',
  standalone: true,
  imports: [CommonModule, ReactiveFormsModule, PaymentComponent],
  templateUrl: './add-property.component.html',
  styleUrls: ['./add-property.component.css']
})
export class AddPropertyComponent implements OnInit, OnDestroy {
  propertyForm!: FormGroup;
  submitted = false;
  isLoading = false;
  isSubmitting = false;
  
  // Payment related
  showPaymentModal = false;
  paymentAmount = 1; // $1 للاختبار
  paymentCompleted = false;
  paymentData: any = null;
  
  // Amenities data
  internalAmenities: Amenity[] = [];
  externalAmenities: Amenity[] = [];
  accessibilityAmenities: Amenity[] = [];
  
  // Image preview
  imageFiles: File[] = [];
  imagePreviews: string[] = [];
  
  // Property types
  propertyTypes = ['Apartment', 'House', 'Villa', 'Office', 'Commercial', 'Land'];
  
  // Listing types - إضافة جديدة
  listingTypes = ['For Rent', 'For Sale', 'For Investment'];
  
  // Egyptian cities
  cities = [
    'Cairo', 'Alexandria', 'Giza', 'Shubra El Kheima', 'Port Said',
    'Suez', 'Luxor', 'Mansoura', 'El Mahalla El Kubra', 'Tanta',
    'Asyut', 'Ismailia', 'Fayyum', 'Zagazig', 'Aswan',
    'Damietta', 'Damanhur', 'Minya', 'Beni Suef', 'Qena',
    'Sohag', 'Hurghada', 'Sharm El Sheikh'
  ];
  
  // Governorates
  governorates = [
    'Cairo', 'Alexandria', 'Giza', 'Qalyubia', 'Port Said',
    'Suez', 'Luxor', 'Dakahlia', 'Gharbia', 'Monufia',
    'Asyut', 'Ismailia', 'Fayyum', 'Sharqia', 'Aswan',
    'Damietta', 'Beheira', 'Minya', 'Beni Suef', 'Qena',
    'Sohag', 'Red Sea', 'South Sinai', 'North Sinai', 'Matrouh'
  ];
  
  private subscriptions: Subscription[] = [];

  constructor(
    private formBuilder: FormBuilder,
    private router: Router,
    private propertyService: PropertyService,
    private amenitiesService: AmenitiesService,
    private authService: AuthService
  ) {}

  ngOnInit(): void {
    if (!this.authService.isLoggedIn()) {
      this.router.navigate(['/log-in']);
      return;
    }

    this.initializeForm();
    this.loadAmenities();
  }

  ngOnDestroy(): void {
    this.subscriptions.forEach(sub => sub.unsubscribe());
  }

  initializeForm(): void {
    this.propertyForm = this.formBuilder.group({
      title: ['', [Validators.required, Validators.minLength(3)]],
      description: ['', [Validators.required, Validators.minLength(10)]],
      price: ['', [Validators.required, Validators.min(1)]],
      propertyType: ['', Validators.required],
      size: ['', [Validators.required, Validators.min(1)]],
      bedrooms: ['', [Validators.required, Validators.min(0)]],
      bathrooms: ['', [Validators.required, Validators.min(1)]],
      street: ['', Validators.required],
      city: ['', Validators.required],
      governate: ['', Validators.required],
      // ✅ إضافة الحقول المطلوبة
      locationUrl: ['', [Validators.required, Validators.pattern('https?://.+')]],
      listingType: ['', Validators.required],
      internalAmenitiesIds: this.formBuilder.array([]),
      externalAmenitiesIds: this.formBuilder.array([]),
      accessibilityAmenitiesIds: this.formBuilder.array([])
    });
  }

  loadAmenities(): void {
    this.isLoading = true;
    
    const internalSub = this.amenitiesService.getInternalAmenities().subscribe({
      next: (amenities) => {
        this.internalAmenities = amenities.filter(a => a.name !== 'string');
        console.log('✅ Internal amenities loaded:', this.internalAmenities.length);
      },
      error: (error) => {
        console.error('❌ Error loading internal amenities:', error);
      }
    });
    
    const externalSub = this.amenitiesService.getExternalAmenities().subscribe({
      next: (amenities) => {
        this.externalAmenities = amenities.filter(a => a.name !== 'string');
        console.log('✅ External amenities loaded:', this.externalAmenities.length);
      },
      error: (error) => {
        console.error('❌ Error loading external amenities:', error);
      }
    });
    
    const accessibilitySub = this.amenitiesService.getAccessibilityAmenities().subscribe({
      next: (amenities) => {
        this.accessibilityAmenities = amenities.filter(a => a.name !== 'string');
        this.isLoading = false;
        console.log('✅ Accessibility amenities loaded:', this.accessibilityAmenities.length);
      },
      error: (error) => {
        console.error('❌ Error loading accessibility amenities:', error);
        this.isLoading = false;
      }
    });
    
    this.subscriptions.push(internalSub, externalSub, accessibilitySub);
  }

  // Getter for form controls
  get f() { return this.propertyForm.controls; }
  
  // Get FormArray for amenities
  getAmenitiesFormArray(type: string): FormArray {
    return this.propertyForm.get(`${type}AmenitiesIds`) as FormArray;
  }

  // Handle amenity checkbox change
  onAmenityChange(event: any, amenityId: number, type: 'internal' | 'external' | 'accessibility'): void {
    const formArray = this.getAmenitiesFormArray(type);
    
    if (event.target.checked) {
      formArray.push(this.formBuilder.control(amenityId));
      console.log(`✅ Added ${type} amenity:`, amenityId);
    } else {
      const index = formArray.controls.findIndex(control => control.value === amenityId);
      if (index !== -1) {
        formArray.removeAt(index);
        console.log(`❌ Removed ${type} amenity:`, amenityId);
      }
    }
  }

  // Handle image file selection
  onImageFilesSelected(event: any): void {
    const files = Array.from(event.target.files) as File[];
    
    if (files.length > 10) {
      Swal.fire({
        icon: 'warning',
        title: 'Too Many Images',
        text: 'You can upload maximum 10 images',
        confirmButtonColor: '#08227B'
      });
      return;
    }

    this.imageFiles = files;
    this.imagePreviews = [];

    files.forEach(file => {
      if (file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = (e: any) => {
          this.imagePreviews.push(e.target.result);
        };
        reader.readAsDataURL(file);
      }
    });

    console.log('✅ Selected', files.length, 'images');
  }

  // Remove image preview
  removeImage(index: number): void {
    this.imageFiles.splice(index, 1);
    this.imagePreviews.splice(index, 1);
    console.log('❌ Removed image at index:', index);
  }

  // ✅ Generate Google Maps URL automatically
  generateLocationUrl(): void {
    const formValues = this.propertyForm.value;
    if (formValues.street && formValues.city && formValues.governate) {
      const address = `${formValues.street}, ${formValues.city}, ${formValues.governate}, Egypt`;
      const encodedAddress = encodeURIComponent(address);
      const googleMapsUrl = `https://maps.google.com/?q=${encodedAddress}`;
      
      this.propertyForm.patchValue({
        locationUrl: googleMapsUrl
      });
      
      console.log('✅ Generated location URL:', googleMapsUrl);
    }
  }

  // Show payment modal
  showPayment(): void {
    if (this.propertyForm.invalid) {
      this.submitted = true;
      this.scrollToFirstError();
      return;
    }

    if (this.imageFiles.length === 0) {
      Swal.fire({
        icon: 'warning',
        title: 'Images Required',
        text: 'Please select at least one image for your property',
        confirmButtonColor: '#08227B'
      });
      return;
    }

    console.log('🔥 Opening payment modal for $', this.paymentAmount, '...');
    this.showPaymentModal = true;
    
    setTimeout(() => {
      console.log('🔥 Payment modal is now visible');
    }, 300);
  }

  // Handle payment success
  onPaymentSuccess(paymentData: any): void {
    console.log('✅ Payment completed successfully:', paymentData);
    this.paymentCompleted = true;
    this.paymentData = paymentData;
    this.showPaymentModal = false;
    
    Swal.fire({
      icon: 'success',
      title: 'Payment Successful!',
      text: 'Now creating your property listing...',
      timer: 2000,
      showConfirmButton: false
    });
    
    this.submitProperty();
  }

  // Handle payment cancellation
  onPaymentCancel(): void {
    console.log('❌ Payment cancelled by user');
    this.showPaymentModal = false;
  }

  // Submit property after payment
  submitProperty(): void {
    this.isSubmitting = true;
    console.log('🚀 Submitting property to API...');

    // تحضير FormData
    const formData = new FormData();
    const formValues = this.propertyForm.value;

    // ✅ إضافة جميع الحقول المطلوبة بالأسماء الصحيحة
    formData.append('Title', formValues.title);
    formData.append('Description', formValues.description);
    formData.append('Price', formValues.price.toString());
    formData.append('PropertyType', formValues.propertyType);
    formData.append('Size', formValues.size.toString());
    formData.append('Bedrooms', formValues.bedrooms.toString());
    formData.append('Bathrooms', formValues.bathrooms.toString());
    formData.append('Street', formValues.street);
    formData.append('City', formValues.city);
    formData.append('Governate', formValues.governate);
    formData.append('LocationUrl', formValues.locationUrl); // ✅ مطلوب
    formData.append('ListingType', formValues.listingType); // ✅ مطلوب

    // إضافة المرافق
    formValues.internalAmenitiesIds.forEach((id: number, index: number) => {
      formData.append(`InternalAmenityIds[${index}]`, id.toString());
    });
    formValues.externalAmenitiesIds.forEach((id: number, index: number) => {
      formData.append(`ExternalAmenityIds[${index}]`, id.toString());
    });
    formValues.accessibilityAmenitiesIds.forEach((id: number, index: number) => {
      formData.append(`AccessibilityAmenityIds[${index}]`, id.toString());
    });

    // إضافة الصور
    this.imageFiles.forEach((file) => {
      formData.append(`Images`, file);
    });

    // إضافة بيانات الدفع
    if (this.paymentData) {
      formData.append('paymentIntentId', this.paymentData.paymentIntentId);
      if (this.paymentData.amount) {
        formData.append('paymentAmount', this.paymentData.amount.toString());
      }
    }

    console.log('📤 Sending property data with all required fields');

    const submitSub = this.propertyService.addProperty(formData).subscribe({
      next: (response) => {
        this.isSubmitting = false;
        console.log('✅ Property created successfully:', response);
        
        Swal.fire({
          icon: 'success',
          title: 'Property Listed Successfully!',
          text: 'Your property has been listed successfully and payment has been processed!',
          confirmButtonColor: '#08227B'
        }).then(() => {
          this.router.navigate(['/home']);
        });
      },
      error: (error) => {
        this.isSubmitting = false;
        console.error('❌ Error adding property:', error);
        
        let errorMessage = 'Failed to add property. Please try again.';
        
        if (error.error && error.error.message) {
          errorMessage = error.error.message;
        } else if (error.message) {
          errorMessage = error.message;
        }

        const paymentNote = this.paymentData ? 
          '\n\nNote: Your payment was processed successfully. Please contact support with your payment ID if needed.' : '';

        Swal.fire({
          icon: 'error',
          title: 'Error Adding Property',
          text: errorMessage + paymentNote,
          confirmButtonColor: '#08227B',
          footer: this.paymentData ? 
            `<small>Payment ID: ${this.paymentData.paymentIntentId}</small>` : ''
        });
      }
    });

    this.subscriptions.push(submitSub);
  }

  // Submit form (opens payment modal)
  onSubmit(): void {
    this.showPayment();
  }

  // Scroll to first error field
  scrollToFirstError(): void {
    const firstErrorField = Object.keys(this.propertyForm.controls).find(
      key => this.propertyForm.get(key)?.invalid
    );
    
    if (firstErrorField) {
      const element = document.getElementById(firstErrorField);
      if (element) {
        element.scrollIntoView({ behavior: 'smooth', block: 'center' });
        element.focus();
      }
    }
  }

  // Go back to home with confirmation
  goBack(): void {
    if (this.propertyForm.dirty && !this.isSubmitting) {
      Swal.fire({
        title: 'Discard Changes?',
        text: 'You have unsaved changes. Are you sure you want to leave?',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#08227B',
        cancelButtonColor: '#d33',
        confirmButtonText: 'Yes, discard changes'
      }).then((result) => {
        if (result.isConfirmed) {
          this.router.navigate(['/home']);
        }
      });
    } else {
      this.router.navigate(['/home']);
    }
  }

  // Check if amenity is selected
  isAmenitySelected(amenityId: number, type: 'internal' | 'external' | 'accessibility'): boolean {
    const formArray = this.getAmenitiesFormArray(type);
    return formArray.controls.some(control => control.value === amenityId);
  }
}


================================================
File: app/chat-bot/chat-bot.component.css
================================================



================================================
File: app/chat-bot/chat-bot.component.html
================================================
<div class="container py-5">
    <div class="row">
      <div class="col-md-8 mx-auto">
        <div class="card shadow-sm border-0 rounded-4 overflow-hidden">
          <div class="card-header bg-primary text-white py-3">
            <div class="d-flex align-items-center">
              <img src="assets/images/chat-bot.png" alt="Chat Bot" class="bot-avatar me-3">
              <div>
                <h5 class="mb-0">X-Rental Assistant</h5>
                <small class="text-white-50">Online</small>
              </div>
              <button class="btn btn-sm btn-light ms-auto" (click)="goBack()">
                Back to Dashboard
              </button>
            </div>
          </div>
          
          <div class="card-body chat-container p-4">
            <div class="chat-messages" #chatMessages>
              <div *ngFor="let message of messages" class="message-wrapper" [ngClass]="{'user-message': message.isUser, 'bot-message': !message.isUser}">
                <div class="message">
                  <div class="message-content">{{ message.content }}</div>
                  <div class="message-time">{{ message.timestamp | date:'shortTime' }}</div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="card-footer bg-white border-top-0 p-3">
            <div class="input-group">
              <input 
                type="text" 
                class="form-control border-0 bg-light rounded-pill me-2" 
                placeholder="Type your message..." 
                [(ngModel)]="newMessage"
                (keyup.enter)="sendMessage()"
              >
              <button class="btn btn-primary rounded-pill" (click)="sendMessage()">
                <i class="bi bi-send-fill"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


================================================
File: app/chat-bot/chat-bot.component.spec.ts
================================================
import { ComponentFixture, TestBed } from '@angular/core/testing';

import { ChatBotComponent } from './chat-bot.component';

describe('ChatBotComponent', () => {
  let component: ChatBotComponent;
  let fixture: ComponentFixture<ChatBotComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [ChatBotComponent]
    })
    .compileComponents();
    
    fixture = TestBed.createComponent(ChatBotComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});



================================================
File: app/chat-bot/chat-bot.component.ts
================================================
import { Component, OnInit } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { Router } from '@angular/router';
import Swal from 'sweetalert2';

interface ChatMessage {
  content: string;
  isUser: boolean;
  timestamp: Date;
}

@Component({
  selector: 'app-chat-bot',
  standalone: true,
  imports: [CommonModule, FormsModule],
  templateUrl: './chat-bot.component.html',
  styleUrls: ['./chat-bot.component.css']
})
export class ChatBotComponent implements OnInit {
  messages: ChatMessage[] = [];
  newMessage: string = '';
  
  constructor(private router: Router) {}

  ngOnInit(): void {
    // Check if user is authenticated
    const token = localStorage.getItem('token');
    if (!token) {
      // User is not authenticated, redirect to login page
      Swal.fire({
        icon: 'warning',
        title: 'Authentication Required',
        text: 'Please log in to access this page',
        timer: 2000,
        showConfirmButton: false
      }).then(() => {
        this.router.navigate(['/log-in']);
      });
      return;
    }
    
    // Initial bot messages
    this.addBotMessage('Hello! I\'m your X-Rental assistant. How can I help you today?');
    this.addBotMessage('You can ask me about properties, rental process, or any other questions you have.');
  }

  sendMessage(): void {
    if (!this.newMessage.trim()) return;
    
    // Add user message
    this.messages.push({
      content: this.newMessage,
      isUser: true,
      timestamp: new Date()
    });
    
    const userQuery = this.newMessage.toLowerCase();
    this.newMessage = '';
    
    // Simulate bot response
    setTimeout(() => {
      let botResponse = '';
      
      if (userQuery.includes('property') || userQuery.includes('properties')) {
        botResponse = 'We have various properties available. You can browse them in the dashboard or use the search filters to find specific types.';
      } else if (userQuery.includes('rent') || userQuery.includes('rental')) {
        botResponse = 'Our rental process is simple: Find a property you like, schedule a visit, and if you decide to proceed, we\'ll help with the paperwork.';
      } else if (userQuery.includes('price') || userQuery.includes('cost')) {
        botResponse = 'Property prices vary depending on location, size, and features. You can see the price of each property on its card.';
      } else if (userQuery.includes('location') || userQuery.includes('area')) {
        botResponse = 'We have properties in various locations across Cairo, including El-Sherouk, Maadi, and other popular areas.';
      } else if (userQuery.includes('hi') || userQuery.includes('hello')) {
        botResponse = 'Hello there! How can I assist you with your property search today?';
      } else {
        botResponse = 'I\'m sorry, I\'m still learning. Could you ask me about our properties, rental process, or contact information?';
      }
      
      this.addBotMessage(botResponse);
    }, 1000);
  }
  
  addBotMessage(content: string): void {
    this.messages.push({
      content,
      isUser: false,
      timestamp: new Date()
    });
  }
  
  goBack(): void {
    this.router.navigate(['/dashboard']);
  }
}


================================================
File: app/favorites/favorites.component.css
================================================
.property-card {
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  
  .property-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15) !important;
  }
  
  .property-img {
    height: 200px;
    object-fit: cover;
  }
  
  .property-details {
    border-top: 1px solid #eee;
    border-bottom: 1px solid #eee;
    padding: 10px 0;
  }
  
  .btn-primary {
    background-color: #08227B;
    border-color: #08227B;
  }
  
  .btn-primary:hover {
    background-color: #061a5f;
    border-color: #061a5f;
  }
  
  .text-primary {
    color: #08227B !important;
  }
  
  .badge.bg-primary {
    background-color: #08227B !important;
  }
  
  .btn-danger {
    background-color: #dc3545;
    border-color: #dc3545;
  }
  
  @media (max-width: 768px) {
    .property-card {
      margin-bottom: 1rem;
    }
    
    .property-details .row {
      text-align: center;
    }
  }



================================================
File: app/favorites/favorites.component.html
================================================
<div class="container py-5">
  <div class="card shadow-sm border-0 rounded-4 p-4 mb-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="text-primary mb-0">
        <i class="bi bi-heart-fill text-danger me-2"></i>
        Your Favorite Properties
      </h2>
      <button class="btn btn-outline-secondary" (click)="goToDashboard()">
        <i class="bi bi-arrow-left"></i> Back to Home
      </button>
    </div>
    
    <!-- Loading State -->
    <div *ngIf="isLoading" class="text-center py-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-3">Loading your favorites...</p>
    </div>
    
    <!-- No favorites -->
    <div *ngIf="!isLoading && favorites.length === 0" class="text-center py-5">
      <i class="bi bi-heart" style="font-size: 4rem; color: #ccc;"></i>
      <h4 class="mt-3">No favorites yet</h4>
      <p class="text-muted">Properties you mark as favorites will appear here</p>
      <button class="btn btn-primary mt-3" (click)="goToDashboard()">
        <i class="bi bi-search"></i> Browse Properties
      </button>
    </div>
    
    <!-- Favorites Grid -->
    <div *ngIf="!isLoading && favorites.length > 0" class="row g-4">
      <div class="col-lg-4 col-md-6" *ngFor="let property of favorites; trackBy: trackByPropertyId">
        <div class="card h-100 border-0 shadow-sm rounded-4 overflow-hidden property-card">
          <!-- Property Image -->
          <div class="position-relative">
            <img 
              [src]="getFirstImage(property)" 
              class="card-img-top property-img" 
              [alt]="property.title"
              (error)="onImageError($event)"
              loading="lazy"
            >
            <!-- Property Type Badge -->
            <span class="badge bg-primary position-absolute top-0 start-0 m-2">
              {{ property.propertyType }}
            </span>
            <!-- NO HEART ON IMAGE - removed -->
          </div>
          
          <!-- Property Info -->
          <div class="card-body d-flex flex-column">
            <div class="mb-3">
              <h5 class="card-title mb-2">{{ property.title }}</h5>
              <p class="text-muted mb-1 small">
                <i class="bi bi-geo-alt"></i> {{ property.street || property.city }}, {{ property.governate }}
              </p>
              <div class="d-flex justify-content-between align-items-center">
                <h5 class="text-primary mb-0">{{ formatPrice(property.price) }}</h5>
                <small class="text-muted">
                  Added {{ formatDate(property.listedAt) }}
                </small>
              </div>
            </div>
            
            <!-- Property Details -->
            <div class="property-details mb-3" *ngIf="property.size > 0 || property.bedrooms > 0 || property.bathrooms > 0">
              <div class="row text-center g-0">
                <div class="col" *ngIf="property.size > 0">
                  <p class="fw-bold mb-0 small">Size</p>
                  <p class="small text-muted">{{ property.size }} mÂ²</p>
                </div>
                <div class="col" *ngIf="property.bedrooms > 0">
                  <p class="fw-bold mb-0 small">Beds</p>
                  <p class="small text-muted">{{ property.bedrooms }}</p>
                </div>
                <div class="col" *ngIf="property.bathrooms > 0">
                  <p class="fw-bold mb-0 small">Baths</p>
                  <p class="small text-muted">{{ property.bathrooms }}</p>
                </div>
              </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="mt-auto d-flex gap-2">
              <button 
                class="btn btn-primary flex-grow-1" 
                (click)="viewProperty(property.propertyId)"
                [class.disabled]="isRemoving"
              >
                <i class="bi bi-eye"></i> View Details
              </button>
              <button 
                class="btn btn-danger" 
                (click)="removeFromFavorites(property.propertyId)"
                [class.disabled]="isRemoving"
                title="Remove from favorites"
              >
                <span *ngIf="!isRemoving">
                  <i class="bi bi-heart-fill"></i>
                </span>
                <span *ngIf="isRemoving">
                  <span class="spinner-border spinner-border-sm"></span>
                </span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Summary -->
    <div *ngIf="!isLoading && favorites.length > 0" class="text-center mt-4 pt-3 border-top">
      <p class="text-muted">
        <i class="bi bi-info-circle"></i>
        You have {{ favorites.length }} favorite {{ favorites.length === 1 ? 'property' : 'properties' }}
      </p>
    </div>
  </div>
</div>

  


================================================
File: app/favorites/favorites.component.spec.ts
================================================
import { ComponentFixture, TestBed } from '@angular/core/testing';

import { FavoritesComponent } from './favorites.component';

describe('FavoritesComponent', () => {
  let component: FavoritesComponent;
  let fixture: ComponentFixture<FavoritesComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [FavoritesComponent]
    })
    .compileComponents();
    
    fixture = TestBed.createComponent(FavoritesComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});



================================================
File: app/favorites/favorites.component.ts
================================================
import { Component, OnInit, OnDestroy } from '@angular/core';
import { CommonModule } from '@angular/common';
import { Router, RouterModule } from '@angular/router';
import { Subscription } from 'rxjs';
import { PropertyService, Property } from '../services/property.service';
import { AuthService } from '../services/auth.service';
import Swal from 'sweetalert2';

@Component({
  selector: 'app-favorites',
  standalone: true,
  imports: [CommonModule, RouterModule],
  templateUrl: './favorites.component.html',
  styleUrls: ['./favorites.component.css']
})
export class FavoritesComponent implements OnInit, OnDestroy {
  favorites: Property[] = [];
  isLoading: boolean = true;
  isLoggedIn: boolean = false;
  isRemoving: boolean = false;
  
  private subscriptions: Subscription[] = [];
  
  constructor(
    private router: Router,
    private propertyService: PropertyService,
    private authService: AuthService
  ) {}

  ngOnInit(): void {
    this.isLoggedIn = this.authService.isLoggedIn();
    
    if (!this.isLoggedIn) {
      Swal.fire({
        icon: 'warning',
        title: 'Authentication Required',
        text: 'Please log in to access your favorites',
        timer: 2000,
        showConfirmButton: false
      }).then(() => {
        this.router.navigate(['/log-in']);
      });
      return;
    }
    
    this.loadFavorites();
  }

  ngOnDestroy(): void {
    this.subscriptions.forEach(sub => sub.unsubscribe());
  }

  loadFavorites(): void {
    this.isLoading = true;
    console.log('🔍 Loading user favorites...');
    
    const favSub = this.propertyService.getFavorites().subscribe({
      next: (favorites) => {
        console.log('✅ Favorites loaded successfully:', favorites);
        this.favorites = favorites;
        this.isLoading = false;
      },
      error: (error) => {
        console.error('❌ Error loading favorites:', error);
        this.isLoading = false;
        
        Swal.fire({
          icon: 'error',
          title: 'Failed to Load Favorites',
          text: 'Unable to load your favorite properties. Please try again.',
          confirmButtonColor: '#08227B'
        });
      }
    });
    
    this.subscriptions.push(favSub);
  }

  viewProperty(propertyId: number): void {
    console.log('🔍 Navigating to property details:', propertyId);
    this.router.navigate(['/property', propertyId]);
  }
  
  removeFromFavorites(propertyId: number): void {
    if (this.isRemoving) return;
    
    console.log('🔍 Removing property from favorites:', propertyId);
    
    Swal.fire({
      title: 'Remove from favorites?',
      text: 'This property will be removed from your favorites',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#08227B',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes, remove it',
      cancelButtonText: 'Cancel'
    }).then((result) => {
      if (result.isConfirmed) {
        this.isRemoving = true;
        
        const removeSub = this.propertyService.removeFromFavorites(propertyId).subscribe({
          next: (response) => {
            console.log('✅ Property removed from favorites:', response);
            this.isRemoving = false;
            
            // Remove from local array immediately
            this.favorites = this.favorites.filter(property => property.propertyId !== propertyId);
            
            Swal.fire({
              position: 'top-end',
              icon: 'success',
              title: 'Removed from favorites',
              showConfirmButton: false,
              timer: 1500
            });
          },
          error: (error) => {
            console.error('❌ Error removing from favorites:', error);
            console.log('📊 Error details:', {
              status: error.status,
              statusText: error.statusText,
              message: error.message,
              error: error.error
            });
            
            this.isRemoving = false;
            
            // Check if it's actually a successful response that Angular is treating as error
            if (error.status === 200 || error.status === 0) {
              console.log('✅ Actually successful - removing from local array');
              
              // Remove from local array since the API call was actually successful
              this.favorites = this.favorites.filter(property => property.propertyId !== propertyId);
              
              Swal.fire({
                position: 'top-end',
                icon: 'success',
                title: 'Removed from favorites',
                showConfirmButton: false,
                timer: 1500
              });
              return;
            }
            
            let errorMessage = 'Unable to remove property from favorites.';
            
            if (error.status === 404) {
              // Handle 404 - property not in favorites
              console.log('⚠️ Property not found in favorites (404), removing from local list anyway');
              
              // Remove from local array since it's not in server anyway
              this.favorites = this.favorites.filter(property => property.propertyId !== propertyId);
              
              Swal.fire({
                position: 'top-end',
                icon: 'info',
                title: 'Property was already removed',
                text: 'This property was not in your favorites',
                showConfirmButton: false,
                timer: 2000
              });
              return; // Exit early, don't show error
            } else if (error.status === 401) {
              errorMessage = 'You need to be logged in to remove favorites.';
            } else if (error.status === 500) {
              errorMessage = 'Server error. Please try again later.';
            }
            
            Swal.fire({
              icon: 'error',
              title: 'Failed to Remove',
              text: errorMessage,
              confirmButtonColor: '#08227B'
            });
          }
        });
        
        this.subscriptions.push(removeSub);
      }
    });
  }
  
  // MISSING METHODS - Added below:
  
  goToDashboard(): void {
    this.router.navigate(['/home']);
  }

  // Helper methods
  getFirstImage(property: Property): string {
    if (property.propertyImages && property.propertyImages.length > 0) {
      return property.propertyImages[0];
    }
    return 'assets/images/apartment.avif';
  }

  formatPrice(price: number): string {
    return new Intl.NumberFormat('en-EG', {
      style: 'currency',
      currency: 'EGP',
      minimumFractionDigits: 0
    }).format(price);
  }

  formatDate(dateString: string): string {
    return new Date(dateString).toLocaleDateString('en-EG', {
      year: 'numeric',
      month: 'short',
      day: 'numeric'
    });
  }

  onImageError(event: any): void {
    event.target.src = 'assets/images/apartment.avif';
  }

  trackByPropertyId(index: number, property: Property): number {
    return property.propertyId;
  }

  // Additional helper methods
  refreshFavorites(): void {
    this.loadFavorites();
  }
}


================================================
File: app/filters/filters.component.css
================================================



================================================
File: app/filters/filters.component.html
================================================
<p>filters works!</p>



================================================
File: app/filters/filters.component.spec.ts
================================================
import { ComponentFixture, TestBed } from '@angular/core/testing';

import { FiltersComponent } from './filters.component';

describe('FiltersComponent', () => {
  let component: FiltersComponent;
  let fixture: ComponentFixture<FiltersComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [FiltersComponent]
    })
    .compileComponents();
    
    fixture = TestBed.createComponent(FiltersComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});



================================================
File: app/filters/filters.component.ts
================================================
import { Component } from '@angular/core';

@Component({
  selector: 'app-filters',
  standalone: true,
  imports: [],
  templateUrl: './filters.component.html',
  styleUrl: './filters.component.css'
})
export class FiltersComponent {

}



================================================
File: app/forget-pass/forget-pass.component.css
================================================
.container {
    display: flex;
    height: 100vh;
    width: 100%;
    font-family: Arial, sans-serif;
  }
  
  /* Left side - Form inputs */
  .form-side {
    width: 50%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 40px;
  }
  
  .form-container {
    width: 100%;
    max-width: 450px;
  }
  
  .title {
    font-size: 2.5rem;
    color: #0c2b7a;
    margin-bottom: 10px;
    font-weight: bold;
  }
  
  .subtitle {
    font-size: 1rem;
    color: #666;
    margin-bottom: 40px;
  }
  
  /* Progress steps */
  .steps-container {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 50px;
  }
  
  .step {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #e0e0e0;
    position: relative;
  }
  
  .step.active {
    background-color: #0c2b7a;
  }
  
  .step-number {
    color: #fff;
    font-weight: bold;
  }
  
  .step.active .step-number {
    color: #fff;
  }
  
  .step-line {
    flex-grow: 1;
    height: 2px;
    background-color: #e0e0e0;
    margin: 0 10px;
    max-width: 80px;
  }
  
  .input-label {
    margin-bottom: 15px;
  }
  
  .input-label h3 {
    font-size: 1.2rem;
    color: #333;
    font-weight: 600;
  }
  
  .form-group {
    margin-bottom: 30px;
  }
  
  .form-control {
    width: 100%;
    padding: 15px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    font-size: 16px;
    outline: none;
    transition: border-color 0.3s;
    background-color: #f5f8ff;
  }
  
  .form-control:focus {
    border-color: #0c2b7a;
  }
  
  .form-control.invalid {
    border-color: #ff3860;
  }
  
  .error-message {
    color: #ff3860;
    font-size: 14px;
    margin-top: 5px;
  }
  
  .reset-btn {
    width: 100%;
    padding: 15px;
    background-color: #0c2b7a;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s;
    margin-bottom: 20px;
  }
  
  .reset-btn:hover {
    background-color: #091e55;
  }
  
  /* Right side - Blue background with image */
  .image-side {
    width: 50%;
    background-color: #0c2b7a; /* Deep blue color from the design */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
  }
  
  .close-button {
    position: absolute;
    top: 20px;
    right: 20px;
  }
  
  .close-btn {
    background: transparent;
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
  }
  
  .image-container {
    width: 80%;
    max-width: 500px;
    display: flex;
    justify-content: center;
  }
  
  .image-container img {
    max-width: 100%;
    height: auto;
  }
  
  /* Responsive design */
  @media (max-width: 768px) {
    .container {
      flex-direction: column-reverse;
    }
    
    .image-side {
      width: 100%;
      height: 30vh;
    }
    
    .form-side {
      width: 100%;
      height: 70vh;
    }
  }


================================================
File: app/forget-pass/forget-pass.component.html
================================================
<!-- Forgot Password Component HTML with loading states -->
<div class="container">
    <!-- Left side (Form inputs) -->
    <div class="form-side">
      <div class="form-container">
        <h1 class="title">Forget Password</h1>
        <p class="subtitle">Enter your Email to reset your password.</p>
  
        <!-- Progress steps -->
        <div class="steps-container">
          <div class="step active">
            <div class="step-number">1</div>
          </div>
          <div class="step-line"></div>
          <div class="step">
            <div class="step-number">2</div>
          </div>
          <div class="step-line"></div>
          <div class="step">
            <div class="step-number">3</div>
          </div>
        </div>
  
        <form (ngSubmit)="onSubmit()" [formGroup]="forgotPasswordForm">
          <!-- Email or Phone label -->
          <div class="input-label">
            <h3>Email Address</h3>
          </div>
  
          <!-- Email input -->
          <div class="form-group">
            <input 
              type="email" 
              formControlName="emailOrPhone" 
              placeholder="Enter your email address"
              class="form-control"
              [ngClass]="{'invalid': submitted && f['emailOrPhone'].errors}"
              [disabled]="isLoading"
            >
            <div *ngIf="submitted && f['emailOrPhone'].errors" class="error-message">
              <div *ngIf="f['emailOrPhone'].errors['required']">Email is required</div>
              <div *ngIf="f['emailOrPhone'].errors['invalidFormat']">Please enter a valid email address</div>
            </div>
          </div>
          
          <!-- Submit button -->
          <button type="submit" class="reset-btn" [disabled]="isLoading">
            <span *ngIf="!isLoading">Send Reset Code</span>
            <span *ngIf="isLoading">
              <i class="bi bi-arrow-clockwise animate-spin"></i>
              Sending...
            </span>
          </button>
        </form>

        <!-- Back to login link -->
        <div class="back-to-login" style="text-align: center; margin-top: 20px;">
          <span>Remember your password? </span>
          <a [routerLink]="['/log-in']" *ngIf="!isLoading" style="color: #0c2b7a; text-decoration: none; font-weight: bold;">Back to Login</a>
        </div>
      </div>
    </div>
  
    <!-- Right side (Blue background with image) -->
    <div class="image-side">
      <div class="close-button">
        <button class="close-btn" (click)="goHome()">
          <i class="bi bi-x"></i>
        </button>
      </div>
      <div class="image-container">
        <img src="../../assets/images/forgetpassword.png" alt="Forgot password illustration">
      </div>
    </div>
  </div>

  <!-- Add CSS for loading animation -->
  <style>
    .animate-spin {
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      from {
        transform: rotate(0deg);
      }
      to {
        transform: rotate(360deg);
      }
    }
    
    .reset-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .form-control:disabled {
      background-color: #f5f5f5;
      opacity: 0.6;
    }
  </style>


================================================
File: app/forget-pass/forget-pass.component.spec.ts
================================================
import { ComponentFixture, TestBed } from '@angular/core/testing';

import { ForgetPassComponent } from './forget-pass.component';

describe('ForgetPassComponent', () => {
  let component: ForgetPassComponent;
  let fixture: ComponentFixture<ForgetPassComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [ForgetPassComponent]
    })
    .compileComponents();
    
    fixture = TestBed.createComponent(ForgetPassComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});



================================================
File: app/forget-pass/forget-pass.component.ts
================================================
import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators, ReactiveFormsModule, AbstractControl, ValidationErrors } from '@angular/forms';
import { Router, RouterModule } from '@angular/router';
import { CommonModule } from '@angular/common';

@Component({
  selector: 'app-forget-pass',
  templateUrl: './forget-pass.component.html',
  styleUrls: ['./forget-pass.component.css'],
  standalone: true,
  imports: [CommonModule, ReactiveFormsModule, RouterModule]
})
export class ForgetPassComponent implements OnInit {
  forgotPasswordForm!: FormGroup;
  submitted = false;
  isLoading = false;

  constructor(
    private formBuilder: FormBuilder,
    public router: Router
  ) { }

  ngOnInit(): void {
    this.forgotPasswordForm = this.formBuilder.group({
      emailOrPhone: ['', [Validators.required, this.validateEmailOrPhone]]
    });
  }

  validateEmailOrPhone(control: AbstractControl): ValidationErrors | null {
    const value = control.value;
    const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
    const phonePattern = /^\+?\d{10,15}$/;

    if (!value) return null;
    if (emailPattern.test(value) || phonePattern.test(value)) return null;

    return { invalidFormat: true };
  }

  get f() { return this.forgotPasswordForm.controls; }

  onSubmit(): void {
    this.submitted = true;

    if (this.forgotPasswordForm.invalid) return;

    this.isLoading = true;
    setTimeout(() => {
      console.log('Form submitted', this.forgotPasswordForm.value);
      this.router.navigate(['/otp-verification'], {
        queryParams: { contact: this.forgotPasswordForm.value.emailOrPhone }
      });
      this.isLoading = false;
    }, 2000);
  }

  // ✅ أضفناها لحل الخطأ
  goHome(): void {
    this.router.navigate(['/home']);
  }
}



================================================
File: app/guards/auth.guard.ts
================================================
import { inject } from '@angular/core';
import { Router, CanActivateFn } from '@angular/router';
import { CookieService } from 'ngx-cookie-service';

export const authGuard: CanActivateFn = (route, state) => {
  const cookieService = inject(CookieService);
  const router = inject(Router);
  
  const token = cookieService.get('token');
  
  if (token) {
    return true;
  }
  
  // Show alert and redirect to login
  alert('Authentication Required. Please log in to access this page');
  router.navigate(['/log-in'], { queryParams: { returnUrl: state.url } });
  
  return false;
};


================================================
File: app/home/home.component.css
================================================



================================================
File: app/home/home.component.html
================================================
<!-- Alert Component -->
<div class="alert-container" *ngIf="showAlert">
  <div class="alert" [ngClass]="{
    'alert-success': alertType === 'success',
    'alert-error': alertType === 'error',
    'alert-info': alertType === 'info'
  }">
    {{ alertMessage }}
  </div>
</div>

<!-- Header/Navigation -->
<header class="py-3">
  <div class="container">
    <div class="d-flex justify-content-between align-items-center">
      <div class="logo">
        <h2 class="fw-bold">Dizon</h2>
      </div>
      <div class="nav-links">
        <ul class="list-unstyled d-flex gap-4 mb-0">
          <li>
            <a [routerLink]="isLoggedIn ? ['/add-property'] : null" 
               (click)="!isLoggedIn && showLoginAlert()" 
               class="text-decoration-none text-dark pointer">Add new property</a>
          </li>
          <li>
            <a [routerLink]="isLoggedIn ? ['/favorites'] : null" 
               (click)="!isLoggedIn && showLoginAlert()" 
               class="text-decoration-none text-dark pointer">Favorite</a>
          </li>
          <li>
  <a [routerLink]="['/about-us']" 
     class="text-decoration-none text-dark">about Us</a>
</li>
<li>
  <a [routerLink]="isLoggedIn ? ['/chat-bot'] : null" 
     (click)="!isLoggedIn && showLoginAlert()" 
     class="text-decoration-none text-dark pointer">chat Bot</a>
</li>
        </ul>
      </div>
      
      <!-- Show auth buttons for guests or user profile for logged in users -->
      <div *ngIf="!isLoggedIn" class="auth-buttons">
        <a [routerLink]="['/sign-up']" class="btn btn-outline-dark rounded-pill me-2">sign up</a>
        <a [routerLink]="['/log-in']" class="btn btn-primary rounded-pill">login</a>
      </div>
    <div *ngIf="isLoggedIn" class="user-profile d-flex align-items-center">
  <span class="me-2">Welcome, {{ userName }}</span>
  <div class="dropdown">
    <a href="#" class="dropdown-toggle text-decoration-none" id="profileDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <div class="profile-image-container-header">
        <!-- الطبقة الأولى (السفلى): الصورة الافتراضية -->
        <img 
          src="assets/images/unknown.png" 
          alt="Profile Picture" 
          class="profile-image-header default-image"
        >
        <!-- الطبقة الثانية (الوسطى): صورة المستخدم -->
        <img 
          *ngIf="hasUserImage()"
          [src]="getUserActualImageUrl()" 
          alt="User Profile Picture" 
          class="profile-image-header user-image"
          onerror="this.style.display='none'"
        >
      </div>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
      <li><a class="dropdown-item" [routerLink]="['/profile']">My Profile</a></li>
      <li><a class="dropdown-item" [routerLink]="['/my-properties']">My Properties</a></li>
      <li><hr class="dropdown-divider"></li>
      <li><a class="dropdown-item pointer" (click)="logout()">Logout</a></li>
    </ul>
  </div>
</div>
    </div>
    </div>
</header>

<!-- Hero Section with Search -->
<section class="hero-section position-relative">
  <div class="hero-image">
    <!-- Background image will be applied via CSS -->
  </div>
  <div class="container">
    <div class="search-container py-5">
      <div class="row justify-content-center">
        <div class="col-md-10">
          <div class="search-bar-container bg-white rounded-pill shadow mt-5 p-2">
            <div class="d-flex align-items-center">
              <!-- Property Type Filters -->
              <div class="property-filters d-flex me-auto ms-3">
                <button class="btn btn-sm me-2" [ngClass]="{'btn-primary': selectedFilter === 'All', 'btn-link text-dark': selectedFilter !== 'All'}" 
                        (click)="filterByType('All')">All</button>
                <button class="btn btn-sm me-2" [ngClass]="{'btn-primary': selectedFilter === 'Apartment', 'btn-link text-dark': selectedFilter !== 'Apartment'}" 
                        (click)="filterByType('Apartment')">Apartment</button>
                <button class="btn btn-sm me-2" [ngClass]="{'btn-primary': selectedFilter === 'House', 'btn-link text-dark': selectedFilter !== 'House'}" 
                        (click)="filterByType('House')">House</button>
                <button class="btn btn-sm me-2" [ngClass]="{'btn-primary': selectedFilter === 'Office', 'btn-link text-dark': selectedFilter !== 'Office'}" 
                        (click)="filterByType('Office')">Office</button>
                <button class="btn btn-sm me-2" [ngClass]="{'btn-primary': selectedFilter === 'Villa', 'btn-link text-dark': selectedFilter !== 'Villa'}" 
                        (click)="filterByType('Villa')">Villa</button>
              </div>
              
              <!-- Search Input -->
              <div class="search-input d-flex align-items-center">
                <input type="text" class="form-control form-control-sm border-0" placeholder="Search properties..." 
                       [(ngModel)]="searchQuery" (keyup.enter)="searchProperties()">
                <button class="btn btn-primary btn-sm rounded-pill ms-2" (click)="searchProperties()" [disabled]="isLoading">
                  <i class="bi bi-search"></i> Search
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Property Listings -->
<section class="property-listings py-5">
  <div class="container">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="text-center py-5">
      <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-3">Loading properties...</p>
    </div>

    <!-- Properties Grid -->
    <div *ngIf="!isLoading" class="row g-4 justify-content-center">
      <!-- No Properties Found -->
      <div *ngIf="filteredProperties.length === 0" class="col-12 text-center py-5">
        <i class="bi bi-house" style="font-size: 4rem; color: #ccc;"></i>
        <h3 class="mt-3">No Properties Found</h3>
        <p class="text-muted">Try adjusting your search criteria or browse all properties.</p>
        <button class="btn btn-primary" (click)="filterByType('All')">Show All Properties</button>
      </div>
<!-- Property Cards -->
      <div class="col-md-6 col-lg-4 mb-4" *ngFor="let property of filteredProperties; trackBy: trackByPropertyId">
        <div class="property-card border-0 shadow-sm">
          <div class="position-relative">
            <img 
              [src]="getFirstImage(property)" 
              class="property-img" 
              [alt]="property.title"
              (error)="onImageError($event)"
              loading="lazy"
            >
            <!-- Property Type Badge -->
            <span class="badge bg-primary position-absolute top-0 start-0 m-2">{{ property.propertyType }}</span>
            <!-- NO HEART HERE - removed from image -->
          </div>
          <div class="property-info p-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div>
                <h5 class="mb-1">{{ property.title }}</h5>
                <p class="text-muted mb-0 small">
                  <i class="bi bi-geo-alt"></i> {{ property.street }}, {{ property.city }}
                </p>
              </div>
              <div>
                <h5 class="text-end text-primary">{{ formatPrice(property.price) }}</h5>
              </div>
            </div>
            
            <div class="property-details mt-3">
              <div class="row text-center g-0">
                <div class="col">
                  <p class="fw-bold mb-0">Size</p>
                  <p class="small">{{ property.size }} m²</p>
                </div>
                <div class="col">
                  <p class="fw-bold mb-0">Beds</p>
                  <p class="small">{{ property.bedrooms }}</p>
                </div>
                <div class="col">
                  <p class="fw-bold mb-0">Baths</p>
                  <p class="small">{{ property.bathrooms }}</p>
                </div>
              </div>
            </div>
            
            <!-- Action Buttons Row -->
            <div class="mt-3 d-flex gap-2">
              <button 
                class="btn btn-primary rounded-pill flex-grow-1" 
                (click)="viewProperty(property.propertyId)"
              >
                View Details
              </button>
              
              <!-- Heart Button - Bottom Right -->
              <button 
                class="btn rounded-pill heart-btn" 
                [ngClass]="{
                  'btn-outline-secondary': !property.isFavorite,
                  'btn-danger': property.isFavorite
                }"
                (click)="toggleFavorite(property.propertyId)"
                [title]="property.isFavorite ? 'Remove from favorites' : 'Add to favorites'"
              >
                <i class="bi" 
                   [ngClass]="{
                     'bi-heart': !property.isFavorite,
                     'bi-heart-fill': property.isFavorite
                   }">
                </i>
              </button>
            </div>
          </div>
        </div>
      </div>

    <!-- Pagination -->
    <div *ngIf="!isLoading && filteredProperties.length > 0 && totalPages > 1" class="d-flex justify-content-center mt-5">
      <nav aria-label="Properties pagination">
        <ul class="pagination">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <button class="page-link" (click)="previousPage()" [disabled]="currentPage === 1">
              <i class="bi bi-chevron-left"></i>
            </button>
          </li>
          
          <li class="page-item" *ngIf="currentPage > 3">
            <button class="page-link" (click)="goToPage(1)">1</button>
          </li>
          
          <li class="page-item disabled" *ngIf="currentPage > 4">
            <span class="page-link">...</span>
          </li>
          
          <li class="page-item" *ngFor="let page of getPaginationArray()" [class.active]="page === currentPage">
            <button class="page-link" (click)="goToPage(page)">{{ page }}</button>
          </li>
          
          <li class="page-item disabled" *ngIf="currentPage < totalPages - 3">
            <span class="page-link">...</span>
          </li>
          
          <li class="page-item" *ngIf="currentPage < totalPages - 2">
            <button class="page-link" (click)="goToPage(totalPages)">{{ totalPages }}</button>
          </li>
          
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <button class="page-link" (click)="nextPage()" [disabled]="currentPage === totalPages">
              <i class="bi bi-chevron-right"></i>
            </button>
          </li>
        </ul>
      </nav>
    </div>

    <!-- Results Summary -->
    <div *ngIf="!isLoading && filteredProperties.length > 0" class="text-center mt-3">
      <p class="text-muted">
        Showing {{ ((currentPage - 1) * pageSize) + 1 }} - {{ Math.min(currentPage * pageSize, totalCount) }} 
        of {{ totalCount }} properties
      </p>
    </div>
  </div>
<!-- Footer Section - أضف هذا الكود في نهاية ملف HTML قبل إغلاق آخر </section> -->

<!-- Footer -->
<footer class="footer">
  <div class="container">
    <div class="row">
      <!-- Company Info -->
      <div class="col-lg-4 col-md-6 mb-4">
        <div class="logo-footer">X-rental</div>
        <p class="footer-description">
          Your trusted partner in finding the perfect property. We connect people with their dream homes and investment opportunities across Egypt.
        </p>
        <div class="social-icons">
          <a href="#" class="social-icon" title="Facebook">
            <i class="bi bi-facebook"></i>
          </a>
          <a href="#" class="social-icon" title="Instagram">
            <i class="bi bi-instagram"></i>
          </a>
          <a href="#" class="social-icon" title="Twitter">
            <i class="bi bi-twitter"></i>
          </a>
          <a href="#" class="social-icon" title="LinkedIn">
            <i class="bi bi-linkedin"></i>
          </a>
          <a href="#" class="social-icon" title="YouTube">
            <i class="bi bi-youtube"></i>
          </a>
        </div>
      </div>
      
      <!-- Quick Links -->
      <div class="col-lg-2 col-md-6 mb-4">
        <h5>Quick Links</h5>
        <ul>
          <li><a href="#">Home</a></li>
          <li><a href="#">Properties</a></li>
          <li><a href="#">Add Property</a></li>
          <li><a href="#">Favorites</a></li>
          <li><a href="#">About Us</a></li>
          <li><a href="#">Contact</a></li>
        </ul>
      </div>
      
      <!-- Services -->
      <div class="col-lg-2 col-md-6 mb-4">
        <h5>Services</h5>
        <ul>
          <li><a href="#">Buy Property</a></li>
          <li><a href="#">Rent Property</a></li>
          <li><a href="#">Sell Property</a></li>
          <li><a href="#">Property Management</a></li>
          <li><a href="#">Investment Advice</a></li>
          <li><a href="#">Market Analysis</a></li>
        </ul>
      </div>
      
      <!-- Property Types -->
      <div class="col-lg-2 col-md-6 mb-4">
        <h5>Property Types</h5>
        <ul>
          <li><a href="#">Apartments</a></li>
          <li><a href="#">Houses</a></li>
          <li><a href="#">Villas</a></li>
          <li><a href="#">Offices</a></li>
          <li><a href="#">Commercial</a></li>
          <li><a href="#">Land</a></li>
        </ul>
      </div>
      
      <!-- Contact Info -->
      <div class="col-lg-2 col-md-6 mb-4">
        <h5>Contact Info</h5>
        <ul>
          <li><a href="tel:+201234567890">
            <i class="bi bi-telephone me-2"></i>+20 123 456 7890
          </a></li>
          <li><a href="mailto:info@x-rental.com">
            <i class="bi bi-envelope me-2"></i>infox-rental.com
          </a></li>
          <li><a href="#">
            <i class="bi bi-geo-alt me-2"></i>Cairo, Egypt
          </a></li>
          <li><a href="#">
            <i class="bi bi-clock me-2"></i>24/7 Support
          </a></li>
        </ul>
      </div>
    </div>
    
    <!-- Footer Bottom -->
    <div class="footer-bottom">
      <div class="row">
        <div class="col-md-6">
          <p>&copy; 2024 X-rental. All rights reserved.</p>
        </div>
        <div class="col-md-6">
          <p>
            <a href="#" class="text-light me-3">Privacy Policy</a>
            <a href="#" class="text-light me-3">Terms of Service</a>
            <a href="#" class="text-light">Cookie Policy</a>
          </p>
        </div>
      </div>
    </div>
  </div>
</footer>

<!-- Additional CSS for pagination and improved styling -->
/* تحديث CSS لتطبيق التصميم الجديد مع الحفاظ على الوظائف الموجودة */

<style>
  /* Hero Section - نفس التصميم القديم */
  .hero-section {
    position: relative;
    height: 500px; /* ارتفاع معقول */
    width: 100%;
    max-width: 1377.79px;
    margin: 0 auto;
    overflow: hidden;
    display: flex;
    align-items: center;
    border-radius: 18px;
    background: linear-gradient(rgba(8, 34, 123, 0.6), rgba(8, 34, 123, 0.6)), 
                url('assets/images/background.webp') center/cover no-repeat;
  }

  .hero-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    border-radius: 18px;
  }

  /* Search Container - وضعه في المنتصف */
  .search-container {
    position: relative;
    z-index: 2;
    width: 100%;
    margin-top: 200px; /* تحريك الـ search لتحت شوية */
    padding: 0 !important;
  }

  .search-bar-container {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    padding: 15px !important;
    background-color: white;
    border-radius: 50px !important;
  }

  /* Search Input - حجم أكبر */
  .search-input .form-control {
    box-shadow: none;
    font-size: 1.1rem !important;
    padding: 12px 15px !important;
    height: auto !important;
    border: none;
  }

  .search-input .btn {
    font-size: 1.1rem !important;
    padding: 10px 20px !important;
  }

  /* Property Filters */
  .property-filters .btn {
    transition: all 0.3s ease;
    font-size: 0.95rem;
    padding: 8px 16px;
  }

  .property-filters .btn-primary {
    background-color: #08227B !important;
    border-color: #08227B !important;
  }

  .property-filters .btn-link {
    background-color: transparent;
    border: none;
    color: #333 !important;
  }

  .property-filters .btn-link:hover {
    background-color: rgba(8, 34, 123, 0.1);
    color: #08227B !important;
  }

  /* Property Cards */
  .property-card {
    border-radius: 20px !important;
    overflow: hidden;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    height: 100%;
    width: 350px;
    max-width: 100%;
    margin: 0 auto;
  }

  .property-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15) !important;
  }

  .property-img {
    height: 220px;
    width: 100%;
    object-fit: cover;
  }

  .property-info {
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
    height: calc(100% - 220px);
  }

  .property-details {
    border-top: 1px solid #eee;
    border-bottom: 1px solid #eee;
    padding: 15px 0;
    margin: auto 0;
  }

  /* Buttons */
  .btn-primary {
    background-color: #08227B !important;
    border-color: #08227B !important;
  }

  .btn-primary:hover {
    background-color: #061a5f !important;
    border-color: #061a5f !important;
  }

  .btn-outline-primary {
    color: #08227B !important;
    border-color: #08227B !important;
  }

  .btn-outline-primary:hover {
    background-color: #08227B !important;
    border-color: #08227B !important;
    color: white !important;
  }

  .text-primary {
    color: #08227B !important;
  }

  /* Heart Button Styles */
  .heart-btn {
    min-width: 45px;
    height: 38px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    border-width: 1px;
  }

  .heart-btn:hover {
    transform: scale(1.1);
  }

  .heart-btn.btn-outline-secondary {
    color: #6c757d;
    border-color: #6c757d;
    background-color: transparent;
  }

  .heart-btn.btn-outline-secondary:hover {
    color: #dc3545;
    border-color: #dc3545;
    background-color: transparent;
  }

  .heart-btn.btn-danger {
    color: white;
    background-color: #dc3545;
    border-color: #dc3545;
  }

  .heart-btn.btn-danger:hover {
    background-color: #c82333;
    border-color: #bd2130;
  }

  .heart-btn i {
    font-size: 16px;
    transition: all 0.3s ease;
  }

  /* Pagination */
  .pagination .page-link {
    color: #08227B;
    border-color: #08227B;
  }

  .pagination .page-item.active .page-link {
    background-color: #08227B;
    border-color: #08227B;
  }

  .pagination .page-link:hover {
    background-color: rgba(8, 34, 123, 0.1);
    border-color: #08227B;
  }

  /* Loading Animation */
  .loading-shimmer {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
  }

  @keyframes shimmer {
    0% {
      background-position: -200% 0;
    }
    100% {
      background-position: 200% 0;
    }
  }

  /* Responsive Design */
  @media (max-width: 992px) {
    .hero-section {
      height: 400px;
      border-radius: 15px;
    }

    .search-container {
      margin-top: 150px;
    }

    .property-filters {
      overflow-x: auto;
      flex-wrap: nowrap;
      width: 100%;
      justify-content: flex-start;
      padding-bottom: 5px;
    }

    .search-bar-container {
      flex-direction: column;
      border-radius: 20px !important;
    }

    .search-input {
      width: 100%;
      margin-top: 10px;
    }
  }

  @media (max-width: 768px) {
    .hero-section {
      height: 350px;
      border-radius: 12px;
    }

    .search-container {
      margin-top: 100px;
      padding: 0 15px !important;
    }

    .search-bar-container {
      border-radius: 15px !important;
      padding: 12px !important;
    }

    .property-filters {
      padding: 10px 0;
    }

    .search-input {
      padding: 0 15px 15px 15px;
    }

    .pagination {
      flex-wrap: wrap;
      justify-content: center;
    }

    .property-card {
      margin-bottom: 1rem;
      width: 100%;
    }

    .heart-btn {
      min-width: 40px;
      height: 35px;
    }
  }

  @media (max-width: 576px) {
    .hero-section {
      height: 300px;
    }

    .search-container {
      margin-top: 80px;
    }
  }

  /* Modern Footer Styles */
  .footer {
    background: linear-gradient(135deg, #08227B 0%, #0a2f8f 50%, #061b5f 100%);
    color: white;
    padding: 4rem 0 1.5rem 0;
    margin-top: 5rem;
    position: relative;
    overflow: hidden;
  }

  .footer::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.03) 0%, transparent 70%);
    animation: float 20s ease-in-out infinite;
  }

  @keyframes float {
    0%, 100% { transform: translate(0, 0) rotate(0deg); }
    33% { transform: translate(-20px, -10px) rotate(1deg); }
    66% { transform: translate(20px, 10px) rotate(-1deg); }
  }

  .footer h5 {
    color: white;
    font-weight: 700;
    margin-bottom: 1.8rem;
    font-size: 1.3rem;
    position: relative;
    padding-bottom: 0.5rem;
  }

  .footer h5::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 40px;
    height: 3px;
    background: linear-gradient(90deg, #ffffff, rgba(255, 255, 255, 0.3));
    border-radius: 2px;
  }

  .footer ul {
    list-style: none;
    padding: 0;
  }

  .footer ul li {
    margin-bottom: 1rem;
    position: relative;
  }

  .footer ul li a {
    color: rgba(255, 255, 255, 0.85);
    text-decoration: none;
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    font-size: 0.95rem;
    font-weight: 400;
    display: flex;
    align-items: center;
    padding: 0.3rem 0;
    position: relative;
  }

  .footer ul li a::before {
    content: '';
    position: absolute;
    left: -15px;
    top: 50%;
    transform: translateY(-50%);
    width: 0;
    height: 2px;
    background: linear-gradient(90deg, #ffffff, rgba(255, 255, 255, 0.5));
    transition: width 0.4s ease;
  }

  .footer ul li a:hover {
    color: white;
    padding-left: 15px;
    transform: translateX(5px);
  }

  .footer ul li a:hover::before {
    width: 12px;
  }

  .footer .social-icons {
    display: flex;
    gap: 1.2rem;
    margin-top: 2rem;
  }

  .footer .social-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    color: white;
    text-decoration: none;
    transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    font-size: 1.3rem;
    position: relative;
    overflow: hidden;
  }

  .footer .social-icon::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.6s ease;
  }

  .footer .social-icon:hover {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    transform: translateY(-5px) scale(1.05);
    box-shadow: 0 10px 25px rgba(255, 255, 255, 0.15);
    border-color: rgba(255, 255, 255, 0.4);
  }

  .footer .social-icon:hover::before {
    left: 100%;
  }

  .footer .logo-footer {
    font-size: 2.5rem;
    font-weight: 800;
    color: white;
    margin-bottom: 1.5rem;
    background: linear-gradient(45deg, #ffffff, #e8e8e8);
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 2px 10px rgba(255, 255, 255, 0.1);
  }

  .footer .footer-description {
    color: rgba(255, 255, 255, 0.85);
    line-height: 1.7;
    margin-bottom: 2rem;
    font-weight: 300;
    font-size: 1rem;
  }

  .footer-bottom {
    border-top: 1px solid rgba(255, 255, 255, 0.15);
    padding-top: 2rem;
    margin-top: 3rem;
    position: relative;
    backdrop-filter: blur(5px);
  }

  .footer-bottom p {
    margin: 0;
    font-size: 0.9rem;
    font-weight: 300;
    color: rgba(255, 255, 255, 0.7);
  }

  .footer-bottom a {
    color: rgba(255, 255, 255, 0.8);
    text-decoration: none;
    transition: all 0.3s ease;
    position: relative;
  }

  .footer-bottom a::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 0;
    height: 1px;
    background: white;
    transition: width 0.3s ease;
  }

  .footer-bottom a:hover {
    color: white;
  }

  .footer-bottom a:hover::after {
    width: 100%;
  }

  /* Modern Footer Responsive */
  @media (max-width: 768px) {
    .footer {
      padding: 3rem 0 1.5rem 0;
      text-align: center;
    }

    .footer h5 {
      margin-bottom: 1.2rem;
      font-size: 1.2rem;
    }

    .footer h5::after {
      left: 50%;
      transform: translateX(-50%);
    }

    .footer ul li {
      margin-bottom: 0.8rem;
    }

    .footer ul li a:hover {
      padding-left: 0;
      transform: translateX(0);
    }

    .footer ul li a:hover::before {
      display: none;
    }

    .footer .social-icons {
      justify-content: center;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .footer .social-icon {
      width: 44px;
      height: 44px;
      font-size: 1.2rem;
    }

    .footer .logo-footer {
      font-size: 2.2rem;
      margin-bottom: 1.2rem;
    }

    .footer-bottom {
      text-align: center;
      padding-top: 1.5rem;
      margin-top: 2.5rem;
    }

    .footer-bottom .row {
      flex-direction: column;
      gap: 1rem;
    }
  }

  @media (max-width: 576px) {
    .footer {
      padding: 2.5rem 0 1rem 0;
    }

    .footer .logo-footer {
      font-size: 2rem;
    }

    .footer .social-icons {
      gap: 0.8rem;
    }

    .footer .social-icon {
      width: 40px;
      height: 40px;
      font-size: 1.1rem;
    }
  }
  /* Profile Image Styles for Header */
.profile-image-container-header {
  position: relative;
  display: inline-block;
  overflow: hidden;
  border-radius: 50%;
  width: 40px;
  height: 40px;
}

.profile-image-header {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid #08227B;
  position: absolute;
  top: 0;
  left: 0;
  display: block;
}

.profile-image-header.default-image {
  position: relative;
  opacity: 1;
  z-index: 1;
}

.profile-image-header.user-image {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 2;
}

</style>

<!-- إضافة الـ Footer HTML قبل إغلاق المحتوى -->


================================================
File: app/home/home.component.spec.ts
================================================
import { ComponentFixture, TestBed } from '@angular/core/testing';

import { HomeComponent } from './home.component';

describe('HomeComponent', () => {
  let component: HomeComponent;
  let fixture: ComponentFixture<HomeComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [HomeComponent]
    })
    .compileComponents();
    
    fixture = TestBed.createComponent(HomeComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});



================================================
File: app/home/home.component.ts
================================================
import { Component, OnInit, OnDestroy } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { RouterModule, Router } from '@angular/router';
import { Subscription, forkJoin } from 'rxjs';
import { AuthService } from '../services/auth.service';
import { PropertyService, Property, PropertyFilters } from '../services/property.service';
import Swal from 'sweetalert2';

@Component({
  selector: 'app-home',
  standalone: true,
  imports: [CommonModule, FormsModule, RouterModule],
  templateUrl: './home.component.html',
  styleUrls: ['./home.component.css']
})
export class HomeComponent implements OnInit, OnDestroy {
  properties: Property[] = [];
  filteredProperties: Property[] = [];
  selectedFilter: string = 'All';
  searchQuery: string = '';
  isLoggedIn: boolean = false;
  userName: string = 'Guest';
  showAlert: boolean = false;
  alertMessage: string = '';
  alertType: 'success' | 'error' | 'info' = 'info';
  isLoading: boolean = true;
  
  // Pagination
  currentPage: number = 1;
  pageSize: number = 12;
  totalCount: number = 0;
  totalPages: number = 0;
  
  private subscriptions: Subscription[] = [];
  
  constructor(
    private router: Router,
    private authService: AuthService,
    private propertyService: PropertyService
  ) { }

  ngOnInit(): void {
    // Subscribe to authentication state changes
    const authSub = this.authService.currentUser$.subscribe(user => {
      this.isLoggedIn = !!user;
      if (user) {
        this.userName = this.authService.getUserFullName();
      } else {
        this.userName = 'Guest';
        this.router.navigate(['/log-in']);
      }
    });
    this.subscriptions.push(authSub);

    // Check initial authentication state
    this.isLoggedIn = this.authService.isLoggedIn();
    if (!this.isLoggedIn) {
      this.router.navigate(['/log-in']);
      return;
    }

    this.userName = this.authService.getUserFullName();
    this.loadProperties();
  }

  ngOnDestroy(): void {
    this.subscriptions.forEach(sub => sub.unsubscribe());
  }

  loadProperties(filters?: PropertyFilters): void {
    this.isLoading = true;
    
    const searchFilters: PropertyFilters = {
      pageIndex: this.currentPage,
      pageSize: this.pageSize,
      ...filters
    };

    console.log('Loading properties with filters:', searchFilters);

    const propertySub = this.propertyService.getProperties(searchFilters).subscribe({
      next: (response) => {
        console.log('Properties loaded successfully:', response);
        
        this.properties = response.data;
        this.filteredProperties = [...this.properties];
        
        this.totalCount = response.totalCount;
        this.totalPages = Math.ceil(this.totalCount / this.pageSize);
        
        this.isLoading = false;
        
        if (this.isLoggedIn && this.properties.length > 0) {
          this.loadUserFavorites();
        }
      },
      error: (error) => {
        console.error('Error loading properties:', error);
        this.isLoading = false;
        this.showAlertMessage('Failed to load properties. Please try again.', 'error');
      }
    });
    this.subscriptions.push(propertySub);
  }

  loadUserFavorites(): void {
    console.log('Loading user favorites...');
    
    const favoriteChecks = this.properties.map(property => 
      this.propertyService.isPropertyInFavorites(property.propertyId)
    );

    if (favoriteChecks.length === 0) {
      return;
    }

    const favSub = forkJoin(favoriteChecks).subscribe({
      next: (favoriteStatuses) => {
        console.log('Favorite statuses loaded:', favoriteStatuses);
        
        this.properties.forEach((property, index) => {
          property.isFavorite = favoriteStatuses[index] || false;
        });
        
        this.filteredProperties = [...this.properties];
        console.log('Properties updated with favorite status');
      },
      error: (error) => {
        console.error('Error loading favorites:', error);
      }
    });
    this.subscriptions.push(favSub);
  }

  showAlertMessage(message: string, type: 'success' | 'error' | 'info' = 'info'): void {
    this.alertMessage = message;
    this.alertType = type;
    this.showAlert = true;
    
    setTimeout(() => {
      this.showAlert = false;
    }, 3000);
  }

  filterByType(type: string): void {
    this.selectedFilter = type;
    this.currentPage = 1;
    
    const filters: PropertyFilters = {};
    if (type !== 'All') {
      filters.propertyType = type;
    }
    
    this.loadProperties(filters);
  }

  searchProperties(): void {
    if (!this.searchQuery.trim()) {
      this.filterByType(this.selectedFilter);
      return;
    }
    
    this.currentPage = 1;
    const filters: PropertyFilters = {
      searchTerm: this.searchQuery.trim()
    };
    
    if (this.selectedFilter !== 'All') {
      filters.propertyType = this.selectedFilter;
    }
    
    this.loadProperties(filters);
  }

  toggleFavorite(propertyId: number): void {
    if (!this.isLoggedIn) {
      this.showAlertMessage('You need to login to add favorites', 'info');
      return;
    }
    
    const property = this.properties.find(p => p.propertyId === propertyId);
    if (!property) return;

    console.log('🔍 Toggling favorite for property:', propertyId, 'Current status:', property.isFavorite);

    // Store original state in case we need to revert
    const originalState = property.isFavorite;
    
    // Optimistically update UI immediately
    property.isFavorite = !property.isFavorite;
    
    // Update the filtered properties as well
    const filteredProperty = this.filteredProperties.find(p => p.propertyId === propertyId);
    if (filteredProperty) {
      filteredProperty.isFavorite = property.isFavorite;
    }

    // Force Angular change detection immediately
    setTimeout(() => {
      // This ensures the UI updates immediately
    }, 0);

    const action = property.isFavorite ? 'add' : 'remove';
    const apiCall = property.isFavorite 
      ? this.propertyService.addToFavorites(propertyId)
      : this.propertyService.removeFromFavorites(propertyId);

    const favSub = apiCall.subscribe({
      next: (response) => {
        console.log(`✅ ${action} favorite successful:`, response);
        
        const message = property.isFavorite ? 'Added to favorites' : 'Removed from favorites';
        this.showAlertMessage(message, 'success');
        
        // Ensure UI is up to date by triggering change detection
        this.properties = [...this.properties];
        this.filteredProperties = [...this.filteredProperties];
      },
      error: (error) => {
        console.error('❌ Error updating favorites:', error);
        
        // Handle 404 error gracefully for remove operations
        if (error.status === 404 && !property.isFavorite) {
          console.log('⚠️ Property was not in favorites (404), but UI updated correctly');
          this.showAlertMessage('Property removed from favorites', 'success');
          return;
        }
        
        // Revert the optimistic update on other errors
        property.isFavorite = originalState;
        if (filteredProperty) {
          filteredProperty.isFavorite = originalState;
        }
        
        // Force change detection
        this.properties = [...this.properties];
        this.filteredProperties = [...this.filteredProperties];
        
        let errorMessage = 'Failed to update favorites. Please try again.';
        if (error.status === 401) {
          errorMessage = 'You need to be logged in to manage favorites.';
        } else if (error.status === 500) {
          errorMessage = 'Server error. Please try again later.';
        }
        
        this.showAlertMessage(errorMessage, 'error');
      }
    });
    this.subscriptions.push(favSub);
  }
  
  viewProperty(propertyId: number): void {
    this.router.navigate(['/property', propertyId]);
  }
  
  showLoginAlert(): void {
    this.showAlertMessage('You need to login to access this feature', 'info');
  }
  
  logout(): void {
    Swal.fire({
      title: 'Are you sure?',
      text: 'You will be logged out of your account.',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#08227B',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes, logout'
    }).then((result) => {
      if (result.isConfirmed) {
        this.authService.logout();
        this.showAlertMessage('You have been successfully logged out', 'success');
        this.router.navigate(['/log-in']);
      }
    });
  }

  // Pagination methods
  goToPage(page: number): void {
    if (page >= 1 && page <= this.totalPages && page !== this.currentPage) {
      this.currentPage = page;
      this.loadProperties();
    }
  }

  previousPage(): void {
    if (this.currentPage > 1) {
      this.goToPage(this.currentPage - 1);
    }
  }

  nextPage(): void {
    if (this.currentPage < this.totalPages) {
      this.goToPage(this.currentPage + 1);
    }
  }

  // Helper methods
  getFirstImage(property: Property): string {
    if (property.propertyImages && property.propertyImages.length > 0) {
      return property.propertyImages[0];
    }
    return 'assets/images/apartment.avif';
  }

  formatPrice(price: number): string {
    return new Intl.NumberFormat('en-EG', {
      style: 'currency',
      currency: 'EGP',
      minimumFractionDigits: 0
    }).format(price);
  }

  getPaginationArray(): number[] {
    const pages: number[] = [];
    const start = Math.max(1, this.currentPage - 2);
    const end = Math.min(this.totalPages, this.currentPage + 2);
    
    for (let i = start; i <= end; i++) {
      pages.push(i);
    }
    
    return pages;
  }

  trackByPropertyId(index: number, property: Property): number {
    return property.propertyId;
  }

  Math = Math;

  getUserImageUrl(): string {
    return this.authService.getUserImageUrl();
  }

  onImageError(event: any): void {
    event.target.src = 'assets/images/apartment.avif';
  }

  // Additional utility methods
  refreshProperties(): void {
    this.currentPage = 1;
    this.loadProperties();
  }

  goToAddProperty(): void {
    this.router.navigate(['/add-property']);
  }

  goToFavorites(): void {
    this.router.navigate(['/favorites']);
  }

  goToChatBot(): void {
    this.router.navigate(['/chat-bot']);
  }

  getShortenedDescription(description: string, maxLength: number = 100): string {
    if (!description) return 'No description available';
    return description.length > maxLength 
      ? description.substring(0, maxLength) + '...' 
      : description;
  }

  formatListingDate(dateString: string): string {
    const date = new Date(dateString);
    const now = new Date();
    const diffTime = Math.abs(now.getTime() - date.getTime());
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    if (diffDays === 1) {
      return 'Listed today';
    } else if (diffDays <= 7) {
      return `Listed ${diffDays} days ago`;
    } else {
      return `Listed on ${date.toLocaleDateString('en-EG')}`;
    }
  }

  isNewProperty(dateString: string): boolean {
    const date = new Date(dateString);
    const now = new Date();
    const diffTime = Math.abs(now.getTime() - date.getTime());
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    return diffDays <= 7;
  }

  getPropertyStatusBadge(property: Property): string {
    if (this.isNewProperty(property.listedAt)) {
      return 'NEW';
    }
    if (property.isFavorite) {
      return 'FAVORITE';
    }
    return '';
  }

  getPropertyStatusBadgeClass(property: Property): string {
    if (this.isNewProperty(property.listedAt)) {
      return 'badge bg-success';
    }
    if (property.isFavorite) {
      return 'badge bg-danger';
    }
    return 'badge bg-secondary';
  }
  hasUserImage(): boolean {
  const userData = this.authService.getUserData();
  return !!(userData?.imageUrl);
}

getUserActualImageUrl(): string {
  const userData = this.authService.getUserData();
  return userData?.imageUrl || '';
}
}


================================================
File: app/interceptors/auth.interceptor.ts
================================================
import { HttpInterceptorFn } from '@angular/common/http';
import { inject } from '@angular/core';
import { CookieService } from 'ngx-cookie-service';

export const authInterceptor: HttpInterceptorFn = (req, next) => {
  const cookieService = inject<CookieService>(CookieService);
  const token = cookieService.get('token');
  
  // Clone the request and add the authentication header if token exists
  if (token) {
    const authReq = req.clone({
      headers: req.headers.set('Authorization', `Bearer ${token}`)
    });
    return next(authReq);
  }
  
  return next(req);
};


================================================
File: app/log-in/log-in.component.css
================================================
/* Global styles for the login component */                                                                                 
.container {
    display: flex;
    height: 100vh;
    width: 100%;
    font-family: Arial, sans-serif;
  }
  
  /* Left side - Blue background with image */
  .image-side {
    width: 60%;
    background-color: #0c2b7a; /* Deep blue color from the design */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
  }
  
  .close-button {
    position: absolute;
    top: 20px;
    right: 20px;
  }
  
  .close-btn {
    background: transparent;
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
  }
  
  .image-container {
    width: 100%;
    max-width: 400px;
    display: flex;
    justify-content: center;
  }
  
  .image-container img {
    max-width: 100%;
    height: auto;
  }
  
  /* Right side - Form inputs */
  .form-side {
    width: 50%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 40px;
  }
  
  .form-container {
    width: 100%;
    max-width: 450px;
  }
  
  .title {
    font-size: 2.5rem;
    color: #0c2b7a;
    margin-bottom: 5px;
    font-weight: bold;
  }
  
  .subtitle {
    font-size: 1.1rem;
    color: #333;
    margin-bottom: 30px;
  }
  
  .form-group {
    margin-bottom: 20px;
  }
  
  .form-control {
    width: 100%;
    padding: 15px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    font-size: 16px;
    outline: none;
    transition: border-color 0.3s;
  }
  
  .form-control:focus {
    border-color: #0c2b7a;
  }
  
  .form-control.invalid {
    border-color: #ff3860;
  }
  
  .error-message {
    color: #ff3860;
    font-size: 14px;
    margin-top: 5px;
  }
  
  .forgot-password {
    text-align: right;
    margin-bottom: 20px;
  }
  
  .forgot-password a {
    color: #0c2b7a;
    text-decoration: none;
    font-size: 0.9rem;
  }
  
  .login-btn {
    width: 100%;
    padding: 15px;
    background-color: #0c2b7a;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s;
    margin-bottom: 20px;
  }
  
  .login-btn:hover {
    background-color: #091e55;
  }
  
  .google-login {
    margin-bottom: 20px;
  }
  
  .google-btn {
    width: 100%;
    padding: 15px;
    background-color: white;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    transition: background-color 0.3s;
  }
  
  .google-btn:hover {
    background-color: #f5f5f5;
  }
  
  .google-btn img {
    width: 20px;
    height: 20px;
  }
  
  .signup-link {
    text-align: center;
    font-size: 16px;
  }
  
  .signup-link span {
    color: #666;
  }
  
  .signup-link a {
    color: #0c2b7a;
    font-weight: bold;
    text-decoration: none;
    margin-left: 5px;
  }
  
  /* Responsive design */
  @media (max-width: 768px) {
    .container {
      flex-direction: column;
    }
    
    .image-side {
      width: 70%;
      height: 30vh;
    }
    
    .form-side {
      width: 100%;
      height: 70vh;
    }
  }


================================================
File: app/log-in/log-in.component.html
================================================
<!-- Login Component HTML - Fixed disabled attributes -->
<div class="container">
    <!-- Left side (Blue background with image) -->
    <div class="image-side">
      <div class="close-button">
        <button class="close-btn" (click)="router.navigate(['/home'])">âœ•</button>
      </div>
      <div class="image-container">
        <img src="../../assets/images/login.png"  loading="lazy" width="400" height="250" alt="Property">
      </div>
    </div>
  
    <!-- Right side (Form inputs) -->
    <div class="form-side">
      <div class="form-container">
        <h1 class="title">Login here</h1>
        <p class="subtitle">Welcome back you've been missed!</p>
  
        <form (ngSubmit)="onSubmit()" [formGroup]="loginForm">
          <!-- Email input -->
          <div class="form-group">
            <input 
              type="email" 
              formControlName="email" 
              placeholder="Email"
              class="form-control"
              [ngClass]="{'invalid': submitted && f['email'].errors}"
            >
            <div *ngIf="submitted && f['email'].errors" class="error-message">
              <div *ngIf="f['email'].errors['required']">Email is required</div>
              <div *ngIf="f['email'].errors['email']">Enter a valid email</div>
            </div>
          </div>
  
          <!-- Password input -->
          <div class="form-group">
            <div class="password-input">
              <input 
                [type]="showPassword ? 'text' : 'password'" 
                formControlName="password" 
                placeholder="Password"
                class="form-control"
                [ngClass]="{'invalid': submitted && f['password'].errors}"
              >
              <div class="toggle-password" (click)="togglePasswordVisibility()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path *ngIf="!showPassword" d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <path *ngIf="showPassword" d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                  <circle *ngIf="!showPassword" cx="12" cy="12" r="3"></circle>
                  <line *ngIf="showPassword" x1="1" y1="1" x2="23" y2="23"></line>
                </svg>
              </div>
            </div>
            <div *ngIf="submitted && f['password'].errors" class="error-message">
              <div *ngIf="f['password'].errors['required']">Password is required</div>
            </div>
          </div>
  
          <!-- Forgot password link -->
          <div class="forgot-password">
            <a [routerLink]="['/forget-pass']">Forgot your password?</a>
          </div>
  
          <!-- Login button -->
          <button type="submit" class="login-btn" [disabled]="isLoading">
            <span *ngIf="!isLoading">Sign in</span>
            <span *ngIf="isLoading">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="animate-spin">
                <line x1="12" y1="2" x2="12" y2="6"></line>
                <line x1="12" y1="18" x2="12" y2="22"></line>
                <line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line>
                <line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line>
                <line x1="2" y1="12" x2="6" y2="12"></line>
                <line x1="18" y1="12" x2="22" y2="12"></line>
                <line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line>
                <line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line>
              </svg>
              Signing in...
            </span>
          </button>
        </form>
  
        <!-- Google login -->
        <div class="google-login">
          <button class="google-btn" (click)="loginWithGoogle()" [disabled]="isLoading">
            <img src="../../assets/images/google.png" alt="Google">
            Sign in with Google
          </button>
        </div>
  
        <!-- Sign up link -->
        <div class="signup-link">
          <span>Don't have an account?</span>
          <a [routerLink]="['/sign-up']">Sign up</a>
        </div>
      </div>
    </div>
  </div>
   <style>
    .animate-spin {
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      from {
        transform: rotate(0deg);
      }
      to {
        transform: rotate(360deg);
      }
    }
    
    .login-btn:disabled,
    .google-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
  </style>


================================================
File: app/log-in/log-in.component.spec.ts
================================================
import { ComponentFixture, TestBed } from '@angular/core/testing';

import { LogInComponent } from './log-in.component';

describe('LogInComponent', () => {
  let component: LogInComponent;
  let fixture: ComponentFixture<LogInComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [LogInComponent]
    })
    .compileComponents();
    
    fixture = TestBed.createComponent(LogInComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});



================================================
File: app/log-in/log-in.component.ts
================================================
import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators, ReactiveFormsModule } from '@angular/forms';
import { Router, RouterModule } from '@angular/router';
import { CommonModule } from '@angular/common';
import Swal from 'sweetalert2';
import { AuthService, LoginRequest } from '../services/auth.service';

@Component({
  selector: 'app-log-in',
  templateUrl: './log-in.component.html',
  styleUrls: ['./log-in.component.css'],
  standalone: true,
  imports: [CommonModule, ReactiveFormsModule, RouterModule]
})
export class LogInComponent implements OnInit {
  loginForm!: FormGroup;
  submitted = false;
  showPassword = false;
  isLoading = false;

  constructor(
    private formBuilder: FormBuilder,
    public router: Router,
    private authService: AuthService
  ) { }

  ngOnInit(): void {
    // Check if user is already logged in
    if (this.authService.isLoggedIn()) {
      this.router.navigate(['/home']);
      return;
    }
    
    this.loginForm = this.formBuilder.group({
      email: ['', [Validators.required, Validators.email]],
      password: ['', Validators.required]
    });
  }

  // Getter for easy access to form fields
  get f() { return this.loginForm.controls; }

  onSubmit(): void {
    this.submitted = true;

    // Stop if form is invalid
    if (this.loginForm.invalid) {
      return;
    }

    this.isLoading = true;
    this.loginForm.disable(); // ðŸ”¥ Disable form during submission

    // Prepare login request
    const loginRequest: LoginRequest = {
      email: this.loginForm.value.email,
      password: this.loginForm.value.password
    };

    // Call the login API
    this.authService.login(loginRequest).subscribe({
      next: (response) => {
        this.isLoading = false;
        this.loginForm.enable(); // ðŸ”¥ Re-enable form
        
        // Show success message
        Swal.fire({
          icon: 'success',
          title: 'Login Successful',
          text: 'Welcome back!',
          showConfirmButton: false,
          timer: 1500
        }).then(() => {
          // Navigate to home page after successful login
          this.router.navigate(['/home']);
        });
      },
      error: (error) => {
        this.isLoading = false;
        this.loginForm.enable(); // ðŸ”¥ Re-enable form on error
        console.error('Login error:', error);
        
        // Handle different types of errors
        let errorMessage = 'Login failed. Please try again.';
        
        if (error.status === 400) {
          errorMessage = 'Invalid email or password.';
        } else if (error.status === 401) {
          errorMessage = 'Invalid credentials. Please check your email and password.';
        } else if (error.status === 0) {
          errorMessage = 'Unable to connect to server. Please check your internet connection.';
        } else if (error.error && error.error.message) {
          errorMessage = error.error.message;
        }

        Swal.fire({
          icon: 'error',
          title: 'Login Failed',
          text: errorMessage,
          confirmButtonColor: '#08227B'
        });
      }
    });
  }

  togglePasswordVisibility(): void {
    this.showPassword = !this.showPassword;
  }

  loginWithGoogle(): void {
    // Google login implementation will be added later
    Swal.fire({
      icon: 'info',
      title: 'Coming Soon',
      text: 'Google login will be available in a future update.',
      confirmButtonColor: '#08227B'
    });
  }
}


================================================
File: app/models/property.model.ts
================================================



================================================
File: app/models/user.model.ts
================================================



================================================
File: app/my-properties/my-properties.component.css
================================================
/* My Properties Component Styles */

.page-title {
  font-size: 2.5rem;
  font-weight: bold;
  margin-bottom: 0.5rem;
}

.header-actions {
  display: flex;
  gap: 0.5rem;
}

/* Property Card Styles */
.property-card {
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  border: 1px solid #e9ecef;
  overflow: hidden;
}

.property-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 30px rgba(8, 34, 123, 0.15) !important;
}

.property-img {
  height: 200px;
  width: 100%;
  object-fit: cover;
}

.property-header {
  min-height: 120px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

.property-title {
  font-size: 1.1rem;
  font-weight: 600;
  color: #333;
  line-height: 1.3;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.property-details {
  background: #f8f9fa;
  border-radius: 8px;
  padding: 10px;
}

.property-details .row {
  margin: 0;
}

.property-details .col {
  padding: 0 5px;
}

/* Empty State */
.empty-state {
  max-width: 500px;
  margin: 0 auto;
  padding: 3rem 1rem;
}

/* Button Styles */
.btn-primary {
  background-color: #08227B;
  border-color: #08227B;
  font-weight: 500;
}

.btn-primary:hover {
  background-color: #061a5f;
  border-color: #061a5f;
}

.btn-outline-primary {
  color: #08227B;
  border-color: #08227B;
}

.btn-outline-primary:hover {
  background-color: #08227B;
  border-color: #08227B;
  color: white;
}

.btn-warning {
  background-color: #ffc107;
  border-color: #ffc107;
  color: #000;
}

.btn-warning:hover {
  background-color: #ffca2c;
  border-color: #ffc720;
  color: #000;
}

.btn-danger {
  background-color: #dc3545;
  border-color: #dc3545;
}

.btn-danger:hover {
  background-color: #c82333;
  border-color: #bd2130;
}

/* Badge Styles */
.badge.bg-primary {
  background-color: #08227B !important;
}

.badge.bg-success {
  background-color: #28a745 !important;
}

/* Modal Styles */
.modal {
  background: rgba(0, 0, 0, 0.5);
}

.modal.show {
  display: block !important;
}

.modal-content {
  border-radius: 15px;
  border: none;
  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
}

.modal-header {
  background: linear-gradient(135deg, #08227B, #061a5f);
  color: white;
  border-radius: 15px 15px 0 0;
  border-bottom: none;
}

.modal-title {
  font-weight: bold;
}

.btn-close {
  filter: invert(1);
}

.form-control:focus {
  border-color: #08227B;
  box-shadow: 0 0 0 0.2rem rgba(8, 34, 123, 0.25);
}

.form-select:focus {
  border-color: #08227B;
  box-shadow: 0 0 0 0.2rem rgba(8, 34, 123, 0.25);
}

.modal-backdrop {
  background: rgba(0, 0, 0, 0.5);
}

.modal-backdrop.show {
  opacity: 1;
}

/* Responsive Design */
@media (max-width: 768px) {
  .page-title {
    font-size: 2rem;
  }
  
  .header-actions {
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .property-card {
    margin-bottom: 1rem;
  }
  
  .property-header {
    min-height: auto;
  }
  
  .modal-dialog {
    margin: 10px;
  }
  
}
/* Improved Property Card Styles - أضف هذا في my-properties.component.css */

/* Property Card */
.property-card {
  border-radius: 16px;
  overflow: hidden;
  transition: all 0.3s ease;
  background: white;
  position: relative;
}

.property-card:hover {
  transform: translateY(-8px);
  box-shadow: 0 20px 40px rgba(8, 34, 123, 0.15) !important;
}

/* Image Container */
.property-image-container {
  position: relative;
  height: 220px;
  overflow: hidden;
}

.property-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s ease;
}

.property-card:hover .property-img {
  transform: scale(1.05);
}

/* Badges Overlay */
.badges-overlay {
  position: absolute;
  top: 12px;
  left: 12px;
  right: 12px;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  z-index: 2;
}

.badge {
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 0.75rem;
  font-weight: 600;
  backdrop-filter: blur(10px);
  border: none;
}

.badge-type {
  background: rgba(8, 34, 123, 0.9);
  color: white;
}

.badge-status {
  background: rgba(40, 167, 69, 0.9);
  color: white;
  display: flex;
  align-items: center;
  gap: 4px;
}

/* Action Overlay */
.action-overlay {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  display: flex;
  gap: 8px;
  opacity: 0;
  transition: opacity 0.3s ease;
  z-index: 3;
}

.property-card:hover .action-overlay {
  opacity: 1;
}

.action-btn {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  cursor: pointer;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
  color: white;
}

.action-btn:hover {
  transform: scale(1.1);
}

.btn-view {
  background: rgba(8, 34, 123, 0.9);
}

.btn-view:hover {
  background: rgba(8, 34, 123, 1);
}

.btn-edit {
  background: rgba(255, 193, 7, 0.9);
  color: #000 !important;
}

.btn-edit:hover {
  background: rgba(255, 193, 7, 1);
}

.btn-delete {
  background: rgba(220, 53, 69, 0.9);
}

.btn-delete:hover {
  background: rgba(220, 53, 69, 1);
}

.action-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

/* Property Content */
.property-content {
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 16px;
}

/* Header */
.property-header {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.property-title {
  font-size: 1.1rem;
  font-weight: 700;
  color: #2c3e50;
  margin: 0;
  line-height: 1.3;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.property-location {
  display: flex;
  align-items: center;
  gap: 6px;
  color: #7f8c8d;
  font-size: 0.9rem;
}

.property-location i {
  font-size: 0.8rem;
  color: #08227B;
}

/* Price */
.property-price {
  display: flex;
  align-items: baseline;
  gap: 4px;
}

.price-amount {
  font-size: 1.5rem;
  font-weight: 800;
  color: #08227B;
}

.price-label {
  font-size: 0.9rem;
  color: #7f8c8d;
  font-weight: 500;
}

/* Stats */
.property-stats {
  display: flex;
  justify-content: space-between;
  padding: 12px 0;
  border-top: 1px solid #ecf0f1;
  border-bottom: 1px solid #ecf0f1;
}

.stat-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  flex: 1;
  font-size: 0.85rem;
}

.stat-item i {
  font-size: 1rem;
  color: #08227B;
}

.stat-item span {
  color: #2c3e50;
  font-weight: 600;
}

/* Footer */
.property-footer {
  margin-top: auto;
}

.property-footer small {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 0.8rem;
}

.property-footer i {
  color: #08227B;
}

/* Responsive */
@media (max-width: 768px) {
  .property-image-container {
    height: 180px;
  }
  
  .property-content {
    padding: 16px;
    gap: 12px;
  }
  
  .property-title {
    font-size: 1rem;
  }
  
  .price-amount {
    font-size: 1.3rem;
  }
  
  .action-btn {
    width: 40px;
    height: 40px;
    font-size: 14px;
  }
  
  .property-stats {
    flex-wrap: wrap;
    gap: 8px;
  }
  
  .stat-item {
    flex-direction: row;
    justify-content: center;
    min-width: calc(50% - 4px);
  }
}

/* Hover Effects */
@media (hover: hover) {
  .action-overlay {
    opacity: 0;
  }
  
  .property-card:hover .action-overlay {
    opacity: 1;
  }
}

/* Touch devices - always show buttons */
@media (hover: none) {
  .action-overlay {
    opacity: 1;
    position: static;
    transform: none;
    justify-content: center;
    margin-top: 12px;
    padding-top: 12px;
    border-top: 1px solid #ecf0f1;
  }
  
  .property-content {
    padding-bottom: 12px;
  }
}


================================================
File: app/my-properties/my-properties.component.html
================================================
<!-- My Properties Component HTML -->
<div class="container py-4">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="page-title text-primary">
        <i class="bi bi-building me-2"></i>My Properties
      </h1>
      <p class="text-muted">Manage your property listings</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-outline-secondary me-2" (click)="goBack()">
        <i class="bi bi-arrow-left"></i> Back
      </button>
      <button class="btn btn-primary" (click)="goToAddProperty()">
        <i class="bi bi-plus-circle"></i> Add New Property
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3">Loading your properties...</p>
  </div>

  <!-- No Properties State -->
  <div *ngIf="!isLoading && myProperties.length === 0" class="text-center py-5">
    <div class="empty-state">
      <i class="bi bi-house-add" style="font-size: 4rem; color: #ccc;"></i>
      <h3 class="mt-3">No Properties Yet</h3>
      <p class="text-muted mb-4">You haven't added any properties yet. Start by adding your first property!</p>
      <button class="btn btn-primary btn-lg" (click)="goToAddProperty()">
        <i class="bi bi-plus-circle"></i> Add Your First Property
      </button>
    </div>
  </div>

  <!-- Properties Grid -->
  <div *ngIf="!isLoading && myProperties.length > 0" class="properties-grid">
    <div class="row g-4">
     <!-- Improved Property Card Template -->
<div class="col-lg-4 col-md-6" *ngFor="let property of myProperties; trackBy: trackByPropertyId">
  <div class="property-card h-100 border-0 shadow-sm">
    <!-- Property Image -->
    <div class="property-image-container">
      <img 
        [src]="getFirstImage(property)" 
        class="property-img" 
        [alt]="property.title"
        (error)="onImageError($event)"
        loading="lazy"
      >
      
      <!-- Badges Overlay -->
      <div class="badges-overlay">
        <span class="badge badge-type">{{ property.propertyType }}</span>
        <span class="badge badge-status">
          <i class="bi bi-check-circle"></i> Active
        </span>
      </div>
      
      <!-- Action Buttons Overlay -->
      <div class="action-overlay">
        <button 
          class="action-btn btn-view" 
          (click)="viewProperty(property.propertyId)"
          title="View Details"
        >
          <i class="bi bi-eye"></i>
        </button>
        <button 
          class="action-btn btn-edit" 
          (click)="editProperty(property)"
          [disabled]="isUpdating || isDeleting"
          title="Edit Property"
        >
          <i class="bi bi-pencil"></i>
        </button>
        <button 
          class="action-btn btn-delete" 
          (click)="deleteProperty(property)"
          [disabled]="isUpdating || isDeleting"
          title="Delete Property"
        >
          <i class="bi bi-trash"></i>
        </button>
      </div>
    </div>
    
    <!-- Property Content -->
    <div class="property-content">
      <!-- Header -->
      <div class="property-header">
        <h5 class="property-title">{{ property.title }}</h5>
        <div class="property-location">
          <i class="bi bi-geo-alt"></i>
          <span>{{ property.city }}, {{ property.governate }}</span>
        </div>
      </div>
      
      <!-- Price -->
      <div class="property-price">
        <span class="price-amount">{{ formatPrice(property.price) }}</span>
        <span class="price-label">EGP</span>
      </div>
      
      <!-- Quick Stats -->
      <div class="property-stats">
        <div class="stat-item" *ngIf="property.size > 0">
          <i class="bi bi-arrows-fullscreen"></i>
          <span>{{ property.size }} mÂ²</span>
        </div>
        <div class="stat-item" *ngIf="property.bedrooms > 0">
          <i class="bi bi-door-closed"></i>
          <span>{{ property.bedrooms }} beds</span>
        </div>
        <div class="stat-item" *ngIf="property.bathrooms > 0">
          <i class="bi bi-droplet"></i>
          <span>{{ property.bathrooms }} baths</span>
        </div>
      </div>
      
      <!-- Listed Date -->
      <div class="property-footer">
        <small class="text-muted">
          <i class="bi bi-calendar3"></i>
          Listed {{ formatDate(property.listedAt) }}
        </small>
      </div>
    </div>
  </div>
</div>
      </div>
    </div>
    
    <!-- Summary -->
    <div class="text-center mt-4 pt-3 border-top">
      <p class="text-muted">
        <i class="bi bi-info-circle"></i>
        You have {{ myProperties.length }} {{ myProperties.length === 1 ? 'property' : 'properties' }} listed
      </p>
    </div>
  </div>

<!-- Edit Property Modal -->
<div class="modal" [class.show]="showEditModal" [style.display]="showEditModal ? 'block' : 'none'">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title text-primary">
          <i class="bi bi-pencil-square"></i> Edit Property
        </h5>
        <button type="button" class="btn-close" (click)="closeEditModal()"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="editForm" (ngSubmit)="onUpdateProperty()">
          <!-- Basic Information -->
          <div class="row">
            <div class="col-md-8">
              <div class="mb-3">
                <label for="editTitle" class="form-label">Property Title *</label>
                <input 
                  type="text" 
                  id="editTitle"
                  formControlName="title" 
                  class="form-control"
                  [class.is-invalid]="editForm.get('title')?.invalid && editForm.get('title')?.touched"
                >
                <div *ngIf="editForm.get('title')?.invalid && editForm.get('title')?.touched" class="invalid-feedback">
                  <div *ngIf="editForm.get('title')?.errors?.['required']">Title is required</div>
                  <div *ngIf="editForm.get('title')?.errors?.['minlength']">Title must be at least 3 characters</div>
                </div>
              </div>
            </div>
            
            <div class="col-md-4">
              <div class="mb-3">
                <label for="editPrice" class="form-label">Price (EGP) *</label>
                <input 
                  type="number" 
                  id="editPrice"
                  formControlName="price" 
                  class="form-control"
                  [class.is-invalid]="editForm.get('price')?.invalid && editForm.get('price')?.touched"
                >
                <div *ngIf="editForm.get('price')?.invalid && editForm.get('price')?.touched" class="invalid-feedback">
                  Price is required and must be greater than 0
                </div>
              </div>
            </div>
          </div>

          <div class="mb-3">
            <label for="editDescription" class="form-label">Description *</label>
            <textarea 
              id="editDescription"
              formControlName="description" 
              class="form-control"
              rows="3"
              [class.is-invalid]="editForm.get('description')?.invalid && editForm.get('description')?.touched"
            ></textarea>
            <div *ngIf="editForm.get('description')?.invalid && editForm.get('description')?.touched" class="invalid-feedback">
              Description is required (minimum 10 characters)
            </div>
          </div>

          <!-- Property Details -->
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="editPropertyType" class="form-label">Property Type *</label>
                <select 
                  id="editPropertyType"
                  formControlName="propertyType" 
                  class="form-select"
                  [class.is-invalid]="editForm.get('propertyType')?.invalid && editForm.get('propertyType')?.touched"
                >
                  <option value="">Select property type</option>
                  <option *ngFor="let type of propertyTypes" [value]="type">{{ type }}</option>
                </select>
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="mb-3">
                <label for="editSize" class="form-label">Size (mÂ²) *</label>
                <input 
                  type="number" 
                  id="editSize"
                  formControlName="size" 
                  class="form-control"
                  [class.is-invalid]="editForm.get('size')?.invalid && editForm.get('size')?.touched"
                >
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="editBedrooms" class="form-label">Bedrooms *</label>
                <input 
                  type="number" 
                  id="editBedrooms"
                  formControlName="bedrooms" 
                  class="form-control"
                  min="0"
                  [class.is-invalid]="editForm.get('bedrooms')?.invalid && editForm.get('bedrooms')?.touched"
                >
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="mb-3">
                <label for="editBathrooms" class="form-label">Bathrooms *</label>
                <input 
                  type="number" 
                  id="editBathrooms"
                  formControlName="bathrooms" 
                  class="form-control"
                  min="1"
                  [class.is-invalid]="editForm.get('bathrooms')?.invalid && editForm.get('bathrooms')?.touched"
                >
              </div>
            </div>
          </div>

          <!-- Location -->
          <div class="row">
            <div class="col-md-4">
              <div class="mb-3">
                <label for="editGovernate" class="form-label">Governorate *</label>
                <select 
                  id="editGovernate"
                  formControlName="governate" 
                  class="form-select"
                  [class.is-invalid]="editForm.get('governate')?.invalid && editForm.get('governate')?.touched"
                >
                  <option value="">Select governorate</option>
                  <option *ngFor="let gov of governorates" [value]="gov">{{ gov }}</option>
                </select>
              </div>
            </div>
            
            <div class="col-md-4">
              <div class="mb-3">
                <label for="editCity" class="form-label">City *</label>
                <select 
                  id="editCity"
                  formControlName="city" 
                  class="form-select"
                  [class.is-invalid]="editForm.get('city')?.invalid && editForm.get('city')?.touched"
                >
                  <option value="">Select city</option>
                  <option *ngFor="let city of cities" [value]="city">{{ city }}</option>
                </select>
              </div>
            </div>
            
            <div class="col-md-4">
              <div class="mb-3">
                <label for="editStreet" class="form-label">Street Address *</label>
                <input 
                  type="text" 
                  id="editStreet"
                  formControlName="street" 
                  class="form-control"
                  [class.is-invalid]="editForm.get('street')?.invalid && editForm.get('street')?.touched"
                >
              </div>
            </div>
          </div>

          <!-- Location URL -->
          <div class="mb-3">
            <label for="editLocationUrl" class="form-label">Location URL (Optional)</label>
            <input 
              type="url" 
              id="editLocationUrl"
              formControlName="locationUrl" 
              class="form-control"
              placeholder="https://maps.google.com/..."
            >
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeEditModal()">Cancel</button>
        <button 
          type="button" 
          class="btn btn-primary"
          [disabled]="editForm.invalid || isUpdating"
          (click)="onUpdateProperty()"
        >
          <span *ngIf="!isUpdating">
            <i class="bi bi-check-circle"></i> Update Property
          </span>
          <span *ngIf="isUpdating">
            <span class="spinner-border spinner-border-sm me-2"></span>
            Updating...
          </span>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Backdrop -->
<div class="modal-backdrop" 
     [class.show]="showEditModal" 
     [style.display]="showEditModal ? 'block' : 'none'"
     (click)="closeEditModal()">
</div>


================================================
File: app/my-properties/my-properties.component.spec.ts
================================================
import { ComponentFixture, TestBed } from '@angular/core/testing';

import { MyPropertiesComponent } from './my-properties.component';

describe('MyPropertiesComponent', () => {
  let component: MyPropertiesComponent;
  let fixture: ComponentFixture<MyPropertiesComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [MyPropertiesComponent]
    })
    .compileComponents();
    
    fixture = TestBed.createComponent(MyPropertiesComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});



================================================
File: app/my-properties/my-properties.component.ts
================================================
import { Component, OnInit, OnDestroy } from '@angular/core';
import { CommonModule } from '@angular/common';
import { RouterModule, Router } from '@angular/router';
import { ReactiveFormsModule, FormBuilder, FormGroup, Validators } from '@angular/forms';
import { Subscription } from 'rxjs';
import { PropertyService, Property } from '../services/property.service';
import { AuthService } from '../services/auth.service';
import Swal from 'sweetalert2';

@Component({
  selector: 'app-my-properties',
  standalone: true,
  imports: [CommonModule, RouterModule, ReactiveFormsModule],
  templateUrl: './my-properties.component.html',
  styleUrls: ['./my-properties.component.css']
})
export class MyPropertiesComponent implements OnInit, OnDestroy {
  myProperties: Property[] = [];
  isLoading = true;
  isUpdating = false;
  isDeleting = false;
  showEditModal = false;
  editForm!: FormGroup;
  selectedProperty?: Property;
  
  // Property types
  propertyTypes = ['Apartment', 'House', 'Villa', 'Office', 'Commercial', 'Land'];
  
  // Egyptian cities
  cities = [
    'Cairo', 'Alexandria', 'Giza', 'Shubra El Kheima', 'Port Said',
    'Suez', 'Luxor', 'Mansoura', 'El Mahalla El Kubra', 'Tanta',
    'Asyut', 'Ismailia', 'Fayyum', 'Zagazig', 'Aswan',
    'Damietta', 'Damanhur', 'Minya', 'Beni Suef', 'Qena',
    'Sohag', 'Hurghada', 'Sharm El Sheikh'
  ];
  
  // Governorates
  governorates = [
    'Cairo', 'Alexandria', 'Giza', 'Qalyubia', 'Port Said',
    'Suez', 'Luxor', 'Dakahlia', 'Gharbia', 'Monufia',
    'Asyut', 'Ismailia', 'Fayyum', 'Sharqia', 'Aswan',
    'Damietta', 'Beheira', 'Minya', 'Beni Suef', 'Qena',
    'Sohag', 'Red Sea', 'South Sinai', 'North Sinai', 'Matrouh'
  ];
  
  private subscriptions: Subscription[] = [];

  constructor(
    private router: Router,
    private propertyService: PropertyService,
    private authService: AuthService,
    private formBuilder: FormBuilder
  ) {}

  ngOnInit(): void {
    // Check authentication
    if (!this.authService.isLoggedIn()) {
      this.router.navigate(['/log-in']);
      return;
    }

    this.initializeEditForm();
    this.loadMyProperties();
  }

  ngOnDestroy(): void {
    this.subscriptions.forEach(sub => sub.unsubscribe());
  }

  initializeEditForm(): void {
    this.editForm = this.formBuilder.group({
      title: ['', [Validators.required, Validators.minLength(3)]],
      description: ['', [Validators.required, Validators.minLength(10)]],
      price: ['', [Validators.required, Validators.min(1)]],
      propertyType: ['', Validators.required],
      size: ['', [Validators.required, Validators.min(1)]],
      bedrooms: ['', [Validators.required, Validators.min(0)]],
      bathrooms: ['', [Validators.required, Validators.min(1)]],
      street: ['', Validators.required],
      city: ['', Validators.required],
      governate: ['', Validators.required],
      locationUrl: [''],
      listingType: ['For Sale']
    });
  }

  loadMyProperties(): void {
    this.isLoading = true;
    console.log('🔍 Loading user properties...');
    
    const propertiesSub = this.propertyService.getUserProperties().subscribe({
      next: (properties) => {
        console.log('✅ User properties loaded:', properties);
        this.myProperties = properties;
        this.isLoading = false;
      },
      error: (error) => {
        console.error('❌ Error loading user properties:', error);
        this.isLoading = false;
        
        // Show error message
        Swal.fire({
          icon: 'error',
          title: 'Failed to Load Properties',
          text: 'Unable to load your properties. Please try again.',
          confirmButtonColor: '#08227B'
        });
      }
    });
    
    this.subscriptions.push(propertiesSub);
  }

  viewProperty(propertyId: number): void {
    this.router.navigate(['/property', propertyId]);
  }

  editProperty(property: Property): void {
    this.selectedProperty = property;
    
    // Populate the form with property data
    this.editForm.patchValue({
      title: property.title,
      description: property.description,
      price: property.price,
      propertyType: property.propertyType,
      size: property.size,
      bedrooms: property.bedrooms,
      bathrooms: property.bathrooms,
      street: property.street,
      city: property.city,
      governate: property.governate,
      locationUrl: '', // API doesn't return this field
      listingType: 'For Sale' // Default value
    });
    
    this.showEditModal = true;
  }

  onUpdateProperty(): void {
    if (this.editForm.invalid || !this.selectedProperty) {
      Object.keys(this.editForm.controls).forEach(key => {
        this.editForm.get(key)?.markAsTouched();
      });
      return;
    }

    this.isUpdating = true;
    
    const updateData = {
      ...this.editForm.value,
      userId: this.authService.getUserData()?.userId || 1
    };

    console.log('🔄 Updating property:', this.selectedProperty.propertyId, updateData);

    const updateSub = this.propertyService.updateProperty(this.selectedProperty.propertyId, updateData).subscribe({
      next: (response) => {
        console.log('✅ Property updated successfully:', response);
        this.isUpdating = false;
        this.showEditModal = false;
        
        Swal.fire({
          icon: 'success',
          title: 'Property Updated',
          text: 'Your property has been updated successfully!',
          showConfirmButton: false,
          timer: 1500
        });
        
        // Reload properties
        this.loadMyProperties();
      },
      error: (error) => {
        console.error('❌ Error updating property:', error);
        this.isUpdating = false;
        
        let errorMessage = 'Failed to update property. Please try again.';
        if (error.error && error.error.message) {
          errorMessage = error.error.message;
        } else if (error.status === 404) {
          errorMessage = 'Property not found or you do not have permission to edit it.';
        } else if (error.status === 401) {
          errorMessage = 'You need to be logged in to edit properties.';
        }

        Swal.fire({
          icon: 'error',
          title: 'Update Failed',
          text: errorMessage,
          confirmButtonColor: '#08227B'
        });
      }
    });

    this.subscriptions.push(updateSub);
  }

  deleteProperty(property: Property): void {
    Swal.fire({
      title: 'Delete Property?',
      text: `Are you sure you want to delete "${property.title}"? This action cannot be undone.`,
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#d33',
      cancelButtonColor: '#6c757d',
      confirmButtonText: 'Yes, delete it!',
      cancelButtonText: 'Cancel'
    }).then((result) => {
      if (result.isConfirmed) {
        this.performDelete(property);
      }
    });
  }

  private performDelete(property: Property): void {
    this.isDeleting = true;
    console.log('🗑️ Deleting property:', property.propertyId);

    const deleteSub = this.propertyService.deleteProperty(property.propertyId).subscribe({
      next: (response) => {
        console.log('✅ Property deleted successfully:', response);
        this.isDeleting = false;
        
        // Remove from local array
        this.myProperties = this.myProperties.filter(p => p.propertyId !== property.propertyId);
        
        Swal.fire({
          icon: 'success',
          title: 'Property Deleted',
          text: 'Your property has been deleted successfully.',
          showConfirmButton: false,
          timer: 1500
        });
      },
      error: (error) => {
        console.error('❌ Error deleting property:', error);
        this.isDeleting = false;
        
        let errorMessage = 'Failed to delete property. Please try again.';
        if (error.status === 404) {
          errorMessage = 'Property not found or already deleted.';
        } else if (error.status === 401) {
          errorMessage = 'You do not have permission to delete this property.';
        }

        Swal.fire({
          icon: 'error',
          title: 'Delete Failed',
          text: errorMessage,
          confirmButtonColor: '#08227B'
        });
      }
    });

    this.subscriptions.push(deleteSub);
  }

  closeEditModal(): void {
    this.showEditModal = false;
    this.selectedProperty = undefined;
    this.editForm.reset();
  }

  goBack(): void {
    this.router.navigate(['/home']);
  }

  goToAddProperty(): void {
    this.router.navigate(['/add-property']);
  }

  // Helper methods
  getFirstImage(property: Property): string {
    if (property.propertyImages && property.propertyImages.length > 0) {
      return property.propertyImages[0];
    }
    return 'assets/images/apartment.avif';
  }

  formatPrice(price: number): string {
    return new Intl.NumberFormat('en-EG', {
      style: 'currency',
      currency: 'EGP',
      minimumFractionDigits: 0
    }).format(price);
  }

  formatDate(dateString: string): string {
    return new Date(dateString).toLocaleDateString('en-EG', {
      year: 'numeric',
      month: 'short',
      day: 'numeric'
    });
  }

  onImageError(event: any): void {
    event.target.src = 'assets/images/apartment.avif';
  }

  trackByPropertyId(index: number, property: Property): number {
    return property.propertyId;
  }

  // Getter for form controls
  get f() { return this.editForm.controls; }
}


================================================
File: app/otp-verification/otp-verification.component.css
================================================
.container {
    display: flex;
    height: 100vh;
    width: 100%;
    font-family: Arial, sans-serif;
  }
  
  /* Left side - Form inputs */
  .form-side {
    width: 50%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 40px;
  }
  
  .form-container {
    width: 100%;
    max-width: 450px;
  }
  
  .title {
    font-size: 2.5rem;
    color: #0c2b7a;
    margin-bottom: 10px;
    font-weight: bold;
  }
  
  .subtitle {
    font-size: 1rem;
    color: #666;
    margin-bottom: 40px;
    line-height: 1.5;
  }
  
  /* Progress steps */
  .steps-container {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 50px;
  }
  
  .step {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #e0e0e0;
    position: relative;
  }
  
  .step.active {
    background-color: #0c2b7a;
  }
  
  .step.completed {
    background-color: #0c2b7a;
  }
  
  .step-number {
    color: #fff;
    font-weight: bold;
  }
  
  .step-line {
    flex-grow: 1;
    height: 2px;
    background-color: #e0e0e0;
    margin: 0 10px;
    max-width: 80px;
  }
  
  .step-line.completed {
    background-color: #0c2b7a;
  }
  
  /* OTP input styles */
  .otp-container {
    display: flex;
    justify-content: space-between;
    margin-bottom: 30px;
  }
  
  .otp-input {
    width: 60px;
    height: 60px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    font-size: 24px;
    text-align: center;
    background-color: #f5f8ff;
    outline: none;
    margin: 0 5px;
  }
  
  .otp-input:focus {
    border-color: #0c2b7a;
  }
  
  .reset-btn {
    width: 100%;
    padding: 15px;
    background-color: #0c2b7a;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s;
    margin-bottom: 20px;
  }
  
  .reset-btn:hover:not(:disabled) {
    background-color: #091e55;
  }
  
  .reset-btn:disabled {
    background-color: #8e9bbc;
    cursor: not-allowed;
  }
  
  .resend-container {
    text-align: center;
    margin-top: 20px;
  }
  
  .resend-btn {
    background: none;
    border: none;
    color: #4285f4;
    cursor: pointer;
    font-weight: bold;
    text-decoration: underline;
  }
  
  .resend-btn:disabled {
    color: #999;
    cursor: not-allowed;
  }
  
  .error-message {
    color: #ff3860;
    font-size: 14px;
    margin-bottom: 15px;
  }
  
  .text-center {
    text-align: center;
  }
  
  /* Right side - Blue background with image */
  .image-side {
    width: 50%;
    background-color: #0c2b7a;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
  }
  
  .close-button {
    position: absolute;
    top: 20px;
    right: 20px;
  }
  
  .close-btn {
    background: transparent;
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
  }
  
  .image-container {
    width: 80%;
    max-width: 500px;
    display: flex;
    justify-content: center;
  }
  
  .image-container img {
    max-width: 100%;
    height: auto;
  }
  
  /* Responsive design */
  @media (max-width: 768px) {
    .container {
      flex-direction: column-reverse;
    }
    
    .image-side {
      width: 100%;
      height: 30vh;
    }
    
    .form-side {
      width: 100%;
      height: 70vh;
    }
    
    .otp-input {
      width: 45px;
      height: 45px;
      font-size: 18px;
      margin: 0 2px;
    }
  }


================================================
File: app/otp-verification/otp-verification.component.html
================================================
<div class="container">
    <!-- Right side (Blue background with image) -->
    <div class="image-side">
      <div class="close-button">
        <button class="close-btn">âœ•</button>
      </div>
      <div class="image-container">
        <img src="../../assets/images/otp.png" alt="OTP verification illustration">
      </div>
    </div>
  
    <!-- Left side (Form inputs) -->
    <div class="form-side">
      <div class="form-container">
        <h1 class="title">Enter OTP</h1>
        <p class="subtitle">Enter the OTP code we just sent<br>you on your registered Email/Phone number</p>
  
        <!-- Progress steps -->
        <div class="steps-container">
          <div class="step completed">
            <div class="step-number">1</div>
          </div>
          <div class="step-line completed"></div>
          <div class="step active">
            <div class="step-number">2</div>
          </div>
          <div class="step-line"></div>
          <div class="step">
            <div class="step-number">3</div>
          </div>
        </div>
  
        <form (ngSubmit)="onSubmit()" [formGroup]="otpForm">
          <!-- OTP input - Updated to 6 digits -->
          <div class="otp-container">
            <input 
              type="text" 
              maxlength="1" 
              formControlName="digit1" 
              class="otp-input"
              (keyup)="moveToNext($event, 2)"
              #digit1
            >
            <input 
              type="text" 
              maxlength="1" 
              formControlName="digit2" 
              class="otp-input"
              (keyup)="moveToNext($event, 3)"
              #digit2
            >
            <input 
              type="text" 
              maxlength="1" 
              formControlName="digit3" 
              class="otp-input"
              (keyup)="moveToNext($event, 4)"
              #digit3
            >
            <input 
              type="text" 
              maxlength="1" 
              formControlName="digit4" 
              class="otp-input"
              (keyup)="moveToNext($event, 5)"
              #digit4
            >
            <input 
              type="text" 
              maxlength="1" 
              formControlName="digit5" 
              class="otp-input"
              (keyup)="moveToNext($event, 6)"
              #digit5
            >
            <input 
              type="text" 
              maxlength="1" 
              formControlName="digit6" 
              class="otp-input"
              (keyup)="moveToNext($event, 0)"
              #digit6
            >
          </div>
          
          <div *ngIf="otpError" class="error-message text-center">
            {{ otpError }}
          </div>
          
          <!-- Submit button -->
          <button type="submit" class="reset-btn" [disabled]="!isOtpComplete()">Reset Password</button>
        </form>
  
        <!-- Resend OTP link -->
        <div class="resend-container">
          <span>Didn't get OTP? </span>
          <button type="button" class="resend-btn" [disabled]="countdown > 0" (click)="resendOtp()">
            {{ countdown > 0 ? 'Resend OTP in ' + countdown + 's' : 'Resend OTP' }}
          </button>
        </div>
      </div>
    </div>
  </div>


================================================
File: app/otp-verification/otp-verification.component.spec.ts
================================================
import { ComponentFixture, TestBed } from '@angular/core/testing';

import { OtpVerificationComponent } from './otp-verification.component';

describe('OtpVerificationComponent', () => {
  let component: OtpVerificationComponent;
  let fixture: ComponentFixture<OtpVerificationComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [OtpVerificationComponent]
    })
    .compileComponents();
    
    fixture = TestBed.createComponent(OtpVerificationComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});



================================================
File: app/otp-verification/otp-verification.component.ts
================================================
import { Component, OnInit, OnDestroy, ViewChild, ElementRef } from '@angular/core';
import { FormBuilder, FormGroup, Validators, ReactiveFormsModule } from '@angular/forms';
import { Router, ActivatedRoute, RouterModule } from '@angular/router';
import { CommonModule } from '@angular/common';
import { interval, Subscription } from 'rxjs';
import { take } from 'rxjs/operators';
import Swal from 'sweetalert2';
import { AuthService, VerifyOtpRequest, ResendOtpRequest, ResendEmailConfirmationOtpRequest } from '../services/auth.service';

@Component({
  selector: 'app-otp-verification',
  templateUrl: './otp-verification.component.html',
  styleUrls: ['./otp-verification.component.css'],
  standalone: true,
  imports: [CommonModule, ReactiveFormsModule, RouterModule]
})
export class OtpVerificationComponent implements OnInit, OnDestroy {
  @ViewChild('digit1') digit1!: ElementRef;
  @ViewChild('digit2') digit2!: ElementRef;
  @ViewChild('digit3') digit3!: ElementRef;
  @ViewChild('digit4') digit4!: ElementRef;
  @ViewChild('digit5') digit5!: ElementRef;
  @ViewChild('digit6') digit6!: ElementRef;
  
  otpForm!: FormGroup;
  email: string = '';
  otpType: string = ''; // 'signup' or 'forgot-password'
  otpError: string = '';
  countdown: number = 60;
  isLoading: boolean = false;
  isResending: boolean = false;
  countdownSubscription?: Subscription;

  constructor(
    private formBuilder: FormBuilder,
    private router: Router,
    private route: ActivatedRoute,
    private authService: AuthService
  ) { }

  ngOnInit(): void {
    // Initialize form with 6 digits
    this.otpForm = this.formBuilder.group({
      digit1: ['', [Validators.required, Validators.pattern('^[0-9]$')]],
      digit2: ['', [Validators.required, Validators.pattern('^[0-9]$')]],
      digit3: ['', [Validators.required, Validators.pattern('^[0-9]$')]],
      digit4: ['', [Validators.required, Validators.pattern('^[0-9]$')]],
      digit5: ['', [Validators.required, Validators.pattern('^[0-9]$')]],
      digit6: ['', [Validators.required, Validators.pattern('^[0-9]$')]]
    });

    // Get email and type from route parameters
    this.route.queryParams.subscribe(params => {
      this.email = params['contact'] || params['email'] || '';
      this.otpType = params['type'] || 'forgot-password'; // default to forgot-password
      
      if (!this.email) {
        // No email provided, redirect based on type
        if (this.otpType === 'signup') {
          this.router.navigate(['/sign-up']);
        } else {
          this.router.navigate(['/forget-pass']);
        }
      }
    });

    this.startCountdown();
  }

  ngAfterViewInit() {
    setTimeout(() => {
      if (this.digit1) {
        this.digit1.nativeElement.focus();
      }
    }, 0);
  }

  ngOnDestroy() {
    if (this.countdownSubscription) {
      this.countdownSubscription.unsubscribe();
    }
  }

  startCountdown() {
    this.countdown = 60;
    if (this.countdownSubscription) {
      this.countdownSubscription.unsubscribe();
    }
    
    this.countdownSubscription = interval(1000)
      .pipe(take(60))
      .subscribe(() => {
        this.countdown--;
        if (this.countdown === 0) {
          if (this.countdownSubscription) {
            this.countdownSubscription.unsubscribe();
          }
        }
      });
  }

  moveToNext(event: any, nextIndex: number) {
    const input = event.target;
    const value = input.value;
    
    if (value.length === 1) {
      // Move focus to the next input
      if (nextIndex > 0 && nextIndex <= 6) {
        const nextInput = this.getDigitElementByIndex(nextIndex);
        if (nextInput) {
          nextInput.nativeElement.focus();
        }
      }
    } else if (value.length === 0 && event.key === 'Backspace') {
      // Move focus to the previous input on backspace
      const prevIndex = nextIndex - 2;
      if (prevIndex >= 1 && prevIndex <= 6) {
        const prevInput = this.getDigitElementByIndex(prevIndex);
        if (prevInput) {
          prevInput.nativeElement.focus();
        }
      }
    }
    
    // Clear any previous errors
    this.otpError = '';
  }
  
  getDigitElementByIndex(index: number): ElementRef | null {
    switch (index) {
      case 1: return this.digit1;
      case 2: return this.digit2;
      case 3: return this.digit3;
      case 4: return this.digit4;
      case 5: return this.digit5;
      case 6: return this.digit6;
      default: return null;
    }
  }

  isOtpComplete(): boolean {
    const { digit1, digit2, digit3, digit4, digit5, digit6 } = this.otpForm.value;
    return !!digit1 && !!digit2 && !!digit3 && !!digit4 && !!digit5 && !!digit6;
  }

  resendOtp() {
    if (this.countdown === 0 && !this.isResending) {
      this.isResending = true;
      
      // Use the correct resend endpoint based on OTP type
      const resendObservable = this.otpType === 'signup' 
        ? this.authService.resendEmailConfirmationOtp({ email: this.email } as ResendEmailConfirmationOtpRequest)
        : this.authService.resendOtp({ email: this.email } as ResendOtpRequest);

      resendObservable.subscribe({
        next: (response) => {
          this.isResending = false;
          this.startCountdown();
          Swal.fire({
            icon: 'success',
            title: 'OTP Resent',
            text: 'A new OTP has been sent to your email.',
            showConfirmButton: false,
            timer: 2000
          });
        },
        error: (error) => {
          this.isResending = false;
          console.error('Resend OTP error:', error);
          Swal.fire({
            icon: 'error',
            title: 'Resend Failed',
            text: 'Failed to resend OTP. Please try again.',
            confirmButtonColor: '#08227B'
          });
        }
      });
    }
  }

  onSubmit(): void {
    if (this.otpForm.invalid || !this.isOtpComplete()) {
      this.otpError = 'Please enter all 6 digits';
      return;
    }

    this.isLoading = true;
    this.otpError = '';

    const { digit1, digit2, digit3, digit4, digit5, digit6 } = this.otpForm.value;
    const otp = `${digit1}${digit2}${digit3}${digit4}${digit5}${digit6}`;
    
    // Prepare verify OTP request
    const verifyRequest: VerifyOtpRequest = {
      email: this.email,
      otp: otp
    };

    // Call verify OTP API
    this.authService.verifyOtp(verifyRequest).subscribe({
      next: (response) => {
        this.isLoading = false;
        
        if (response.status === 'Success') {
          if (this.otpType === 'signup') {
            // For signup verification
            Swal.fire({
              icon: 'success',
              title: 'Account Verified',
              text: 'Your account has been verified successfully! You can now log in.',
              confirmButtonColor: '#08227B'
            }).then(() => {
              // Navigate to login page
              this.router.navigate(['/log-in']);
            });
          } else {
            // For password reset verification
            Swal.fire({
              icon: 'success',
              title: 'OTP Verified',
              text: 'OTP verified successfully! You can now reset your password.',
              confirmButtonColor: '#08227B'
            }).then(() => {
              // Navigate to reset password page
              this.router.navigate(['/reset-password'], { 
                queryParams: { email: this.email, verified: 'true' } 
              });
            });
          }
        } else {
          this.otpError = response.message || 'Invalid OTP. Please try again.';
        }
      },
      error: (error) => {
        this.isLoading = false;
        console.error('Verify OTP error:', error);
        
        let errorMessage = 'Invalid OTP. Please try again.';
        if (error.message) {
          errorMessage = error.message;
        } else if (error.status === 400) {
          errorMessage = 'Invalid OTP format or expired OTP.';
        }
        
        this.otpError = errorMessage;
      }
    });
  }

  // Clear form and start over
  clearForm(): void {
    this.otpForm.reset();
    this.otpError = '';
    if (this.digit1) {
      this.digit1.nativeElement.focus();
    }
  }

  // Go back to previous page
  goBack(): void {
    if (this.otpType === 'signup') {
      this.router.navigate(['/sign-up']);
    } else {
      this.router.navigate(['/forget-pass']);
    }
  }

  // Get page title based on type
  getPageTitle(): string {
    return this.otpType === 'signup' ? 'Verify Your Account' : 'Enter OTP';
  }

  // Get page subtitle based on type
  getPageSubtitle(): string {
    if (this.otpType === 'signup') {
      return 'Enter the 6-digit verification code we sent to your email to activate your account';
    } else {
      return 'Enter the 6-digit OTP code we just sent you on your registered Email/Phone number';
    }
  }
}


================================================
File: app/payment/payment.component.css
================================================
.payment-container {
  max-width: 500px;
  margin: 0 auto;
  padding: 30px;
  background: white;
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

.payment-header {
  text-align: center;
  margin-bottom: 30px;
}

.payment-header h4 {
  color: #08227B;
  margin-bottom: 8px;
  font-weight: 600;
}

.payment-amount {
  margin-bottom: 25px;
}

.amount-card {
  background: #f8f9fa;
  padding: 20px;
  border-radius: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border: 2px solid #e9ecef;
}

.amount-label {
  font-weight: 500;
  color: #495057;
}

.amount-value {
  font-size: 24px;
  font-weight: bold;
  color: #28a745;
}

.card-section {
  margin-bottom: 25px;
}

.card-section label {
  display: block;
  margin-bottom: 10px;
  font-weight: 600;
  color: #333;
}

.stripe-card {
  padding: 15px;
  border: 2px solid #e1e5e9;
  border-radius: 8px;
  background: white;
  transition: border-color 0.3s ease;
  min-height: 50px;
}

.stripe-card:focus-within {
  border-color: #08227B;
  box-shadow: 0 0 0 3px rgba(8, 34, 123, 0.1);
}

.error-message {
  color: #dc3545;
  font-size: 14px;
  margin-top: 10px;
  min-height: 20px;
}

.payment-actions {
  display: flex;
  gap: 15px;
  margin-bottom: 20px;
}

.btn {
  padding: 12px 24px;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  min-height: 48px;
}

.btn-secondary {
  background: #6c757d;
  color: white;
  flex: 1;
}

.btn-secondary:hover:not(:disabled) {
  background: #5a6268;
}

.btn-primary {
  background: #08227B;
  color: white;
  flex: 2;
}

.btn-primary:hover:not(:disabled) {
  background: #061a5f;
}

.btn:disabled {
  background: #e9ecef;
  color: #6c757d;
  cursor: not-allowed;
}

.security-notice {
  text-align: center;
  padding: 15px;
  background: #d4edda;
  border: 1px solid #c3e6cb;
  border-radius: 8px;
  color: #155724;
  font-size: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.debug-info {
  border: 1px solid #ddd;
  font-family: monospace;
  background: #f8f9fa;
}

/* Stripe Elements Styling */
#card-element {
  padding: 15px;
}

.StripeElement {
  height: 40px;
  padding: 10px 12px;
  background-color: white;
  border: 1px solid transparent;
  border-radius: 4px;
}

.StripeElement--focus {
  border-color: #08227B;
  box-shadow: 0 0 0 3px rgba(8, 34, 123, 0.1);
}

.StripeElement--invalid {
  border-color: #dc3545;
}

.StripeElement--complete {
  border-color: #28a745;
}

/* Form Controls */
.form-control {
  display: block;
  width: 100%;
  padding: 0.375rem 0.75rem;
  font-size: 1rem;
  font-weight: 400;
  line-height: 1.5;
  color: #212529;
  background-color: #fff;
  background-image: none;
  border: 1px solid #ced4da;
  border-radius: 0.25rem;
  transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
}

.form-control:focus {
  color: #212529;
  background-color: #fff;
  border-color: #08227B;
  outline: 0;
  box-shadow: 0 0 0 0.2rem rgba(8, 34, 123, 0.25);
}

/* Debug Buttons */
.btn-sm {
  padding: 0.25rem 0.5rem;
  font-size: 0.875rem;
  border-radius: 0.2rem;
}

.btn-warning {
  color: #212529;
  background-color: #ffc107;
  border-color: #ffc107;
}

.btn-warning:hover {
  background-color: #ffca2c;
  border-color: #ffc720;
}

.btn-info {
  color: #fff;
  background-color: #17a2b8;
  border-color: #17a2b8;
}

.btn-info:hover {
  background-color: #138496;
  border-color: #117a8b;
}

/* Responsive Design */
@media (max-width: 768px) {
  .payment-container {
    padding: 20px;
    margin: 10px;
  }

  .payment-actions {
    flex-direction: column;
  }

  .amount-card {
    flex-direction: column;
    gap: 10px;
    text-align: center;
  }

  .debug-info {
    font-size: 0.8rem;
  }
}

/* Loading Animation */
.spinner-border-sm {
  width: 1rem;
  height: 1rem;
}

@keyframes spinner-border {
  to {
    transform: rotate(360deg);
  }
}

.spinner-border {
  display: inline-block;
  width: 2rem;
  height: 2rem;
  vertical-align: text-bottom;
  border: 0.25em solid currentColor;
  border-right-color: transparent;
  border-radius: 50%;
  animation: spinner-border 0.75s linear infinite;
}


================================================
File: app/payment/payment.component.html
================================================
<div class="payment-container" *ngIf="showPayment">
  <!-- Payment Header -->
  <div class="payment-header">
    <h4>Complete Your Payment</h4>
    <p class="text-muted">Secure payment powered by Stripe</p>
  </div>

  <!-- Payment Amount -->
  <div class="payment-amount">
    <div class="amount-card">
      <span class="amount-label">Property Listing Fee:</span>
      <span class="amount-value">${{ paymentAmount }}</span>
    </div>
  </div>

  <!-- Stripe Card Element -->
  <div class="card-section">
    <label for="card-element-stripe">Credit or Debit Card</label>
    <div id="card-element" class="stripe-card" role="textbox" aria-label="Credit or debit card input">
      <!-- Stripe Elements Ø³ÙŠØ¶Ø¹ Ø§Ù„ÙƒØ§Ø±Øª Ù‡Ù†Ø§ -->
    </div>
    
    <!-- Retry button if card element not ready -->
    <div *ngIf="!isCardElementReady && !isProcessing" class="text-center mt-2">
      <button class="btn btn-sm btn-outline-primary" (click)="retryInitialization()">
        <i class="bi bi-arrow-clockwise"></i> Retry Card Setup
      </button>
      <small class="text-muted d-block mt-1">Click if the card input doesn't appear</small>
    </div>
    
    <div id="card-errors" class="error-message" role="alert" aria-live="polite"></div>
  </div>

  <!-- Submit Button -->
  <div class="payment-actions">
    <button 
      class="btn btn-secondary" 
      (click)="cancelPayment()"
      [disabled]="isProcessing">
      Cancel
    </button>
    
    <button 
      class="btn btn-primary payment-btn"
      (click)="handlePayment()"
      [disabled]="isProcessing || !isCardElementReady">
      <span *ngIf="!isProcessing">
        <i class="bi bi-lock"></i>
        Pay ${{ paymentAmount }}
      </span>
      <span *ngIf="isProcessing">
        <span class="spinner-border spinner-border-sm me-2"></span>
        Processing...
      </span>
    </button>
  </div>

  <!-- Loading indicator -->
  <div *ngIf="!isCardElementReady && !isProcessing" class="text-center mt-2">
    <div class="spinner-border spinner-border-sm text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <small class="text-muted d-block">Loading payment system...</small>
  </div>

  <!-- Security Notice -->
  <div class="security-notice">
    <i class="bi bi-shield-check text-success"></i>
    <span>Your payment information is encrypted and secure</span>
  </div>
</div>


================================================
File: app/payment/payment.component.spec.ts
================================================
import { ComponentFixture, TestBed } from '@angular/core/testing';

import { PaymentComponent } from './payment.component';

describe('PaymentComponent', () => {
  let component: PaymentComponent;
  let fixture: ComponentFixture<PaymentComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [PaymentComponent]
    })
    .compileComponents();
    
    fixture = TestBed.createComponent(PaymentComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});



================================================
File: app/payment/payment.component.ts
================================================
import { Component, Input, Output, EventEmitter, OnInit, AfterViewInit, OnDestroy, OnChanges } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { PaymentService } from '../services/payment.service';
import Swal from 'sweetalert2';

declare var Stripe: any;

@Component({
  selector: 'app-payment',
  standalone: true,
  imports: [CommonModule, FormsModule],
  templateUrl: './payment.component.html',
  styleUrls: ['./payment.component.css']
})
export class PaymentComponent implements OnInit, AfterViewInit, OnDestroy, OnChanges {
  @Input() showPayment = false;
  @Input() paymentAmount = 1; // $1 للاختبار (أو 50 للإنتاج)
  @Output() paymentSuccess = new EventEmitter<any>();
  @Output() paymentCancel = new EventEmitter<void>();

  // Public properties for template
  isProcessing = false;
  isCardElementReady = false;
  stripeLoaded = false;

  // Private Stripe properties
  private stripe: any;
  private elements: any;
  private cardElement: any;
  private initializationAttempts = 0;
  private maxAttempts = 5;

  // Stripe Publishable Key
  private readonly stripePublishableKey = 'pk_test_51RXPxIRHB8EWOr5UtIiT6dVRn7j68SFzmO6kKiJpfLoh58o9kj5h3kb8QTpvnhaqLOVPB5ladvNBHHrQrR2Q9XdH00Q2gtWAQ5';

  constructor(private paymentService: PaymentService) {}

  ngOnInit() {
    console.log('🚀 PaymentComponent initialized with amount:', this.paymentAmount);
    this.loadStripe();
  }

  ngAfterViewInit() {
    // سنقوم بالتهيئة عند فتح الـ modal
  }

  ngOnChanges(changes: any) {
    // عند فتح نافذة الدفع، نقوم بتهيئة Stripe
    if (changes.showPayment && changes.showPayment.currentValue === true) {
      console.log('🔥 Payment modal opened, initializing Stripe...');
      setTimeout(() => {
        this.initializeStripeElements();
      }, 300);
    }
  }

  ngOnDestroy() {
    this.destroyCardElement();
  }

  private destroyCardElement() {
    if (this.cardElement) {
      try {
        this.cardElement.unmount();
        this.cardElement.destroy();
        this.cardElement = null;
        console.log('🗑️ Card element destroyed');
      } catch (error) {
        console.log('Card element already destroyed');
      }
    }
  }

  private loadStripe() {
    console.log('🔄 Loading Stripe...');
    
    if (typeof Stripe === 'undefined') {
      console.log('📦 Stripe not found, loading script...');
      const script = document.createElement('script');
      script.src = 'https://js.stripe.com/v3/';
      script.onload = () => {
        console.log('✅ Stripe script loaded successfully');
        this.stripeLoaded = true;
        if (this.showPayment) {
          this.initializeStripeElements();
        }
      };
      script.onerror = () => {
        console.error('❌ Failed to load Stripe script');
        this.showError('Failed to load payment system. Please refresh the page.');
      };
      document.head.appendChild(script);
    } else {
      console.log('✅ Stripe already available');
      this.stripeLoaded = true;
      if (this.showPayment) {
        setTimeout(() => this.initializeStripeElements(), 100);
      }
    }
  }

  private initializeStripeElements() {
    this.initializationAttempts++;
    
    console.log(`🔄 Initializing Stripe Elements (Attempt ${this.initializationAttempts})...`);
    
    // فحص الشروط المطلوبة
    if (!this.showPayment) {
      console.log('⏭️ Payment modal not shown, skipping initialization');
      return;
    }
    
    if (typeof Stripe === 'undefined') {
      console.log('⏭️ Stripe not loaded yet, will retry...');
      if (this.initializationAttempts < this.maxAttempts) {
        setTimeout(() => this.initializeStripeElements(), 500);
      }
      return;
    }

    if (this.isCardElementReady) {
      console.log('⏭️ Card element already ready');
      return;
    }

    // فحص وجود الـ container
    const cardElementContainer = document.getElementById('card-element');
    if (!cardElementContainer) {
      console.log('⏭️ Card element container not found, will retry...');
      if (this.initializationAttempts < this.maxAttempts) {
        setTimeout(() => this.initializeStripeElements(), 300);
      }
      return;
    }

    try {
      // تهيئة Stripe
      if (!this.stripe) {
        this.stripe = Stripe(this.stripePublishableKey);
        console.log('✅ Stripe instance created');
      }
      
      // إنشاء Elements instance
      if (!this.elements) {
        this.elements = this.stripe.elements();
        console.log('✅ Elements instance created');
      }
      
      // حذف أي card element موجود
      this.destroyCardElement();
      
      // إنشاء card element جديد
      this.cardElement = this.elements.create('card', {
        style: {
          base: {
            fontSize: '16px',
            color: '#424770',
            fontFamily: '"Segoe UI", Tahoma, Geneva, Verdana, sans-serif',
            lineHeight: '24px',
            '::placeholder': {
              color: '#aab7c4',
            },
          },
          invalid: {
            color: '#dc3545',
            iconColor: '#dc3545'
          },
          complete: {
            color: '#28a745',
            iconColor: '#28a745'
          }
        },
        hidePostalCode: true,
        disableLink: true
      });
      
      console.log('✅ Card element created');
      
      // إضافة event listeners
      this.cardElement.on('ready', () => {
        console.log('✅ Card element is ready and interactive');
        this.isCardElementReady = true;
      });
      
      this.cardElement.on('change', (event: any) => {
        console.log('🔄 Card element changed:', event);
        const displayError = document.getElementById('card-errors');
        if (displayError) {
          if (event.error) {
            displayError.textContent = event.error.message;
            console.log('❌ Card validation error:', event.error.message);
          } else {
            displayError.textContent = '';
          }
        }
      });

      this.cardElement.on('focus', () => {
        console.log('👆 Card element focused');
      });

      this.cardElement.on('blur', () => {
        console.log('👆 Card element blurred');
      });
      
      // ربط card element بالـ DOM
      console.log('📌 Mounting card element...');
      this.cardElement.mount('#card-element');
      console.log('✅ Card element mounted successfully');
      
    } catch (error) {
      console.error('❌ Error initializing Stripe:', error);
      this.showError('Failed to initialize payment system. Please refresh the page.');
    }
  }

  async handlePayment() {
    if (!this.stripe || !this.cardElement || this.isProcessing) {
      console.log('❌ Payment blocked:', { 
        stripe: !!this.stripe, 
        cardElement: !!this.cardElement, 
        isProcessing: this.isProcessing 
      });
      
      if (!this.cardElement) {
        this.showError('Payment system not ready. Please wait a moment and try again.');
        this.initializeStripeElements();
      }
      return;
    }

    this.isProcessing = true;
    this.clearErrors();

    try {
      console.log('🔄 Creating payment intent for $', this.paymentAmount);
      
      // 1. إنشاء Payment Intent من البكاند (بدون paymentIntentId لتجنب Error 400)
      const paymentRequest = {
        currency: 'USD',
        amount: this.paymentAmount * 100 // تحويل إلى cents
      };

      console.log('📤 Sending payment request:', paymentRequest);

      const paymentIntentResponse = await this.paymentService.createPaymentIntent(paymentRequest).toPromise();

      console.log('✅ Payment intent response:', paymentIntentResponse);

      if (!paymentIntentResponse?.clientSecret) {
        throw new Error('Failed to create payment intent - no client secret received');
      }

      console.log('🔄 Confirming payment with Stripe...');

      // 2. تأكيد الدفع مع Stripe
      const { error, paymentIntent } = await this.stripe.confirmCardPayment(
        paymentIntentResponse.clientSecret,
        {
          payment_method: {
            card: this.cardElement,
            billing_details: {
              name: 'Property Owner'
            },
          }
        }
      );

      if (error) {
        console.error('❌ Payment confirmation error:', error);
        
        // معالجة أخطاء Stripe المختلفة
        let userMessage = error.message || 'Payment failed. Please try again.';
        
        if (error.code === 'card_declined') {
          userMessage = 'Your card was declined. Please try a different payment method.';
        } else if (error.code === 'insufficient_funds') {
          userMessage = 'Insufficient funds. Please use a different payment method.';
        } else if (error.code === 'expired_card') {
          userMessage = 'Your card has expired. Please use a different payment method.';
        } else if (error.code === 'incorrect_cvc') {
          userMessage = 'Incorrect security code. Please check your card details.';
        }
        
        this.showError(userMessage);
      } else if (paymentIntent.status === 'succeeded') {
        console.log('✅ Payment succeeded:', paymentIntent);
        
        await Swal.fire({
          icon: 'success',
          title: 'Payment Successful!',
          text: 'Your payment has been processed successfully.',
          confirmButtonColor: '#08227B',
          timer: 3000,
          showConfirmButton: true
        });

        // إرسال البيانات للمكون الأب
        this.paymentSuccess.emit({
          paymentIntentId: paymentIntent.id,
          amount: this.paymentAmount,
          status: paymentIntent.status,
          clientSecret: paymentIntentResponse.clientSecret
        });
      } else {
        console.log('⚠️ Unexpected payment status:', paymentIntent.status);
        throw new Error(`Unexpected payment status: ${paymentIntent.status}`);
      }

    } catch (error: any) {
      console.error('❌ Payment error:', error);
      
      let errorMessage = 'An unexpected error occurred. Please try again.';
      
      // معالجة أخطاء محددة
      if (error.message) {
        if (error.message.includes('Payment already processed')) {
          errorMessage = 'This payment was already processed. Please create a new payment.';
        } else if (error.message.includes('Authentication failed')) {
          errorMessage = 'Authentication failed. Please log in again.';
        } else if (error.message.includes('Payment method required')) {
          errorMessage = 'Please check your card details and try again.';
        } else if (error.message.includes('Network error')) {
          errorMessage = 'Network error. Please check your internet connection.';
        } else {
          errorMessage = error.message;
        }
      } else if (error.status === 401) {
        errorMessage = 'Authentication failed. Please log in again.';
      } else if (error.status === 400) {
        errorMessage = 'Invalid payment request. Please check your information.';
      } else if (error.status === 500) {
        errorMessage = 'Server error. Please try again later.';
      }
      
      this.showError(errorMessage);
    } finally {
      this.isProcessing = false;
    }
  }

  private showError(message: string) {
    const errorDiv = document.getElementById('card-errors');
    if (errorDiv) {
      errorDiv.textContent = message;
    }
    
    Swal.fire({
      icon: 'error',
      title: 'Payment Failed',
      text: message,
      confirmButtonColor: '#08227B'
    });
  }

  private clearErrors() {
    const errorDiv = document.getElementById('card-errors');
    if (errorDiv) {
      errorDiv.textContent = '';
    }
  }

  cancelPayment() {
    console.log('❌ Payment cancelled by user');
    this.paymentCancel.emit();
  }

  // إعادة المحاولة اليدوية
  retryInitialization() {
    console.log('🔄 Manual retry initialization...');
    this.isCardElementReady = false;
    this.initializationAttempts = 0;
    this.destroyCardElement();
    setTimeout(() => this.initializeStripeElements(), 100);
  }
}


================================================
File: app/profile/profile.component.css
================================================
.profile-container {
  min-height: 100vh;
  background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
}

.loading-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 50vh;
}

.profile-header {
  background: white;
  border-radius: 20px;
  padding: 30px;
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.profile-image-container {
  position: relative;
  display: inline-block;
  overflow: hidden; /* Hide any overflow text */
  border-radius: 50%; /* Make container circular to contain icons */
}

.profile-image {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  object-fit: cover;
  border: 4px solid #08227B;
  box-shadow: 0 4px 15px rgba(8, 34, 123, 0.3);
  position: absolute;
  top: 0;
  left: 0;
  display: block; /* Ensure image display */
}

.profile-image.default-image {
  position: relative;
  opacity: 1;
  z-index: 1; /* الطبقة السفلى - الصورة الافتراضية */
}

.profile-image.user-image {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 2; /* الطبقة الوسطى - صورة المستخدم */
}

.header-image-actions {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 10;
  pointer-events: none; /* Allow clicks to pass through container */
}

.header-edit-btn,
.header-remove-btn {
  position: absolute;
  width: 25px;
  height: 25px;
  border-radius: 50%;
  border: 2px solid white;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 0.8rem;
  transition: all 0.3s ease;
  pointer-events: auto; /* Enable clicks on buttons */
}

.header-edit-btn {
  bottom: 5px;
  right: 5px;
  background: #08227B;
  color: white;
}

.header-edit-btn:hover {
  background: #061a5f;
  transform: scale(1.1);
}

.header-remove-btn {
  bottom: 5px;
  left: 5px;
  background: #dc3545;
  color: white;
}

.header-remove-btn:hover {
  background: #c82333;
  transform: scale(1.1);
}

.user-name {
  color: #08227B;
  font-weight: bold;
  margin: 0;
  font-size: 1.8rem;
}

.header-actions {
  display: flex;
  gap: 10px;
}

.action-btn {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  border: none;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  cursor: pointer;
  transition: all 0.3s ease;
}

.edit-btn {
  background: #28a745;
  color: white;
}

.edit-btn:hover {
  background: #218838;
  transform: scale(1.1);
}

.logout-btn {
  background: #dc3545;
  color: white;
}

.logout-btn:hover {
  background: #c82333;
  transform: scale(1.1);
}

.section-container {
  background: white;
  border-radius: 15px;
  padding: 25px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
}

.section-title {
  color: #08227B;
  font-weight: bold;
  font-size: 1.3rem;
  margin-bottom: 20px;
  padding-bottom: 10px;
  border-bottom: 2px solid #f8f9fa;
}

.menu-items {
  display: flex;
  flex-direction: column;
  gap: 0;
}

.menu-item {
  display: flex;
  align-items: center;
  padding: 20px;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  border-bottom: 1px solid #f1f3f4;
}

.menu-item:hover {
  background: #f8f9fa;
  transform: translateX(5px);
}

.menu-item:last-child {
  border-bottom: none;
}

.menu-icon {
  width: 50px;
  height: 50px;
  border-radius: 12px;
  background: #e9ecef;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.3rem;
  color: #08227B;
  margin-right: 15px;
}

.menu-content {
  flex: 1;
}

.menu-content h5 {
  margin: 0 0 5px 0;
  font-weight: 600;
  color: #333;
}

.menu-content p {
  margin: 0;
  color: #6c757d;
  font-size: 0.9rem;
}

.menu-arrow {
  color: #6c757d;
  font-size: 1.1rem;
}

.menu-toggle {
  margin-right: 10px;
}

.menu-badge {
  margin-right: 10px;
}

.form-check-input:checked {
  background-color: #08227B;
  border-color: #08227B;
}

.delete-section {
  border: 2px solid #ffeeba;
  background: #fff3cd;
}

.delete-account-item {
  display: flex;
  align-items: center;
  padding: 20px;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.delete-account-item:hover {
  background: rgba(220, 53, 69, 0.1);
  transform: translateX(5px);
}

/* Modal Styles */
.modal {
  background: rgba(0, 0, 0, 0.5);
}

.modal.show {
  display: block !important;
}

.modal-content {
  border-radius: 15px;
  border: none;
  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
}

.modal-header {
  background: #08227B;
  color: white;
  border-radius: 15px 15px 0 0;
  border-bottom: none;
}

.modal-title {
  font-weight: bold;
}

.btn-close {
  filter: invert(1);
}

.edit-image-container {
  position: relative;
  display: inline-block;
  overflow: hidden; /* Hide any overflow text */
}

.edit-profile-image {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  object-fit: cover;
  border: 4px solid #08227B;
  position: absolute;
  top: 0;
  left: 0;
  display: block; /* Ensure image display */
}

.edit-profile-image.default-image {
  position: relative;
  opacity: 1;
  z-index: 1; /* الطبقة السفلى - الصورة الافتراضية */
}

.edit-profile-image.user-image {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 2; /* الطبقة الوسطى - صورة المستخدم */
}

.image-upload-btn {
  position: absolute;
  bottom: 0;
  right: 0;
  width: 40px;
  height: 40px;
  background: #08227B;
  color: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border: 3px solid white;
  font-size: 1.2rem;
  transition: all 0.3s ease;
}

.image-upload-btn:hover {
  background: #061a5f;
  transform: scale(1.1);
}

.image-remove-btn {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 40px;
  height: 40px;
  background: #dc3545;
  color: white;
  border: none;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border: 3px solid white;
  font-size: 1.1rem;
  transition: all 0.3s ease;
}

.image-remove-btn:hover {
  background: #c82333;
  transform: scale(1.1);
}

.btn-primary {
  background-color: #08227B;
  border-color: #08227B;
}

.btn-primary:hover {
  background-color: #061a5f;
  border-color: #061a5f;
}

.form-control:focus {
  border-color: #08227B;
  box-shadow: 0 0 0 0.2rem rgba(8, 34, 123, 0.25);
}

.form-select:focus {
  border-color: #08227B;
  box-shadow: 0 0 0 0.2rem rgba(8, 34, 123, 0.25);
}

.modal-backdrop {
  background: rgba(0, 0, 0, 0.5);
}

.modal-backdrop.show {
  opacity: 1;
}

/* Dark Mode Styles */
body.dark-mode .profile-container {
  background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
}

body.dark-mode .profile-header,
body.dark-mode .section-container {
  background: #2d3748;
  color: white;
}

body.dark-mode .menu-item:hover {
  background: #4a5568;
}

body.dark-mode .menu-icon {
  background: #4a5568;
  color: #08227B;
}

body.dark-mode .menu-content h5 {
  color: white;
}

body.dark-mode .menu-content p {
  color: #a0aec0;
}

body.dark-mode .delete-section {
  background: #744210;
  border-color: #d69e2e;
}

/* Responsive Design */
@media (max-width: 768px) {
  .profile-header {
    padding: 20px;
  }
  
  .user-name {
    font-size: 1.4rem;
  }
  
  .profile-image {
    width: 60px;
    height: 60px;
  }
  
  .profile-image-container {
    width: 60px;
    height: 60px;
  }
  
  .edit-image-section {
    flex-direction: column;
    gap: 15px;
  }
  
  .image-actions {
    flex-direction: row;
    gap: 10px;
  }
  
  .edit-profile-image {
    width: 100px;
    height: 100px;
  }
  
  .edit-image-container {
    width: 100px;
    height: 100px;
  }
  
  .image-action-btn {
    width: 40px;
    height: 40px;
    font-size: 1rem;
  }
  
  .action-btn {
    width: 45px;
    height: 45px;
    font-size: 1rem;
  }
  
  .menu-item {
    padding: 15px;
  }
  
  .menu-icon {
    width: 45px;
    height: 45px;
    font-size: 1.1rem;
  }
  
  .section-container {
    padding: 20px;
  }
}
/* Change Password Modal Styles */
.modal {
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(5px);
}

.modal.show {
  display: block !important;
}

.modal-dialog {
  max-width: 500px;
  margin: 2rem auto;
}

.modal-content {
  border: none;
  border-radius: 20px;
  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
  overflow: hidden;
  background: white;
}

.modal-header {
  background: linear-gradient(135deg, #08227B, #061a5f);
  color: white;
  border-radius: 20px 20px 0 0;
  border-bottom: none;
  padding: 25px 30px;
  position: relative;
}

.modal-title {
  font-size: 1.4rem;
  font-weight: bold;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 10px;
}

.modal-title i {
  font-size: 1.3rem;
}

.btn-close {
  filter: brightness(0) invert(1);
  opacity: 0.8;
  transition: opacity 0.3s ease;
}

.btn-close:hover {
  opacity: 1;
  transform: scale(1.1);
}

.modal-body {
  padding: 30px;
  background: #f8f9fa;
}

.form-group {
  margin-bottom: 25px;
}

.form-label {
  display: block;
  font-size: 1rem;
  color: #08227B;
  margin-bottom: 8px;
  font-weight: 600;
}

.form-control {
  width: 100%;
  padding: 15px;
  border: 2px solid #e0e0e0;
  border-radius: 12px;
  font-size: 16px;
  outline: none;
  transition: all 0.3s ease;
  background-color: white;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
}

.form-control:focus {
  border-color: #08227B;
  box-shadow: 0 0 0 3px rgba(8, 34, 123, 0.1);
  transform: translateY(-1px);
}

.form-control.is-invalid {
  border-color: #dc3545;
  box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
}

.invalid-feedback {
  color: #dc3545;
  font-size: 14px;
  margin-top: 8px;
  font-weight: 500;
}

.modal-footer {
  padding: 25px 30px;
  background: white;
  border-top: 1px solid #e9ecef;
  display: flex;
  justify-content: space-between;
  gap: 15px;
}

.btn {
  padding: 12px 25px;
  border: none;
  border-radius: 10px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  min-height: 48px;
  flex: 1;
}

.btn-secondary {
  background: #6c757d;
  color: white;
  box-shadow: 0 3px 10px rgba(108, 117, 125, 0.3);
}

.btn-secondary:hover:not(:disabled) {
  background: #5a6268;
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(108, 117, 125, 0.4);
}

.btn-warning {
  background: linear-gradient(135deg, #ffc107, #ffb300);
  color: #212529;
  box-shadow: 0 3px 10px rgba(255, 193, 7, 0.3);
  font-weight: bold;
}

.btn-warning:hover:not(:disabled) {
  background: linear-gradient(135deg, #ffb300, #ff8f00);
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(255, 193, 7, 0.4);
}

.btn:disabled {
  background: #e9ecef !important;
  color: #6c757d !important;
  cursor: not-allowed;
  transform: none !important;
  box-shadow: none !important;
}

.spinner-border-sm {
  width: 1rem;
  height: 1rem;
  border-width: 0.15em;
  animation: spinner-border 0.75s linear infinite;
}

@keyframes spinner-border {
  to {
    transform: rotate(360deg);
  }
}

.spinner-border {
  display: inline-block;
  border: 0.15em solid currentColor;
  border-right-color: transparent;
  border-radius: 50%;
}

/* Modal Backdrop */
.modal-backdrop {
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(5px);
}

.modal-backdrop.show {
  opacity: 1;
}

/* Enhanced Form Styling */
.mb-3 {
  margin-bottom: 1.5rem;
}

.form-control::placeholder {
  color: #adb5bd;
  opacity: 1;
}

/* Icons styling */
.bi {
  font-style: normal;
  font-variant: normal;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
}

/* Focus animations */
.form-control:focus + .form-label {
  color: #08227B;
}

/* Password strength indicator (optional) */
.password-strength {
  margin-top: 8px;
  height: 4px;
  background: #e9ecef;
  border-radius: 2px;
  overflow: hidden;
}

.password-strength.weak {
  background: linear-gradient(90deg, #dc3545 30%, #e9ecef 30%);
}

.password-strength.medium {
  background: linear-gradient(90deg, #ffc107 60%, #e9ecef 60%);
}

.password-strength.strong {
  background: linear-gradient(90deg, #28a745 100%, #e9ecef 100%);
}

/* Responsive design */
@media (max-width: 768px) {
  .modal-dialog {
    margin: 1rem;
    max-width: calc(100vw - 2rem);
  }
  
  .modal-body {
    padding: 20px;
  }
  
  .modal-footer {
    padding: 20px;
    flex-direction: column;
  }
  
  .btn {
    width: 100%;
    margin-bottom: 10px;
  }
  
  .modal-header {
    padding: 20px;
  }
  
  .modal-title {
    font-size: 1.2rem;
  }
}

/* Animation for modal appearance */
@keyframes modalSlideIn {
  from {
    transform: translateY(-50px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.modal.show .modal-dialog {
  animation: modalSlideIn 0.3s ease-out;
}

/* Success state for form validation */
.form-control.is-valid {
  border-color: #28a745;
  box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
}

.valid-feedback {
  color: #28a745;
  font-size: 14px;
  margin-top: 8px;
  font-weight: 500;
}

/* Enhanced button states */
.btn:active {
  transform: translateY(0) !important;
}

.btn-warning i {
  color: #212529;
}

/* Form group enhanced styling */
.form-group {
  position: relative;
}

.form-group:last-child {
  margin-bottom: 0;
}

/* Enhanced modal overlay */
.modal {
  z-index: 1055;
}

.modal-backdrop {
  z-index: 1050;
}


================================================
File: app/profile/profile.component.html
================================================
<!-- Profile Component HTML -->
<div class="profile-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3">Loading profile...</p>
  </div>

  <!-- Profile Content -->
  <div *ngIf="!isLoading" class="container py-4">
    <!-- Profile Header -->
    <div class="profile-header mb-4">
      <div class="row align-items-center">
        <div class="col-auto">
          <div class="profile-image-container">
            <img 
              [src]="getUserImageUrl()" 
              alt="Profile Picture" 
              class="profile-image"
              onerror="this.src='assets/images/unknown.png'"
            >
          </div>
        </div>
        <div class="col">
          <h2 class="user-name">{{ getUserFullName() }}</h2>
        </div>
        <div class="col-auto">
          <div class="header-actions">
            <button class="action-btn edit-btn" (click)="openEditModal()" title="Edit Profile">
              <i class="bi bi-pencil"></i>
            </button>
            <button class="action-btn logout-btn" (click)="logout()" title="Sign Out">
              <i class="bi bi-box-arrow-right"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Account Section -->
    <div class="section-container mb-4">
      <h3 class="section-title">
        <i class="bi bi-person-circle"></i> Account
      </h3>
      <div class="menu-items">
        <div class="menu-item" (click)="navigateToAddProperty()">
          <div class="menu-icon">
            <i class="bi bi-house-add"></i>
          </div>
          <div class="menu-content">
            <h5>Upload Your Property</h5>
            <p>Add a new property to the platform</p>
          </div>
          <div class="menu-arrow">
            <i class="bi bi-chevron-right"></i>
          </div>
        </div>

        <div class="menu-item" (click)="openEditModal()">
          <div class="menu-icon">
            <i class="bi bi-person-gear"></i>
          </div>
          <div class="menu-content">
            <h5>Edit Profile</h5>
            <p>Update your personal information</p>
          </div>
          <div class="menu-arrow">
            <i class="bi bi-chevron-right"></i>
          </div>
        </div>

        <div class="menu-item" (click)="openPasswordModal()">
          <div class="menu-icon">
            <i class="bi bi-lock"></i>
          </div>
          <div class="menu-content">
            <h5>Change Password</h5>
            <p>Update your account password</p>
          </div>
          <div class="menu-arrow">
            <i class="bi bi-chevron-right"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- More Section -->
    <div class="section-container mb-4">
      <h3 class="section-title">
        <i class="bi bi-three-dots"></i> More
      </h3>
      <div class="menu-items">
        <div class="menu-item" (click)="showAboutUs()">
          <div class="menu-icon">
            <i class="bi bi-info-circle"></i>
          </div>
          <div class="menu-content">
            <h5>About Us</h5>
            <p>Learn more about X-Rental platform</p>
          </div>
          <div class="menu-arrow">
            <i class="bi bi-chevron-right"></i>
          </div>
        </div>

        <div class="menu-item">
          <div class="menu-icon">
            <i class="bi bi-moon"></i>
          </div>
          <div class="menu-content">
            <h5>Dark Mode</h5>
            <p>Switch between light and dark theme</p>
          </div>
          <div class="menu-toggle">
            <div class="form-check form-switch">
              <input 
                class="form-check-input" 
                type="checkbox" 
                id="darkModeSwitch"
                [checked]="isDarkMode"
                (change)="toggleDarkMode()"
              >
            </div>
          </div>
        </div>

        <div class="menu-item">
          <div class="menu-icon">
            <i class="bi bi-globe"></i>
          </div>
          <div class="menu-content">
            <h5>Language</h5>
            <p>العربية - Arabic</p>
          </div>
          <div class="menu-badge">
            <span class="badge bg-secondary">Soon</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Delete Account Section -->
    <div class="section-container delete-section">
      <div class="delete-account-item" (click)="deleteAccount()">
        <div class="menu-icon text-danger">
          <i class="bi bi-trash"></i>
        </div>
        <div class="menu-content">
          <h5 class="text-danger">Delete Account</h5>
          <p class="text-muted">Permanently delete your account and data</p>
        </div>
        <div class="menu-arrow text-danger">
          <i class="bi bi-chevron-right"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Profile Modal -->
  <div class="modal" [class.show]="showEditModal" [style.display]="showEditModal ? 'block' : 'none'">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="bi bi-person-gear"></i> Edit Profile
          </h5>
          <button type="button" class="btn-close" (click)="closeEditModal()"></button>
        </div>
        <div class="modal-body">
          <form [formGroup]="profileForm" (ngSubmit)="onUpdateProfile()">
            <!-- Profile Image Section -->
            <div class="text-center mb-4">
              <div class="edit-image-section">
                <div class="edit-image-container">
                  <!-- الطبقة الأولى (السفلى): الصورة الافتراضية - z-index: 1 -->
                  <img 
                    src="assets/images/unknown.png"
                     
                    alt="Profile Picture" 
                    class="edit-profile-image default-image"
                  >
                  <!-- الطبقة الثانية (الوسطى): صورة المستخدم - z-index: 2 -->
                  <img 
                    *ngIf="hasUserImage()"
                    [src]="getUserActualImageUrl()" 
                    alt="User Profile Picture" 
                    class="edit-profile-image user-image"
                    onerror="this.style.display='none'"
                  >
                </div>
                
                <!-- أيقونات بجانب الصورة -->
                <div class="image-actions">
                  <label for="profileImageInput" class="image-action-btn upload-btn" title="Change Photo">
                    <i class="bi bi-camera"></i>
                  </label>
                  <button 
                    type="button" 
                    class="image-action-btn remove-btn" 
                    *ngIf="hasUserImage()"
                    (click)="removeProfileImage()"
                    title="Remove Photo"
                  >
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </div>
              
              <input 
                type="file" 
                id="profileImageInput"
                class="d-none"
                accept="image/*"
                (change)="onFileSelected($event)"
              >
              <div class="mt-2">
                <div *ngIf="selectedFile" class="text-success">
                  <small>
                    <i class="bi bi-check-circle"></i> New image selected: {{ selectedFile.name }}
                  </small>
                </div>
                <div *ngIf="isImageDeleted" class="text-warning">
                  <small>
                    <i class="bi bi-exclamation-triangle"></i> Profile picture will be removed
                  </small>
                </div>
                <div *ngIf="!selectedFile && !isImageDeleted && !hasUserImage()" class="text-muted">
                  <small>Click camera icon to add your photo</small>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="firstName" class="form-label">First Name *</label>
                  <input 
                    type="text" 
                    id="firstName"
                    formControlName="firstName" 
                    class="form-control"
                    [class.is-invalid]="profileForm.get('firstName')?.invalid && profileForm.get('firstName')?.touched"
                  >
                  <div *ngIf="profileForm.get('firstName')?.invalid && profileForm.get('firstName')?.touched" class="invalid-feedback">
                    <div *ngIf="profileForm.get('firstName')?.errors?.['required']">First name is required</div>
                    <div *ngIf="profileForm.get('firstName')?.errors?.['minlength']">First name must be at least 2 characters</div>
                  </div>
                </div>
              </div>
              
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="lastName" class="form-label">Last Name *</label>
                  <input 
                    type="text" 
                    id="lastName"
                    formControlName="lastName" 
                    class="form-control"
                    [class.is-invalid]="profileForm.get('lastName')?.invalid && profileForm.get('lastName')?.touched"
                  >
                  <div *ngIf="profileForm.get('lastName')?.invalid && profileForm.get('lastName')?.touched" class="invalid-feedback">
                    <div *ngIf="profileForm.get('lastName')?.errors?.['required']">Last name is required</div>
                    <div *ngIf="profileForm.get('lastName')?.errors?.['minlength']">Last name must be at least 2 characters</div>
                  </div>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="email" class="form-label">Email *</label>
                  <input 
                    type="email" 
                    id="email"
                    formControlName="email" 
                    class="form-control"
                    [class.is-invalid]="profileForm.get('email')?.invalid && profileForm.get('email')?.touched"
                  >
                  <div *ngIf="profileForm.get('email')?.invalid && profileForm.get('email')?.touched" class="invalid-feedback">
                    <div *ngIf="profileForm.get('email')?.errors?.['required']">Email is required</div>
                    <div *ngIf="profileForm.get('email')?.errors?.['email']">Please enter a valid email</div>
                  </div>
                </div>
              </div>
              
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="phoneNumber" class="form-label">Phone Number</label>
                  <input 
                    type="tel" 
                    id="phoneNumber"
                    formControlName="phoneNumber" 
                    class="form-control"
                    [class.is-invalid]="profileForm.get('phoneNumber')?.invalid && profileForm.get('phoneNumber')?.touched"
                  >
                  <div *ngIf="profileForm.get('phoneNumber')?.invalid && profileForm.get('phoneNumber')?.touched" class="invalid-feedback">
                    Please enter a valid phone number
                  </div>
                </div>
              </div>
            </div>

            <div class="mb-3">
              <label for="city" class="form-label">City</label>
              <select formControlName="city" id="city" class="form-select">
                <option value="">Select city</option>
                <option value="Cairo">Cairo</option>
                <option value="Alexandria">Alexandria</option>
                <option value="Giza">Giza</option>
                <option value="Luxor">Luxor</option>
                <option value="Aswan">Aswan</option>
                <option value="Sharm El Sheikh">Sharm El Sheikh</option>
                <option value="Hurghada">Hurghada</option>
              </select>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeEditModal()">Cancel</button>
          <button 
            type="button" 
            class="btn btn-primary"
            [disabled]="isUpdatingProfile || profileForm.invalid"
            (click)="onUpdateProfile()"
          >
            <span *ngIf="!isUpdatingProfile">
              <i class="bi bi-check-circle"></i> Update Profile
            </span>
            <span *ngIf="isUpdatingProfile">
              <span class="spinner-border spinner-border-sm me-2"></span>
              Updating...
            </span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Change Password Modal -->
  <div class="modal" [class.show]="showPasswordModal" [style.display]="showPasswordModal ? 'block' : 'none'">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="bi bi-lock"></i> Change Password
          </h5>
          <button type="button" class="btn-close" (click)="closePasswordModal()"></button>
        </div>
        <div class="modal-body">
          <form [formGroup]="passwordForm" (ngSubmit)="onChangePassword()">
            <div class="mb-3">
              <label for="oldPassword" class="form-label">Current Password *</label>
              <input 
                type="password" 
                id="oldPassword"
                formControlName="oldPassword" 
                class="form-control"
                [class.is-invalid]="passwordForm.get('oldPassword')?.invalid && passwordForm.get('oldPassword')?.touched"
              >
              <div *ngIf="passwordForm.get('oldPassword')?.invalid && passwordForm.get('oldPassword')?.touched" class="invalid-feedback">
                Current password is required
              </div>
            </div>

            <div class="mb-3">
              <label for="newPassword" class="form-label">New Password *</label>
              <input 
                type="password" 
                id="newPassword"
                formControlName="newPassword" 
                class="form-control"
                [class.is-invalid]="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched"
              >
              <div *ngIf="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched" class="invalid-feedback">
                <div *ngIf="passwordForm.get('newPassword')?.errors?.['required']">New password is required</div>
                <div *ngIf="passwordForm.get('newPassword')?.errors?.['minlength']">Password must be at least 6 characters</div>
              </div>
            </div>
            
            <div class="mb-3">
              <label for="confirmNewPassword" class="form-label">Confirm New Password *</label>
              <input 
                type="password" 
                id="confirmNewPassword"
                formControlName="confirmNewPassword" 
                class="form-control"
                [class.is-invalid]="passwordForm.get('confirmNewPassword')?.invalid && passwordForm.get('confirmNewPassword')?.touched"
              >
              <div *ngIf="passwordForm.get('confirmNewPassword')?.invalid && passwordForm.get('confirmNewPassword')?.touched" class="invalid-feedback">
                <div *ngIf="passwordForm.get('confirmNewPassword')?.errors?.['required']">Please confirm your password</div>
                <div *ngIf="passwordForm.get('confirmNewPassword')?.errors?.['mismatch']">Passwords do not match</div>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closePasswordModal()">Cancel</button>
          <button 
            type="button" 
            class="btn btn-warning"
            [disabled]="isChangingPassword || passwordForm.invalid"
            (click)="onChangePassword()"
          >
            <span *ngIf="!isChangingPassword">
              <i class="bi bi-key"></i> Change Password
            </span>
            <span *ngIf="isChangingPassword">
              <span class="spinner-border spinner-border-sm me-2"></span>
              Changing...
            </span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Backdrop -->
  <div class="modal-backdrop" 
       [class.show]="showEditModal || showPasswordModal" 
       [style.display]="(showEditModal || showPasswordModal) ? 'block' : 'none'"
       (click)="closeEditModal(); closePasswordModal()">
  </div>
</div>




================================================
File: app/profile/profile.component.spec.ts
================================================
import { ComponentFixture, TestBed } from '@angular/core/testing';

import { ProfileComponent } from './profile.component';

describe('ProfileComponent', () => {
  let component: ProfileComponent;
  let fixture: ComponentFixture<ProfileComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [ProfileComponent]
    })
    .compileComponents();
    
    fixture = TestBed.createComponent(ProfileComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});



================================================
File: app/profile/profile.component.ts
================================================
import { Component, OnInit, OnDestroy } from '@angular/core';
import { CommonModule } from '@angular/common';
import { ReactiveFormsModule, FormBuilder, FormGroup, Validators } from '@angular/forms';
import { Router, RouterModule } from '@angular/router';
import { Subscription } from 'rxjs';
import { AuthService, UserProfile } from '../services/auth.service';
import Swal from 'sweetalert2';

@Component({
  selector: 'app-profile',
  standalone: true,
  imports: [CommonModule, ReactiveFormsModule, RouterModule],
  templateUrl: './profile.component.html',
  styleUrls: ['./profile.component.css']
})
export class ProfileComponent implements OnInit, OnDestroy {
  profileForm!: FormGroup;
  passwordForm!: FormGroup;
  currentUser: UserProfile | null = null;
  isLoading = false;
  isUpdatingProfile = false;
  isChangingPassword = false;
  selectedFile: File | null = null;
  imagePreview: string | null = null;
  showEditModal = false;
  showPasswordModal = false;
  isDarkMode = false;
  isImageDeleted = false;
  
  private subscriptions: Subscription[] = [];

  constructor(
    private formBuilder: FormBuilder,
    private authService: AuthService,
    private router: Router
  ) {
    this.isDarkMode = localStorage.getItem('darkMode') === 'true';
    this.applyTheme();
  }

  ngOnInit(): void {
    if (!this.authService.isLoggedIn()) {
      this.router.navigate(['/log-in']);
      return;
    }

    this.initializeForms();
    this.loadUserProfile();
  }

  ngOnDestroy(): void {
    this.subscriptions.forEach(sub => sub.unsubscribe());
  }

  initializeForms(): void {
    this.profileForm = this.formBuilder.group({
      firstName: ['', [Validators.required, Validators.minLength(2)]],
      lastName: ['', [Validators.required, Validators.minLength(2)]],
      email: ['', [Validators.required, Validators.email]],
      phoneNumber: ['', Validators.pattern('^[+]?[0-9]{10,15}$')],
      city: ['']
    });

    this.passwordForm = this.formBuilder.group({
      oldPassword: ['', Validators.required],
      newPassword: ['', [Validators.required, Validators.minLength(6)]],
      confirmNewPassword: ['', Validators.required]
    }, {
      validators: this.passwordMatchValidator
    });
  }

  passwordMatchValidator(group: FormGroup) {
    const newPassword = group.get('newPassword');
    const confirmPassword = group.get('confirmNewPassword');
    
    if (newPassword && confirmPassword && newPassword.value !== confirmPassword.value) {
      confirmPassword.setErrors({ mismatch: true });
      return { mismatch: true };
    }
    
    return null;
  }

  loadUserProfile(): void {
    this.isLoading = true;
    
    const profileSub = this.authService.getUserProfile().subscribe({
      next: (profile: UserProfile) => {
        this.currentUser = profile;
        this.profileForm.patchValue({
          firstName: profile.firstName,
          lastName: profile.lastName,
          email: profile.email,
          phoneNumber: profile.phoneNumber,
          city: profile.city
        });
        this.imagePreview = profile.imageUrl || null;
        this.isLoading = false;
      },
      error: (error) => {
        console.error('Error loading profile:', error);
        this.isLoading = false;
        Swal.fire({
          icon: 'error',
          title: 'Error Loading Profile',
          text: 'Failed to load your profile information.',
          confirmButtonColor: '#08227B'
        });
      }
    });
    
    this.subscriptions.push(profileSub);
  }

  onFileSelected(event: any): void {
    const file = event.target.files[0];
    if (file) {
      if (!file.type.startsWith('image/')) {
        Swal.fire({
          icon: 'warning',
          title: 'Invalid File Type',
          text: 'Please select a valid image file.',
          confirmButtonColor: '#08227B'
        });
        return;
      }

      if (file.size > 5 * 1024 * 1024) {
        Swal.fire({
          icon: 'warning',
          title: 'File Too Large',
          text: 'Please select an image smaller than 5MB.',
          confirmButtonColor: '#08227B'
        });
        return;
      }

      this.selectedFile = file;
      this.isImageDeleted = false;
      
      const reader = new FileReader();
      reader.onload = (e: any) => {
        this.imagePreview = e.target.result;
      };
      reader.readAsDataURL(file);
    }
  }

  removeProfileImage(): void {
    Swal.fire({
      title: 'Remove Profile Picture',
      text: 'Are you sure you want to remove your profile picture?',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#d33',
      cancelButtonColor: '#6c757d',
      confirmButtonText: 'Yes, remove it',
      cancelButtonText: 'Cancel'
    }).then((result) => {
      if (result.isConfirmed) {
        this.selectedFile = null;
        this.imagePreview = null;
        this.isImageDeleted = true;
        
        const fileInput = document.getElementById('profileImageInput') as HTMLInputElement;
        if (fileInput) {
          fileInput.value = '';
        }
      }
    });
  }

  onUpdateProfile(): void {
    if (this.profileForm.invalid) {
      Object.keys(this.profileForm.controls).forEach(key => {
        this.profileForm.get(key)?.markAsTouched();
      });
      return;
    }

    this.isUpdatingProfile = true;
    this.profileForm.disable(); // 🔥 Disable form during submission

    const formData = new FormData();
    const formValues = this.profileForm.value;
    
    formData.append('FirstName', formValues.firstName);
    formData.append('LastName', formValues.lastName);
    formData.append('Email', formValues.email);
    
    if (formValues.phoneNumber) {
      formData.append('PhoneNumber', formValues.phoneNumber);
    } else {
      formData.append('PhoneNumber', '');
    }
    
    if (formValues.city) {
      formData.append('City', formValues.city);
    } else {
      formData.append('City', '');
    }

    if (this.selectedFile) {
      formData.append('Image', this.selectedFile);
    } else if (this.isImageDeleted) {
      formData.append('ImageUrl', '');
    } else if (this.currentUser?.imageUrl) {
      formData.append('ImageUrl', this.currentUser.imageUrl);
    } else {
      formData.append('ImageUrl', '');
    }

    const updateSub = this.authService.updateUserProfile(formData).subscribe({
      next: (response) => {
        this.isUpdatingProfile = false;
        this.profileForm.enable(); // 🔥 Re-enable form
        this.showEditModal = false;
        
        Swal.fire({
          icon: 'success',
          title: 'Profile Updated',
          text: 'Your profile has been updated successfully!',
          showConfirmButton: false,
          timer: 1500
        });
        
        this.selectedFile = null;
        this.isImageDeleted = false;
        this.loadUserProfile();
      },
      error: (error) => {
        this.isUpdatingProfile = false;
        this.profileForm.enable(); // 🔥 Re-enable form on error
        console.error('Error updating profile:', error);
        
        let errorMessage = 'Failed to update profile. Please try again.';
        if (error.error && error.error.message) {
          errorMessage = error.error.message;
        } else if (error.status === 500) {
          errorMessage = 'Server error. Please try again later or contact support.';
        }

        Swal.fire({
          icon: 'error',
          title: 'Update Failed',
          text: errorMessage,
          confirmButtonColor: '#08227B'
        });
      }
    });

    this.subscriptions.push(updateSub);
  }

  onChangePassword(): void {
    if (this.passwordForm.invalid) {
      Object.keys(this.passwordForm.controls).forEach(key => {
        this.passwordForm.get(key)?.markAsTouched();
      });
      return;
    }

    this.isChangingPassword = true;
    this.passwordForm.disable(); // 🔥 Disable form during submission

    const passwordData = {
      oldPassword: this.passwordForm.value.oldPassword,
      newPassword: this.passwordForm.value.newPassword,
      confirmNewPassword: this.passwordForm.value.confirmNewPassword
    };

    const passwordSub = this.authService.changePassword(passwordData).subscribe({
      next: (response) => {
        this.isChangingPassword = false;
        this.passwordForm.enable(); // 🔥 Re-enable form
        this.showPasswordModal = false;
        this.passwordForm.reset();
        
        Swal.fire({
          icon: 'success',
          title: 'Password Changed',
          text: 'Your password has been changed successfully!',
          showConfirmButton: false,
          timer: 1500
        });
      },
      error: (error) => {
        this.isChangingPassword = false;
        this.passwordForm.enable(); // 🔥 Re-enable form on error
        console.error('Error changing password:', error);
        
        let errorMessage = 'Failed to change password. Please try again.';
        if (error.error && error.error.message) {
          errorMessage = error.error.message;
        } else if (error.status === 400) {
          errorMessage = 'Current password is incorrect.';
        }

        Swal.fire({
          icon: 'error',
          title: 'Password Change Failed',
          text: errorMessage,
          confirmButtonColor: '#08227B'
        });
      }
    });

    this.subscriptions.push(passwordSub);
  }

  getUserImageUrl(): string {
    return 'assets/images/unkown.png';
  }

  getUserActualImageUrl(): string {
    if (this.isImageDeleted) {
      return '';
    }
    if (this.imagePreview) {
      return this.imagePreview;
    }
    if (this.currentUser?.imageUrl) {
      return this.currentUser.imageUrl;
    }
    return '';
  }

  hasUserImage(): boolean {
    return !this.isImageDeleted && (!!this.imagePreview || !!this.currentUser?.imageUrl);
  }

  getUserFullName(): string {
    if (this.currentUser) {
      return `${this.currentUser.firstName} ${this.currentUser.lastName}`;
    }
    return 'User Name';
  }

  logout(): void {
    Swal.fire({
      title: 'Sign Out',
      text: 'Are you sure you want to sign out?',
      icon: 'question',
      showCancelButton: true,
      confirmButtonColor: '#08227B',
      cancelButtonColor: '#6c757d',
      confirmButtonText: 'Yes, sign out',
      cancelButtonText: 'Cancel'
    }).then((result) => {
      if (result.isConfirmed) {
        this.authService.logout();
        this.router.navigate(['/log-in']);
      }
    });
  }

  deleteAccount(): void {
    Swal.fire({
      title: 'Are you sure?',
      text: 'Your account will be permanently deleted and cannot be recovered!',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#d33',
      cancelButtonColor: '#08227B',
      confirmButtonText: 'Yes, delete account',
      cancelButtonText: 'Cancel'
    }).then((result) => {
      if (result.isConfirmed) {
        Swal.fire({
          title: 'Final Confirmation',
          text: 'This action cannot be undone. Do you want to continue?',
          icon: 'error',
          showCancelButton: true,
          confirmButtonColor: '#d33',
          cancelButtonColor: '#6c757d',
          confirmButtonText: 'Delete Permanently',
          cancelButtonText: 'Cancel'
        }).then((finalResult) => {
          if (finalResult.isConfirmed) {
            Swal.fire({
              icon: 'info',
              title: 'Coming Soon',
              text: 'Account deletion feature will be available soon.',
              confirmButtonColor: '#08227B'
            });
          }
        });
      }
    });
  }

  toggleDarkMode(): void {
    this.isDarkMode = !this.isDarkMode;
    localStorage.setItem('darkMode', this.isDarkMode.toString());
    this.applyTheme();
  }

  private applyTheme(): void {
    if (this.isDarkMode) {
      document.body.classList.add('dark-mode');
    } else {
      document.body.classList.remove('dark-mode');
    }
  }

  openEditModal(): void {
    this.showEditModal = true;
  }

  closeEditModal(): void {
    this.showEditModal = false;
    this.selectedFile = null;
    this.isImageDeleted = false;
    this.imagePreview = this.currentUser?.imageUrl || null;
    
    const fileInput = document.getElementById('profileImageInput') as HTMLInputElement;
    if (fileInput) {
      fileInput.value = '';
    }
  }

  openPasswordModal(): void {
    this.showPasswordModal = true;
  }

  closePasswordModal(): void {
    this.showPasswordModal = false;
    this.passwordForm.reset();
  }

  navigateToAddProperty(): void {
    this.router.navigate(['/add-property']);
  }

  showAboutUs(): void {
    Swal.fire({
      title: 'About Us',
      html: `
        <div style="text-align: left;">
          <h5>X-Rental Property Platform</h5>
          <p>We are a leading property rental platform in Egypt, helping property owners and tenants connect easily and securely.</p>
          
          <h6>Our Mission</h6>
          <p>To simplify the property rental process and make it accessible for everyone.</p>
          
          <h6>Contact Us</h6>
          <p>
            📧 Email: info@x-rental.com<br>
            📞 Phone: +20 123 456 7890<br>
            🌐 Website: www.x-rental.com
          </p>
        </div>
      `,
      confirmButtonColor: '#08227B',
      confirmButtonText: 'Close'
    });
  }
}


================================================
File: app/property-detail/property-detail.component.css
================================================
#propertyCarousel {
  max-height: 500px;
  overflow: hidden;
}

#propertyCarousel img {
  object-fit: cover;
  height: 500px;
  width: 100%;
}
/* Reviews Section Modern Styles */
.star-label {
  cursor: pointer;
  color: #e0e0e0;
  transition: all 0.2s ease;
}

.star-input input[type="radio"]:checked ~ .star-label,
.star-input .star-label:hover,
.star-input .star-label:hover ~ .star-label {
  color: #ffc107;
}

.star-input input[type="radio"]:checked + .star-label {
  color: #ffc107;
}

.review-card {
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  border: 1px solid transparent;
}

.review-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.08) !important;
  border-color: #dee2e6;
}

.avatar {
  font-weight: 600;
  font-size: 1.1rem;
}

.add-review-card {
  border-left: 4px solid #4361ee;
}


================================================
File: app/property-detail/property-detail.component.html
================================================
<!-- Property Detail Component HTML - Fixed disabled attributes -->
<div class="container py-4" *ngIf="!isLoading && property">
  <!-- Back Button -->
  <div class="mb-3">
    <button class="btn btn-outline-primary" (click)="goBack()">
      <i class="bi bi-arrow-left"></i> Back to Properties
    </button>
  </div>

  <!-- Property Header -->
  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-start mb-3">
        <div>
          <h1 class="property-title">{{ property.title }}</h1>
          <p class="text-muted mb-2">
            <i class="bi bi-geo-alt"></i> {{ property.street }}, {{ property.city }}, {{ property.governate }}
          </p>
          <div class="property-meta">
            <span class="badge bg-primary me-2">{{ property.propertyType }}</span>
            <span class="text-muted">Listed {{ formatDate(property.listedAt) }}</span>
          </div>
        </div>
        <div class="text-end">
          <h2 class="price-tag mb-3">{{ formatPrice(property.price) }}</h2>
          <button 
            class="btn" 
            [ngClass]="{
              'btn-danger': property.isFavorite,
              'btn-outline-danger': !property.isFavorite
            }"
            (click)="toggleFavorite()"
            [disabled]="isFavoriteLoading"
          >
            <span *ngIf="!isFavoriteLoading">
              <i class="bi" [ngClass]="{'bi-heart': !property.isFavorite, 'bi-heart-fill': property.isFavorite}"></i>
              {{ property.isFavorite ? 'Remove from Favorites' : 'Add to Favorites' }}
            </span>
            <span *ngIf="isFavoriteLoading">
              <span class="spinner-border spinner-border-sm me-2"></span>
              Updating...
            </span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Image Gallery - Carousel -->
  <div class="row mb-4">
    <div class="col-lg-8">
      <div class="image-gallery">
        <!-- Carousel -->
        <div *ngIf="property.propertyImages && property.propertyImages.length > 0; else noImages">
          <div id="propertyCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
              <div *ngFor="let image of property.propertyImages; let i = index" 
                   class="carousel-item" [class.active]="i === 0">
                <img [src]="image" class="d-block w-100" 
                     [alt]="property.title + ' - Image ' + (i + 1)"
                     (error)="onImageError($event)" loading="lazy">
              </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#propertyCarousel" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#propertyCarousel" data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Next</span>
            </button>
          </div>
        </div>
        
        <!-- No Images Template -->
        <ng-template #noImages>
          <div class="main-image-container">
            <img 
              src="assets/images/apartment.avif" 
              [alt]="property.title"
              class="main-image"
            >
            <div class="no-images-overlay">
              <p class="text-white">No images available</p>
            </div>
          </div>
        </ng-template>
      </div>
    </div>
    
    <!-- Property Info Sidebar -->
    <div class="col-lg-4">
      <div class="property-info-card">
        <h4>Property Details</h4>
        <div class="property-details">
          <div class="detail-row">
            <span class="detail-label">Size:</span>
            <span class="detail-value">{{ property.size }} mÂ²</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Bedrooms:</span>
            <span class="detail-value">{{ property.bedrooms }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Bathrooms:</span>
            <span class="detail-value">{{ property.bathrooms }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Type:</span>
            <span class="detail-value">{{ property.propertyType }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Listed:</span>
            <span class="detail-value">{{ formatDate(property.listedAt) }}</span>
          </div>
        </div>

        <!-- Owner Info -->
        <div class="owner-info mt-4">
          <h5>Owner Information</h5>
          <p class="mb-1">
            <strong>{{ property.ownerInfo.firstName }} {{ property.ownerInfo.lastName }}</strong>
          </p>
          <p class="mb-1">
            <i class="bi bi-envelope"></i> {{ property.ownerInfo.email }}
          </p>
          <p class="mb-3">
            <i class="bi bi-phone"></i> {{ property.ownerInfo.phoneNumber }}
          </p>
          <button class="btn btn-success w-100" (click)="contactOwner()">
            <i class="bi bi-whatsapp"></i> Contact via WhatsApp
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Property Description -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="description-section">
        <h3>Description</h3>
        <p>{{ property.description }}</p>
      </div>
    </div>
  </div>

  <!-- Amenities -->
  <div class="row mb-4" *ngIf="property.internalAmenities.length > 0 || property.externalAmenities.length > 0 || property.accessibilityAmenities.length > 0">
    <div class="col-12">
      <div class="amenities-section">
        <h3>Amenities</h3>
        <div class="row">
          <div class="col-md-4" *ngIf="property.internalAmenities.length > 0">
            <h5>Internal Amenities</h5>
            <ul class="amenities-list">
              <li *ngFor="let amenity of property.internalAmenities">
                <i class="bi bi-check-circle text-success"></i> {{ amenity }}
              </li>
            </ul>
          </div>
          <div class="col-md-4" *ngIf="property.externalAmenities.length > 0">
            <h5>External Amenities</h5>
            <ul class="amenities-list">
              <li *ngFor="let amenity of property.externalAmenities">
                <i class="bi bi-check-circle text-success"></i> {{ amenity }}
              </li>
            </ul>
          </div>
          <div class="col-md-4" *ngIf="property.accessibilityAmenities.length > 0">
            <h5>Accessibility Features</h5>
            <ul class="amenities-list">
              <li *ngFor="let amenity of property.accessibilityAmenities">
                <i class="bi bi-check-circle text-success"></i> {{ amenity }}
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Reviews Section -->
  <div class="row mt-5">
    <div class="col-12">
      <div class="reviews-section bg-white rounded-4 shadow-sm p-4">
        <h3 class="mb-4 pb-2 border-bottom border-2 border-primary-subtle">
          <i class="bi bi-chat-square-text-fill me-2 text-primary"></i>Customer Reviews
        </h3>
        
        <!-- Add Review Form -->
        <div class="add-review-card mb-5 p-4 bg-light rounded-4" *ngIf="isLoggedIn">
          <h5 class="mb-3 text-primary">
            <i class="bi bi-pencil-square me-2"></i>Share Your Experience
          </h5>
          <form [formGroup]="reviewForm" (ngSubmit)="submitReview()">
            <div class="mb-3">
              <label class="form-label fw-medium">Your Rating</label>
              <div class="star-rating d-flex">
                <div class="star-input">
                  <input type="radio" formControlName="rating" value="1" id="star1" class="d-none">
                  <label for="star1" class="star-label fs-3 mx-1">â˜†</label>
                  <input type="radio" formControlName="rating" value="2" id="star2" class="d-none">
                  <label for="star2" class="star-label fs-3 mx-1">â˜†</label>
                  <input type="radio" formControlName="rating" value="3" id="star3" class="d-none">
                  <label for="star3" class="star-label fs-3 mx-1">â˜†</label>
                  <input type="radio" formControlName="rating" value="4" id="star4" class="d-none">
                  <label for="star4" class="star-label fs-3 mx-1">â˜†</label>
                  <input type="radio" formControlName="rating" value="5" id="star5" class="d-none">
                  <label for="star5" class="star-label fs-3 mx-1">â˜†</label>
                </div>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label fw-medium">Your Comment</label>
              <textarea 
                class="form-control border-2 py-3 px-4" 
                formControlName="comment" 
                rows="3" 
                placeholder="Share your thoughts about this property..."
              ></textarea>
              <div *ngIf="reviewForm.get('comment')?.invalid && reviewForm.get('comment')?.touched" 
                   class="text-danger small mt-2">
                <i class="bi bi-exclamation-circle me-1"></i>Comment must be at least 10 characters
              </div>
            </div>
            <div class="d-flex justify-content-end">
              <button 
                type="submit" 
                class="btn btn-primary px-4 py-2 rounded-pill fw-medium"
                [disabled]="reviewForm.invalid || isSubmittingReview"
              >
                <span *ngIf="!isSubmittingReview">
                  <i class="bi bi-send me-2"></i>Post Review
                </span>
                <span *ngIf="isSubmittingReview">
                  <span class="spinner-border spinner-border-sm me-2"></span>
                  Submitting...
                </span>
              </button>
            </div>
          </form>
        </div>

        <!-- Login prompt for guests -->
        <div class="alert alert-info rounded-4 mb-4" *ngIf="!isLoggedIn">
          <div class="d-flex align-items-center">
            <i class="bi bi-info-circle-fill fs-5 me-3"></i>
            <div>
              Please <a [routerLink]="['/log-in']" class="alert-link fw-medium">log in</a> 
              to leave a review or add to favorites.
            </div>
          </div>
        </div>

        <!-- Reviews List -->
        <div class="reviews-list">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h5 class="mb-0">Customer Reviews ({{reviews.length}})</h5>
            <div class="dropdown">
              <button class="btn btn-outline-secondary dropdown-toggle rounded-pill" 
                      type="button" 
                      data-bs-toggle="dropdown">
                <i class="bi bi-filter me-2"></i>Sort by
              </button>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">Newest First</a></li>
                <li><a class="dropdown-item" href="#">Highest Rated</a></li>
                <li><a class="dropdown-item" href="#">Lowest Rated</a></li>
              </ul>
            </div>
          </div>
          
          <div class="review-card bg-white rounded-4 p-4 mb-4 shadow-sm" 
               *ngFor="let review of reviews">
            <div class="review-header mb-3">
              <div class="d-flex justify-content-between">
                <div class="reviewer-info d-flex align-items-center">
                  <div class="avatar bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3"
                       style="width: 40px; height: 40px;">
                    {{ review.userName?.charAt(0) || 'A' }}
                  </div>
                  <div>
                    <strong>{{ review.userName || 'Anonymous' }}</strong>
                    <div class="rating text-warning">
                      <span *ngFor="let star of getStarArray(review.rating)" class="star filled">â˜…</span>
                      <span *ngFor="let star of getStarArray(5 - review.rating)" class="star">â˜†</span>
                    </div>
                  </div>
                </div>
                <small class="text-muted align-self-center">{{ formatDate(review.reviewDate || '') }}</small>
              </div>
            </div>
            <p class="review-comment text-secondary mb-0">
              {{ review.comment }}
            </p>
          </div>
          
          <div *ngIf="reviews.length === 0" class="no-reviews text-center py-5">
            <i class="bi bi-chat-left-quote fs-1 text-muted mb-3"></i>
            <p class="text-muted fs-5">No reviews yet. Be the first to review this property!</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading State -->
<div class="loading-container text-center py-5" *ngIf="isLoading">
  <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
  <p class="mt-3">Loading property details...</p>
</div>

  <!-- Reviews Section -->


      <!-- Login prompt for guests -->
      <div class="alert alert-info rounded-4 mb-4" *ngIf="!isLoggedIn">
        <div class="d-flex align-items-center">
          <i class="bi bi-info-circle-fill fs-5 me-3"></i>
          <div>
            Please <a [routerLink]="['/log-in']" class="alert-link fw-medium">log in</a> 
            to leave a review or add to favorites.
          </div>
        </div>
      </div>

      <!-- Reviews List -->
     

       
       
  


<!-- Loading State -->
<div class="loading-container text-center py-5" *ngIf="isLoading">
  <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
  <p class="mt-3">Loading property details...</p>
</div>


================================================
File: app/property-detail/property-detail.component.spec.ts
================================================
import { ComponentFixture, TestBed } from '@angular/core/testing';

import { PropertyDetailComponent } from './property-detail.component';

describe('PropertyDetailComponent', () => {
  let component: PropertyDetailComponent;
  let fixture: ComponentFixture<PropertyDetailComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [PropertyDetailComponent]
    })
    .compileComponents();
    
    fixture = TestBed.createComponent(PropertyDetailComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});



================================================
File: app/property-detail/property-detail.component.ts
================================================
import { Component, OnInit, OnDestroy } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule, ReactiveFormsModule, FormBuilder, FormGroup, Validators } from '@angular/forms';
import { RouterModule, ActivatedRoute, Router } from '@angular/router';
import { Subscription } from 'rxjs';
import { PropertyService, Property, Review } from '../services/property.service';
import { AuthService } from '../services/auth.service';
import Swal from 'sweetalert2';

@Component({
  selector: 'app-property-detail',
  standalone: true,
  imports: [CommonModule, FormsModule, ReactiveFormsModule, RouterModule],
  templateUrl: './property-detail.component.html',
  styleUrls: ['./property-detail.component.css']
})
export class PropertyDetailComponent implements OnInit, OnDestroy {
  property?: Property;
  reviews: Review[] = [];
  reviewForm!: FormGroup;
  currentImageIndex = 0;
  isLoading = true;
  isSubmittingReview = false;
  isLoggedIn = false;
  isFavoriteLoading = false;
  currentUser: any;
  
  private subscriptions: Subscription[] = [];

  constructor(
    private route: ActivatedRoute,
    private router: Router,
    private propertyService: PropertyService,
    private authService: AuthService,
    private formBuilder: FormBuilder
  ) {
    this.reviewForm = this.formBuilder.group({
      rating: [5, [Validators.required, Validators.min(1), Validators.max(5)]],
      comment: ['', [Validators.required, Validators.minLength(10)]]
    });
  }

  ngOnInit(): void {
    // Check authentication status
    this.isLoggedIn = this.authService.isLoggedIn();
    this.currentUser = this.authService.getUserData();

    // Subscribe to authentication changes
    const authSub = this.authService.currentUser$.subscribe(user => {
      this.isLoggedIn = !!user;
      this.currentUser = user;
    });
    this.subscriptions.push(authSub);

    // Get property ID from route
    const routeSub = this.route.params.subscribe(params => {
      const propertyId = +params['id'];
      if (propertyId) {
        this.loadProperty(propertyId);
        this.loadReviews(propertyId);
      }
    });
    this.subscriptions.push(routeSub);
  }

  ngOnDestroy(): void {
    this.subscriptions.forEach(sub => sub.unsubscribe());
  }

  loadProperty(propertyId: number): void {
    this.isLoading = true;
    console.log('🔍 Loading property with ID:', propertyId);
    
    const propertySub = this.propertyService.getPropertyById(propertyId).subscribe({
      next: (property) => {
        console.log('✅ Property loaded:', property);
        this.property = this.propertyService.formatProperty(property);
        
        // Log images for debugging
        console.log('🖼️ Property images:', this.property.propertyImages);
        
        // Load favorite status if user is logged in
        if (this.isLoggedIn && this.property) {
          this.loadFavoriteStatus(this.property.propertyId);
        }
        
        this.isLoading = false;
      },
      error: (error) => {
        console.error('❌ Error loading property:', error);
        this.isLoading = false;
        Swal.fire({
          icon: 'error',
          title: 'Property Not Found',
          text: 'The property you are looking for could not be found.',
          confirmButtonColor: '#08227B'
        }).then(() => {
          this.router.navigate(['/home']);
        });
      }
    });
    this.subscriptions.push(propertySub);
  }

  loadFavoriteStatus(propertyId: number): void {
    if (!this.isLoggedIn || !this.property) return;
    
    console.log('🔍 Checking favorite status for property:', propertyId);
    
    const favSub = this.propertyService.isPropertyInFavorites(propertyId).subscribe({
      next: (isFavorite) => {
        console.log('✅ Favorite status loaded:', isFavorite);
        if (this.property) {
          this.property.isFavorite = isFavorite;
        }
      },
      error: (error) => {
        console.error('❌ Error checking favorite status:', error);
        if (this.property) {
          this.property.isFavorite = false;
        }
      }
    });
    this.subscriptions.push(favSub);
  }

  loadReviews(propertyId: number): void {
    const reviewsSub = this.propertyService.getPropertyReviews(propertyId).subscribe({
      next: (reviews) => {
        this.reviews = reviews;
        console.log('✅ Reviews loaded:', reviews);
      },
      error: (error) => {
        console.error('❌ Error loading reviews:', error);
      }
    });
    this.subscriptions.push(reviewsSub);
  }

  // Image carousel methods
  previousImage(): void {
    if (this.property && this.property.propertyImages.length > 0) {
      this.currentImageIndex = this.currentImageIndex > 0 
        ? this.currentImageIndex - 1 
        : this.property.propertyImages.length - 1;
      console.log('⬅️ Previous image, current index:', this.currentImageIndex);
    }
  }

  nextImage(): void {
    if (this.property && this.property.propertyImages.length > 0) {
      this.currentImageIndex = this.currentImageIndex < this.property.propertyImages.length - 1 
        ? this.currentImageIndex + 1 
        : 0;
      console.log('➡️ Next image, current index:', this.currentImageIndex);
    }
  }

  selectImage(index: number): void {
    this.currentImageIndex = index;
    console.log('🖼️ Selected image index:', index);
  }

  getCurrentImageUrl(): string {
    if (this.property && this.property.propertyImages.length > 0) {
      return this.property.propertyImages[this.currentImageIndex] || 'assets/images/apartment.avif';
    }
    return 'assets/images/apartment.avif';
  }

  onImageError(event: any): void {
    console.log('❌ Image failed to load, using fallback');
    event.target.src = 'assets/images/apartment.avif';
  }

  // Review methods
  submitReview(): void {
    if (!this.isLoggedIn) {
      Swal.fire({
        icon: 'warning',
        title: 'Login Required',
        text: 'Please log in to leave a review.',
        confirmButtonColor: '#08227B'
      });
      return;
    }

    if (this.reviewForm.invalid || !this.property) {
      Object.keys(this.reviewForm.controls).forEach(key => {
        this.reviewForm.get(key)?.markAsTouched();
      });
      return;
    }

    this.isSubmittingReview = true;
    this.reviewForm.disable(); // 🔥 Disable form during submission

    const reviewData = {
      rating: this.reviewForm.value.rating,
      comment: this.reviewForm.value.comment
    };

    console.log('📝 Submitting review:', reviewData);

    const reviewSub = this.propertyService.addReview(this.property.propertyId, reviewData).subscribe({
      next: (response) => {
        this.isSubmittingReview = false;
        this.reviewForm.enable(); // 🔥 Re-enable form
        console.log('✅ Review added successfully:', response);
        
        Swal.fire({
          icon: 'success',
          title: 'Review Added',
          text: 'Your review has been added successfully!',
          showConfirmButton: false,
          timer: 1500
        });
        
        // Reset form and reload reviews
        this.reviewForm.reset({ rating: 5, comment: '' });
        this.loadReviews(this.property!.propertyId);
      },
      error: (error) => {
        this.isSubmittingReview = false;
        this.reviewForm.enable(); // 🔥 Re-enable form on error
        console.error('❌ Error adding review:', error);
        Swal.fire({
          icon: 'error',
          title: 'Review Failed',
          text: 'Failed to add your review. Please try again.',
          confirmButtonColor: '#08227B'
        });
      }
    });
    this.subscriptions.push(reviewSub);
  }

  // Favorite methods
  toggleFavorite(): void {
    if (!this.isLoggedIn) {
      Swal.fire({
        icon: 'warning',
        title: 'Login Required',
        text: 'Please log in to add properties to favorites.',
        confirmButtonColor: '#08227B'
      });
      return;
    }

    if (!this.property || this.isFavoriteLoading) return;

    console.log('❤️ Toggling favorite for property:', this.property.propertyId, 'Current status:', this.property.isFavorite);

    this.isFavoriteLoading = true;
    
    const originalState = this.property.isFavorite;
    this.property.isFavorite = !this.property.isFavorite;

    const action = this.property.isFavorite ? 'add' : 'remove';
    const apiCall = this.property.isFavorite 
      ? this.propertyService.addToFavorites(this.property.propertyId)
      : this.propertyService.removeFromFavorites(this.property.propertyId);

    const favSub = apiCall.subscribe({
      next: (response) => {
        this.isFavoriteLoading = false;
        console.log(`✅ ${action} favorite successful:`, response);
        
        const message = this.property!.isFavorite ? 'Added to favorites' : 'Removed from favorites';
        const icon = this.property!.isFavorite ? 'success' : 'info';
        
        Swal.fire({
          position: 'top-end',
          icon: icon,
          title: message,
          showConfirmButton: false,
          timer: 1500
        });
      },
      error: (error) => {
        this.isFavoriteLoading = false;
        console.error('❌ Error updating favorites:', error);
        
        if (error.status === 404 && !this.property!.isFavorite) {
          console.log('⚠️ Property was not in favorites (404), but UI updated correctly');
          Swal.fire({
            position: 'top-end',
            icon: 'success',
            title: 'Removed from favorites',
            showConfirmButton: false,
            timer: 1500
          });
          return;
        }
        
        if (error.status === 200 || error.status === 0) {
          console.log('✅ Actually successful - keeping optimistic update');
          const message = this.property!.isFavorite ? 'Added to favorites' : 'Removed from favorites';
          Swal.fire({
            position: 'top-end',
            icon: 'success',
            title: message,
            showConfirmButton: false,
            timer: 1500
          });
          return;
        }
        
        this.property!.isFavorite = originalState;
        
        let errorMessage = 'Failed to update favorites. Please try again.';
        if (error.status === 401) {
          errorMessage = 'You need to be logged in to manage favorites.';
        } else if (error.status === 500) {
          errorMessage = 'Server error. Please try again later.';
        }
        
        Swal.fire({
          icon: 'error',
          title: 'Failed to update favorites',
          text: errorMessage,
          confirmButtonColor: '#08227B'
        });
      }
    });
    this.subscriptions.push(favSub);
  }

  contactOwner(): void {
    if (!this.property) return;

    const phoneNumber = this.property.ownerInfo.phoneNumber;
    const message = `Hello, I'm interested in your property: ${this.property.title}`;
    const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
    
    console.log('📱 Opening WhatsApp:', whatsappUrl);
    window.open(whatsappUrl, '_blank');
  }

  getStarArray(count: number): boolean[] {
    return Array(count).fill(true);
  }

  formatPrice(price: number): string {
    return new Intl.NumberFormat('en-EG', {
      style: 'currency',
      currency: 'EGP',
      minimumFractionDigits: 0
    }).format(price);
  }

  formatDate(dateString: string): string {
    return new Date(dateString).toLocaleDateString('en-EG', {
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });
  }

  goBack(): void {
    this.router.navigate(['/home']);
  }

  debugImages(): void {
    console.log('🐛 Debug Images:');
    console.log('Property:', this.property);
    console.log('Images array:', this.property?.propertyImages);
    console.log('Current image index:', this.currentImageIndex);
    console.log('Current image URL:', this.getCurrentImageUrl());
  }

  trackByIndex(index: number, item: any): number {
    return index;
  }
}


================================================
File: app/reset-password/reset-password.component.css
================================================
.container {
    display: flex;
    height: 100vh;
    width: 100%;
    font-family: Arial, sans-serif;
  }
  
  /* Left side - Blue background with image */
  .image-side {
    width: 50%;
    background-color: #0c2b7a;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
  }
  
  .close-button {
    position: absolute;
    top: 20px;
    right: 20px;
  }
  
  .close-btn {
    background: transparent;
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
  }
  
  .image-container {
    width: 80%;
    max-width: 500px;
    display: flex;
    justify-content: center;
  }
  
  .image-container img {
    max-width: 100%;
    height: auto;
  }
  
  /* Right side - Form inputs */
  .form-side {
    width: 50%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 40px;
  }
  
  .form-container {
    width: 100%;
    max-width: 450px;
  }
  
  .title {
    font-size: 2.5rem;
    color: #0c2b7a;
    margin-bottom: 10px;
    font-weight: bold;
  }
  
  .subtitle {
    font-size: 1rem;
    color: #666;
    margin-bottom: 40px;
  }
  
  /* Progress steps */
  .steps-container {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 50px;
  }
  
  .step {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #e0e0e0;
    position: relative;
  }
  
  .step.active {
    background-color: #0c2b7a;
  }
  
  .step.completed {
    background-color: #0c2b7a;
  }
  
  .step-number {
    color: #fff;
    font-weight: bold;
  }
  
  .step-line {
    flex-grow: 1;
    height: 2px;
    background-color: #e0e0e0;
    margin: 0 10px;
    max-width: 80px;
  }
  
  .step-line.completed {
    background-color: #0c2b7a;
  }
  
  .form-group {
    margin-bottom: 20px;
  }
  
  label {
    display: block;
    font-size: 1rem;
    color: #333;
    margin-bottom: 8px;
    font-weight: 500;
  }
  
  .password-input {
    position: relative;
  }
  
  .form-control {
    width: 100%;
    padding: 15px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    font-size: 16px;
    outline: none;
    transition: border-color 0.3s;
    background-color: #f5f8ff;
  }
  
  .form-control:focus {
    border-color: #0c2b7a;
  }
  
  .form-control.invalid {
    border-color: #ff3860;
  }
  
  .toggle-password {
    position: absolute;
    top: 50%;
    right: 15px;
    transform: translateY(-50%);
    color: #666;
    cursor: pointer;
  }
  
  .error-message {
    color: #ff3860;
    font-size: 14px;
    margin-top: 5px;
  }
  
  .reset-btn {
    width: 100%;
    padding: 15px;
    background-color: #0c2b7a;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s;
    margin-top: 20px;
    margin-bottom: 20px;
  }
  
  .reset-btn:hover {
    background-color: #091e55;
  }
  
  /* Responsive design */
  @media (max-width: 768px) {
    .container {
      flex-direction: column-reverse;
    }
    
    .image-side {
      width: 100%;
      height: 30vh;
    }
    
    .form-side {
      width: 100%;
      height: 70vh;
    }
  }


================================================
File: app/reset-password/reset-password.component.html
================================================
<div class="container">
    <!-- Left side (Blue background with image) -->
    <div class="image-side">
      <div class="close-button">
        <button class="close-btn">âœ•</button>
      </div>
      <div class="image-container">
        <img src="../../assets/images/resetpassword.png" alt="Reset password illustration">
      </div>
    </div>
  
    <!-- Right side (Form inputs) -->
    <div class="form-side">
      <div class="form-container">
        <h1 class="title">Reset Password</h1>
        <p class="subtitle">Set your new password</p>
  
        <!-- Progress steps -->
        <div class="steps-container">
          <div class="step completed">
            <div class="step-number">1</div>
          </div>
          <div class="step-line completed"></div>
          <div class="step completed">
            <div class="step-number">2</div>
          </div>
          <div class="step-line completed"></div>
          <div class="step active">
            <div class="step-number">3</div>
          </div>
        </div>
  
        <form (ngSubmit)="onSubmit()" [formGroup]="resetForm">
          <!-- Password input -->
          <div class="form-group">
            <label for="password">New password</label>
            <div class="password-input">
              <input 
                [type]="showPassword ? 'text' : 'password'" 
                id="password"
                formControlName="password" 
                placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                class="form-control"
                [ngClass]="{'invalid': submitted && f['password'].errors}"
              >
              <div class="toggle-password" (click)="togglePasswordVisibility()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
              </div>
            </div>
            <div *ngIf="submitted && f['password'].errors" class="error-message">
              <div *ngIf="f['password'].errors['required']">Password is required</div>
              <div *ngIf="f['password'].errors['minlength']">Password must be at least 6 characters</div>
            </div>
          </div>
  
          <!-- Confirm password input -->
          <div class="form-group">
            <label for="confirmPassword">Confirm new password</label>
            <div class="password-input">
              <input 
                [type]="showConfirmPassword ? 'text' : 'password'" 
                id="confirmPassword"
                formControlName="confirmPassword" 
                placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                class="form-control"
                [ngClass]="{'invalid': submitted && f['confirmPassword'].errors}"
              >
              <div class="toggle-password" (click)="toggleConfirmPasswordVisibility()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
              </div>
            </div>
            <div *ngIf="submitted && f['confirmPassword'].errors" class="error-message">
              <div *ngIf="f['confirmPassword'].errors['required']">Confirm password is required</div>
              <div *ngIf="f['confirmPassword'].errors['matching']">Passwords must match</div>
            </div>
          </div>
          
          <!-- Submit button -->
          <button type="submit" class="reset-btn">Change Password</button>
        </form>
      </div>
    </div>
  </div>


================================================
File: app/reset-password/reset-password.component.spec.ts
================================================
import { ComponentFixture, TestBed } from '@angular/core/testing';

import { ResetPasswordComponent } from './reset-password.component';

describe('ResetPasswordComponent', () => {
  let component: ResetPasswordComponent;
  let fixture: ComponentFixture<ResetPasswordComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [ResetPasswordComponent]
    })
    .compileComponents();
    
    fixture = TestBed.createComponent(ResetPasswordComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});



================================================
File: app/reset-password/reset-password.component.ts
================================================
import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators, ReactiveFormsModule, AbstractControl, ValidationErrors } from '@angular/forms';
import { Router, ActivatedRoute, RouterModule } from '@angular/router';
import { CommonModule } from '@angular/common';
import Swal from 'sweetalert2';
import { AuthService, ResetPasswordRequest } from '../services/auth.service';

@Component({
  selector: 'app-reset-password',
  templateUrl: './reset-password.component.html',
  styleUrls: ['./reset-password.component.css'],
  standalone: true,
  imports: [CommonModule, ReactiveFormsModule, RouterModule]
})
export class ResetPasswordComponent implements OnInit {
  resetForm!: FormGroup;
  submitted = false;
  email: string = '';
  showPassword = false;
  showConfirmPassword = false;
  isLoading = false;
  isVerified = false;

  constructor(
    private formBuilder: FormBuilder,
    private router: Router,
    private route: ActivatedRoute,
    private authService: AuthService
  ) { }

  ngOnInit(): void {
    this.resetForm = this.formBuilder.group({
      password: ['', [Validators.required, Validators.minLength(6)]],
      confirmPassword: ['', Validators.required]
    }, {
      validators: this.passwordMatchValidator
    });

    // Get email and verification status from route parameters
    this.route.queryParams.subscribe(params => {
      this.email = params['email'] || params['contact'] || '';
      this.isVerified = params['verified'] === 'true';
      
      if (!this.email) {
        // No email provided, redirect to forgot password
        this.router.navigate(['/forget-pass']);
        return;
      }
      
      if (!this.isVerified) {
        // Email not verified, redirect to OTP verification
        this.router.navigate(['/otp-verification'], { 
          queryParams: { email: this.email } 
        });
      }
    });
  }

  // Custom validator for password matching
  passwordMatchValidator(control: AbstractControl): ValidationErrors | null {
    const password = control.get('password');
    const confirmPassword = control.get('confirmPassword');

    if (password && confirmPassword && password.value !== confirmPassword.value) {
      confirmPassword.setErrors({ matching: true });
      return { matching: true };
    }
    return null;
  }

  // Getter for easy access to form fields
  get f() { return this.resetForm.controls; }

  togglePasswordVisibility(): void {
    this.showPassword = !this.showPassword;
  }

  toggleConfirmPasswordVisibility(): void {
    this.showConfirmPassword = !this.showConfirmPassword;
  }

  onSubmit(): void {
    this.submitted = true;

    // Stop if form is invalid
    if (this.resetForm.invalid) {
      return;
    }

    this.isLoading = true;

    // Prepare reset password request
    const resetRequest: ResetPasswordRequest = {
      email: this.email,
      newPassword: this.resetForm.value.password,
      confirmPassword: this.resetForm.value.confirmPassword
    };

    // Call reset password API
    this.authService.resetPassword(resetRequest).subscribe({
      next: (response) => {
        this.isLoading = false;
        
        if (response.status === 'Success') {
          Swal.fire({
            icon: 'success',
            title: 'Password Reset Successful',
            text: 'Your password has been reset successfully! You can now log in with your new password.',
            confirmButtonColor: '#08227B'
          }).then(() => {
            // Navigate to login page
            this.router.navigate(['/log-in']);
          });
        } else {
          Swal.fire({
            icon: 'error',
            title: 'Reset Failed',
            text: response.message || 'Failed to reset password. Please try again.',
            confirmButtonColor: '#08227B'
          });
        }
      },
      error: (error) => {
        this.isLoading = false;
        console.error('Reset password error:', error);
        
        let errorMessage = 'Failed to reset password. Please try again.';
        if (error.error && error.error.message) {
          errorMessage = error.error.message;
        } else if (error.status === 400) {
          errorMessage = 'Invalid email or password format.';
        } else if (error.status === 404) {
          errorMessage = 'Email not found or verification expired.';
        }

        Swal.fire({
          icon: 'error',
          title: 'Reset Failed',
          text: errorMessage,
          confirmButtonColor: '#08227B'
        });
      }
    });
  }

  // Go back to OTP verification
  goBack(): void {
    this.router.navigate(['/otp-verification'], { 
      queryParams: { email: this.email } 
    });
  }

  // Go to login page
  goToLogin(): void {
    this.router.navigate(['/log-in']);
  }
}


================================================
File: app/services/amenities.service.ts
================================================
import { Injectable } from '@angular/core';
import { HttpClient, HttpHeaders } from '@angular/common/http';
import { Observable } from 'rxjs';
import { catchError, map } from 'rxjs/operators';
import { AuthService } from './auth.service';

export interface Amenity {
  amenityId: number;
  name: string;
}

export interface AmenityResponse {
  $values: Amenity[];
}

export interface CreateAmenityRequest {
  name: string;
}

export interface CreateAmenityResponse {
  id: number;
  name: string;
  properties: {
    $values: any[];
  };
}

export type AmenityType = 'internal' | 'external' | 'accessibility';

@Injectable({
  providedIn: 'root'
})
export class AmenitiesService {
  private apiUrl = 'http://digitalpropertyapi.runasp.net/api/Amenties';

  constructor(
    private http: HttpClient,
    private authService: AuthService
  ) { }

  // Get internal amenities
  getInternalAmenities(): Observable<Amenity[]> {
    return this.http.get<AmenityResponse>(`${this.apiUrl}/internal`)
      .pipe(
        map(response => response.$values || []),
        catchError((error) => {
          console.error('Error fetching internal amenities:', error);
          throw error;
        })
      );
  }

  // Get external amenities
  getExternalAmenities(): Observable<Amenity[]> {
    return this.http.get<AmenityResponse>(`${this.apiUrl}/external`)
      .pipe(
        map(response => response.$values || []),
        catchError((error) => {
          console.error('Error fetching external amenities:', error);
          throw error;
        })
      );
  }

  // Get accessibility amenities
  getAccessibilityAmenities(): Observable<Amenity[]> {
    return this.http.get<AmenityResponse>(`${this.apiUrl}/accessibility`)
      .pipe(
        map(response => response.$values || []),
        catchError((error) => {
          console.error('Error fetching accessibility amenities:', error);
          throw error;
        })
      );
  }

  // Get all amenities by type
  getAmenitiesByType(type: AmenityType): Observable<Amenity[]> {
    switch (type) {
      case 'internal':
        return this.getInternalAmenities();
      case 'external':
        return this.getExternalAmenities();
      case 'accessibility':
        return this.getAccessibilityAmenities();
      default:
        throw new Error(`Invalid amenity type: ${type}`);
    }
  }

  // Create internal amenity
  createInternalAmenity(request: CreateAmenityRequest): Observable<CreateAmenityResponse> {
    return this.http.post<CreateAmenityResponse>(`${this.apiUrl}/internal`, request, {
      headers: this.getAuthHeaders()
    }).pipe(
      catchError((error) => {
        console.error('Error creating internal amenity:', error);
        throw error;
      })
    );
  }

  // Create external amenity
  createExternalAmenity(request: CreateAmenityRequest): Observable<CreateAmenityResponse> {
    return this.http.post<CreateAmenityResponse>(`${this.apiUrl}/external`, request, {
      headers: this.getAuthHeaders()
    }).pipe(
      catchError((error) => {
        console.error('Error creating external amenity:', error);
        throw error;
      })
    );
  }

  // Create accessibility amenity
  createAccessibilityAmenity(request: CreateAmenityRequest): Observable<CreateAmenityResponse> {
    return this.http.post<CreateAmenityResponse>(`${this.apiUrl}/accessibility`, request, {
      headers: this.getAuthHeaders()
    }).pipe(
      catchError((error) => {
        console.error('Error creating accessibility amenity:', error);
        throw error;
      })
    );
  }

  // Create amenity by type
  createAmenityByType(type: AmenityType, request: CreateAmenityRequest): Observable<CreateAmenityResponse> {
    switch (type) {
      case 'internal':
        return this.createInternalAmenity(request);
      case 'external':
        return this.createExternalAmenity(request);
      case 'accessibility':
        return this.createAccessibilityAmenity(request);
      default:
        throw new Error(`Invalid amenity type: ${type}`);
    }
  }

  // Delete internal amenity
  deleteInternalAmenity(id: number): Observable<any> {
    return this.http.delete(`${this.apiUrl}/internal/${id}`, {
      headers: this.getAuthHeaders()
    }).pipe(
      catchError((error) => {
        console.error('Error deleting internal amenity:', error);
        throw error;
      })
    );
  }

  // Delete external amenity
  deleteExternalAmenity(id: number): Observable<any> {
    return this.http.delete(`${this.apiUrl}/external/${id}`, {
      headers: this.getAuthHeaders()
    }).pipe(
      catchError((error) => {
        console.error('Error deleting external amenity:', error);
        throw error;
      })
    );
  }

  // Delete accessibility amenity
  deleteAccessibilityAmenity(id: number): Observable<any> {
    return this.http.delete(`${this.apiUrl}/accessibility/${id}`, {
      headers: this.getAuthHeaders()
    }).pipe(
      catchError((error) => {
        console.error('Error deleting accessibility amenity:', error);
        throw error;
      })
    );
  }

  // Delete amenity by type
  deleteAmenityByType(type: AmenityType, id: number): Observable<any> {
    switch (type) {
      case 'internal':
        return this.deleteInternalAmenity(id);
      case 'external':
        return this.deleteExternalAmenity(id);
      case 'accessibility':
        return this.deleteAccessibilityAmenity(id);
      default:
        throw new Error(`Invalid amenity type: ${type}`);
    }
  }

  // Helper method to get auth headers
  private getAuthHeaders(): HttpHeaders {
    return this.authService.getAuthHeaders();
  }

  // Get amenity type display name
  getAmenityTypeDisplayName(type: AmenityType): string {
    const displayNames = {
      'internal': 'Internal Amenities',
      'external': 'External Amenities',
      'accessibility': 'Accessibility Features'
    };
    return displayNames[type];
  }

 
}


================================================
File: app/services/auth.service.ts
================================================
import { Injectable } from '@angular/core';
import { HttpClient, HttpHeaders } from '@angular/common/http';
import { Observable, BehaviorSubject } from 'rxjs';
import { tap, catchError, map } from 'rxjs/operators';
import { CookieService } from 'ngx-cookie-service';

export interface LoginRequest {
  email: string;
  password: string;
}

export interface LoginResponse {
  $id?: string;
  token: string;
  email: string;
  displayName: string;
  status?: string;
  message?: string;
}

export interface SignupRequest {
  firstName: string;
  lastName: string;
  email: string;
  phoneNumber: string;
  city: string;
  birthOfDate: string;
  password: string;
  confirmPassword: string;
  isTermsAccepted: boolean;
}

export interface SignupResponse {
  $id?: string;
  status: string;
  message: string;
  userId?: string;
}

export interface ForgotPasswordRequest {
  email: string;
}

export interface ForgotPasswordResponse {
  $id?: string;
  status: string;
  message: string;
}

export interface VerifyOtpRequest {
  email: string;
  otp: string;
}

export interface VerifyOtpResponse {
  $id?: string;
  status: string;
  message: string;
}

export interface ResetPasswordRequest {
  email: string;
  newPassword: string;
  confirmPassword: string;
}

export interface ResetPasswordResponse {
  $id?: string;
  status: string;
  message: string;
}

export interface ResendOtpRequest {
  email: string;
}

export interface ResendOtpResponse {
  $id?: string;
  status: string;
  message: string;
}

export interface ResendEmailConfirmationOtpRequest {
  email: string;
}

export interface ResendEmailConfirmationOtpResponse {
  $id?: string;
  status: string;
  message: string;
}

export interface ChangePasswordRequest {
  oldPassword: string;
  newPassword: string;
  confirmNewPassword: string;
}

export interface UserProfile {
  userId: string;
  firstName: string;
  lastName: string;
  email: string;
  phoneNumber?: string;
  city?: string;
  imageUrl?: string;
}

@Injectable({
  providedIn: 'root'
})
export class AuthService {
  private apiUrl = 'http://digitalpropertyapi.runasp.net/api/Authentication';
  private userApiUrl = 'http://digitalpropertyapi.runasp.net/api/User';
  
  private currentUserSubject = new BehaviorSubject<any>(null);
  public currentUser$ = this.currentUserSubject.asObservable();

  constructor(
    private http: HttpClient,
    private cookieService: CookieService
  ) {
    const token = this.cookieService.get('token');
    if (token) {
      this.loadUserFromStorage();
    }
  }

  // Login method
  login(credentials: LoginRequest): Observable<LoginResponse> {
    const loginDto = {
      email: credentials.email,
      password: credentials.password
    };

    return this.http.post<LoginResponse>(`${this.apiUrl}/login`, loginDto, {
      headers: new HttpHeaders({
        'Content-Type': 'application/json',
        'Accept': '*/*'
      })
    }).pipe(
      tap((response: LoginResponse) => {
        console.log('Login response:', response);
        
        if (response.status === 'Error') {
          throw new Error(response.message || 'Login failed');
        }
        
        if (response.token) {
          this.cookieService.set('token', response.token, 7);
          
          const nameParts = response.displayName?.split(' ') || ['User'];
          const userData = {
            email: response.email,
            firstName: nameParts[0] || 'User',
            lastName: nameParts.slice(1).join(' ') || '',
            displayName: response.displayName,
            token: response.token
          };
          
          localStorage.setItem('userData', JSON.stringify(userData));
          this.currentUserSubject.next(userData);
        }
      }),
      catchError((error) => {
        console.error('Login error:', error);
        
        let errorMessage = 'Login failed. Please try again.';
        
        if (error.error && error.error.message) {
          errorMessage = error.error.message;
        } else if (error.status === 500) {
          errorMessage = 'Server error. Please try again later.';
        } else if (error.status === 401) {
          errorMessage = 'Invalid email or password.';
        } else if (error.status === 404) {
          errorMessage = 'Login service is temporarily unavailable.';
        }
        
        throw new Error(errorMessage);
      })
    );
  }

  // Sign up method
  signup(userData: SignupRequest): Observable<SignupResponse> {
    const userDto = {
      firstName: userData.firstName,
      lastName: userData.lastName,
      email: userData.email,
      phoneNumber: userData.phoneNumber,
      city: userData.city,
      birthOfDate: userData.birthOfDate,
      password: userData.password,
      confirmPassword: userData.confirmPassword,
      isTermsAccepted: userData.isTermsAccepted
    };

    return this.http.post<SignupResponse>(`${this.apiUrl}/signup`, userDto, {
      headers: new HttpHeaders({
        'Content-Type': 'application/json',
        'Accept': '*/*'
      })
    }).pipe(
      tap((response) => {
        console.log('Signup response:', response);
        
        if (response.status === 'Error') {
          throw new Error(response.message || 'Signup failed');
        }
      }),
      catchError((error) => {
        console.error('Signup error:', error);
        
        let errorMessage = 'Registration failed. Please try again.';
        
        if (error.error && error.error.message) {
          errorMessage = error.error.message;
        } else if (error.status === 500) {
          errorMessage = 'Server error. Please try again later.';
        } else if (error.status === 409) {
          errorMessage = 'This email address is already registered.<br>Please try logging in or use a different email.';
        }
        
        throw new Error(errorMessage);
      })
    );
  }

  // Forgot password method
  forgotPassword(request: ForgotPasswordRequest): Observable<ForgotPasswordResponse> {
    const emailDto = { email: request.email };
    
    console.log('Sending forgot password request:', emailDto);
    
    return this.http.post<ForgotPasswordResponse>(`${this.apiUrl}/forgot-password`, emailDto, {
      headers: new HttpHeaders({
        'Content-Type': 'application/json',
        'Accept': '*/*'
      })
    }).pipe(
      tap((response) => {
        console.log('Forgot password raw response:', response);
      }),
      map((response: any) => {
        return {
          status: response.status || 'Success',
          message: response.message || 'OTP sent successfully for password reset.'
        } as ForgotPasswordResponse;
      }),
      catchError((error) => {
        console.error('Forgot password error:', error);
        let errorMessage = 'Failed to send reset email. Please try again.';
        
        if (error.error && error.error.message) {
          errorMessage = error.error.message;
        } else if (error.status === 404) {
          errorMessage = 'Email not found. Please check your email address.';
        } else if (error.status === 400) {
          errorMessage = 'Invalid email format.';
        }
        
        throw new Error(errorMessage);
      })
    );
  }

  // Verify OTP method
  verifyOtp(request: VerifyOtpRequest): Observable<VerifyOtpResponse> {
    const otpDto = {
      email: request.email,
      otp: request.otp
    };
    
    return this.http.post<VerifyOtpResponse>(`${this.apiUrl}/verify-otp`, otpDto, {
      headers: new HttpHeaders({
        'Content-Type': 'application/json',
        'Accept': '*/*'
      })
    }).pipe(
      map((response: any) => {
        return {
          status: response.status || 'Success',
          message: response.message || 'OTP verified successfully.'
        } as VerifyOtpResponse;
      }),
      catchError((error) => {
        console.error('Verify OTP error:', error);
        let errorMessage = 'Invalid OTP. Please try again.';
        
        if (error.error && error.error.message) {
          errorMessage = error.error.message;
        }
        
        throw new Error(errorMessage);
      })
    );
  }

  // Reset password method
  resetPassword(request: ResetPasswordRequest): Observable<ResetPasswordResponse> {
    const resetDto = {
      email: request.email,
      newPassword: request.newPassword,
      confirmPassword: request.confirmPassword
    };
    
    return this.http.post<ResetPasswordResponse>(`${this.apiUrl}/reset-password`, resetDto, {
      headers: new HttpHeaders({
        'Content-Type': 'application/json',
        'Accept': '*/*'
      })
    }).pipe(
      map((response: any) => {
        return {
          status: response.status || 'Success',
          message: response.message || 'Password reset successfully.'
        } as ResetPasswordResponse;
      }),
      catchError((error) => {
        console.error('Reset password error:', error);
        let errorMessage = 'Failed to reset password. Please try again.';
        
        if (error.error && error.error.message) {
          errorMessage = error.error.message;
        }
        
        throw new Error(errorMessage);
      })
    );
  }

  // Resend OTP for forgot password
  resendOtp(request: ResendOtpRequest): Observable<ResendOtpResponse> {
    const emailDto = { email: request.email };
    
    return this.http.post<ResendOtpResponse>(`${this.apiUrl}/resend-otp`, emailDto, {
      headers: new HttpHeaders({
        'Content-Type': 'application/json',
        'Accept': '*/*'
      })
    }).pipe(
      map((response: any) => {
        return {
          status: response.status || 'Success',
          message: response.message || 'OTP resent successfully.'
        } as ResendOtpResponse;
      }),
      catchError((error) => {
        console.error('Resend OTP error:', error);
        let errorMessage = 'Failed to resend OTP. Please try again.';
        
        if (error.error && error.error.message) {
          errorMessage = error.error.message;
        }
        
        throw new Error(errorMessage);
      })
    );
  }

  // Resend email confirmation OTP for signup verification
  resendEmailConfirmationOtp(request: ResendEmailConfirmationOtpRequest): Observable<ResendEmailConfirmationOtpResponse> {
    const emailDto = { email: request.email };
    
    return this.http.post<ResendEmailConfirmationOtpResponse>(`${this.apiUrl}/resend-email-confirmation-otp`, emailDto, {
      headers: new HttpHeaders({
        'Content-Type': 'application/json',
        'Accept': '*/*'
      })
    }).pipe(
      map((response: any) => {
        return {
          status: response.status || 'Success',
          message: response.message || 'Email confirmation OTP resent successfully.'
        } as ResendEmailConfirmationOtpResponse;
      }),
      catchError((error) => {
        console.error('Resend email confirmation OTP error:', error);
        let errorMessage = 'Failed to resend confirmation OTP. Please try again.';
        
        if (error.error && error.error.message) {
          errorMessage = error.error.message;
        }
        
        throw new Error(errorMessage);
      })
    );
  }

  // Change password method
  changePassword(request: ChangePasswordRequest): Observable<any> {
    const changePasswordDto = {
      oldPassword: request.oldPassword,
      newPassword: request.newPassword,
      confirmNewPassword: request.confirmNewPassword
    };
    
    return this.http.put(`${this.userApiUrl}/ChangePassword`, changePasswordDto, {
      headers: this.getAuthHeaders()
    }).pipe(
      catchError((error) => {
        console.error('Change password error:', error);
        let errorMessage = 'Failed to change password. Please try again.';
        
        if (error.error && error.error.message) {
          errorMessage = error.error.message;
        } else if (error.status === 400) {
          errorMessage = 'Current password is incorrect.';
        }
        
        throw new Error(errorMessage);
      })
    );
  }

  // Get user profile
  getUserProfile(): Observable<UserProfile> {
    return this.http.get<UserProfile>(`${this.userApiUrl}/GetUser`, {
      headers: this.getAuthHeaders()
    }).pipe(
      tap((profile) => {
        const userData = {
          userId: profile.userId,
          email: profile.email,
          firstName: profile.firstName,
          lastName: profile.lastName,
          phoneNumber: profile.phoneNumber,
          city: profile.city,
          imageUrl: profile.imageUrl
        };
        localStorage.setItem('userData', JSON.stringify(userData));
        this.currentUserSubject.next(userData);
      }),
      catchError((error) => {
        console.error('Get user profile error:', error);
        throw error;
      })
    );
  }

  // Update user profile
  updateUserProfile(formData: FormData): Observable<any> {
    return this.http.put(`${this.userApiUrl}/Update`, formData, {
      headers: new HttpHeaders({
        'Authorization': `Bearer ${this.getToken()}`
      })
    }).pipe(
      tap((response) => {
        this.getUserProfile().subscribe();
      }),
      catchError((error) => {
        console.error('Update user profile error:', error);
        throw error;
      })
    );
  }

  // Logout method
  logout(): void {
    this.cookieService.delete('token');
    this.cookieService.delete('userId');
    localStorage.removeItem('userData');
    this.currentUserSubject.next(null);
  }

  // Get current user
  getCurrentUser(): any {
    return this.currentUserSubject.value;
  }

  // Check if user is logged in
  isLoggedIn(): boolean {
    return !!this.cookieService.get('token');
  }

  // Get auth headers for authenticated requests
  getAuthHeaders(): HttpHeaders {
    const token = this.getToken();
    return new HttpHeaders({
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    });
  }

  // Get token
  private getToken(): string {
    return this.cookieService.get('token') || '';
  }

  // Load user data from storage
  private loadUserFromStorage(): void {
    const userDataString = localStorage.getItem('userData');
    if (userDataString) {
      try {
        const userData = JSON.parse(userDataString);
        this.currentUserSubject.next(userData);
      } catch (error) {
        console.error('Error parsing user data from localStorage:', error);
        localStorage.removeItem('userData');
        this.logout();
      }
    }
  }

  // Get user data from localStorage
  getUserData(): any {
    const userDataString = localStorage.getItem('userData');
    if (userDataString) {
      try {
        return JSON.parse(userDataString);
      } catch (error) {
        console.error('Error parsing user data:', error);
        return null;
      }
    }
    return null;
  }

  // Get user image URL
  getUserImageUrl(): string {
    const userData = this.getUserData();
    return userData?.imageUrl || 'assets/images/profile.jpeg';
  }

  // Get user full name
  getUserFullName(): string {
    const userData = this.getUserData();
    if (userData) {
      if (userData.displayName) {
        return userData.displayName;
      }
      return `${userData.firstName || ''} ${userData.lastName || ''}`.trim();
    }
    return 'Guest';
  }
}


================================================
File: app/services/payment.service.ts
================================================
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable } from 'rxjs';
import { catchError, tap } from 'rxjs/operators';
import { AuthService } from './auth.service';

export interface PaymentIntentRequest {
  currency: string;
  amount?: number; // بالـ cents (مثال: 100 = $1.00، 5000 = $50.00)
  // ⚠️ إزالة paymentIntentId لتجنب خطأ 400
}

export interface PaymentIntentResponse {
  clientSecret: string;
  paymentIntentId: string;
}

@Injectable({
  providedIn: 'root'
})
export class PaymentService {
  private apiUrl = 'http://digitalpropertyapi.runasp.net/api/Payment';

  constructor(
    private http: HttpClient,
    private authService: AuthService
  ) { }

  /**
   * إنشاء Payment Intent جديد
   * ✅ لا نمرر paymentIntentId أبداً لتجنب Error 400
   */
  createPaymentIntent(request: PaymentIntentRequest): Observable<PaymentIntentResponse> {
    console.log('🔄 Creating NEW payment intent...', request);
    
    // تحضير البيانات - بدون paymentIntentId نهائياً
    const payload: any = {
      currency: request.currency || 'USD'
    };

    // إضافة المبلغ إذا كان موجود
    if (request.amount && request.amount > 0) {
      payload.amount = request.amount;
    }

    console.log('📤 Payment request payload (NEW):', payload);

    return this.http.post<PaymentIntentResponse>(
      `${this.apiUrl}/create-or-update-payment-intent`,
      payload,
      {
        headers: this.authService.getAuthHeaders()
      }
    ).pipe(
      tap((response) => {
        console.log('✅ NEW payment intent created successfully:', response);
      }),
      catchError((error) => {
        console.error('❌ Payment intent creation failed:', error);
        console.log('📊 Full error details:', {
          status: error.status,
          statusText: error.statusText,
          error: error.error
        });
        
        // معالجة أخطاء Stripe المختلفة
        if (error.status === 400 && error.error?.error) {
          const stripeError = error.error.error;
          console.error('🔴 Stripe Error:', stripeError);
          
          // حلول للأخطاء الشائعة
          if (stripeError.includes('amount could not be updated')) {
            throw new Error('Payment session expired. Please try again with a new payment.');
          } else if (stripeError.includes('requires_payment_method')) {
            throw new Error('Payment method required. Please check your card details.');
          } else if (stripeError.includes('insufficient_funds')) {
            throw new Error('Insufficient funds. Please use a different payment method.');
          } else if (stripeError.includes('card_declined')) {
            throw new Error('Card declined. Please use a different payment method.');
          } else {
            throw new Error(stripeError);
          }
        }
        
        // أخطاء API أخرى
        let errorMessage = 'Payment initialization failed. Please try again.';
        
        if (error.status === 401) {
          errorMessage = 'Authentication failed. Please login again.';
        } else if (error.status === 403) {
          errorMessage = 'Access denied. Please check your permissions.';
        } else if (error.status === 500) {
          errorMessage = 'Server error. Please try again later.';
        } else if (error.status === 0) {
          errorMessage = 'Network error. Please check your internet connection.';
        } else if (error.error && error.error.message) {
          errorMessage = error.error.message;
        }
        
        throw new Error(errorMessage);
      })
    );
  }

  /**
   * إنشاء payment intent للاختبار بمبلغ تجريبي ($1)
   */
  createTestPaymentIntent(): Observable<PaymentIntentResponse> {
    return this.createPaymentIntent({
      currency: 'USD',
      amount: 100 // $1.00 للاختبار
    });
  }

  /**
   * إنشاء payment intent بدون تحديد مبلغ (البكاند يحدد)
   */
  createDefaultPaymentIntent(): Observable<PaymentIntentResponse> {
    return this.createPaymentIntent({
      currency: 'USD'
      // لا نحدد amount - البكاند يحدده
    });
  }

  /**
   * إنشاء payment intent لرسوم العقارات
   */
  createPropertyListingPayment(amount: number = 5000): Observable<PaymentIntentResponse> {
    return this.createPaymentIntent({
      currency: 'USD',
      amount: amount // مبلغ بالـ cents (5000 = $50.00)
    });
  }
}


================================================
File: app/services/property.service.ts
================================================
import { Injectable } from '@angular/core';
import { HttpClient, HttpHeaders, HttpParams } from '@angular/common/http';
import { Observable, of, throwError } from 'rxjs';
import { delay, tap, map, catchError } from 'rxjs/operators';
import { AuthService } from './auth.service';

export interface PropertyResponse {
  $id?: string;
  pageIndex: number;
  pageSize: number;
  totalCount: number;
  data: {
    $id?: string;
    $values: Property[];
  };
}

export interface Property {
  propertyId: number;
  title: string;
  description: string;
  price: number;
  propertyType: string;
  size: number;
  bedrooms: number;
  bathrooms: number;
  street: string;
  city: string;
  governate: string;
  listedAt: string;
  propertyImages: string[];
  ownerInfo: OwnerInfo;
  internalAmenities: string[];
  externalAmenities: string[];
  accessibilityAmenities: string[];
  isFavorite?: boolean;
}

export interface OwnerInfo {
  $id?: string;
  firstName: string;
  lastName: string;
  email: string;
  phoneNumber: string;
}

export interface PropertyFilters {
  pageIndex?: number;
  pageSize?: number;
  propertyType?: string;
  city?: string;
  governate?: string;
  minPrice?: number;
  maxPrice?: number;
  minBedrooms?: number;
  maxBedrooms?: number;
  bedrooms?: number;
  bathrooms?: number;
  size?: number;
  sortBy?: string;
  searchTerm?: string;
  internalAmenityIds?: number[];
  externalAmenityIds?: number[];
  accessibilityAmenityIds?: number[];
  userId?: number;
}

export interface Review {
  reviewId?: number;
  propertyId: number;
  userId?: string;
  userName?: string;
  rating: number;
  comment: string;
  reviewDate?: string;
}

export interface FavoriteProperty {
  $id?: string;
  propertyId: number;
  title: string;
  mainImageUrl: string;
  city: string;
  governate: string;
  price: number;
  listingType: string;
  addedToFavoritesAt: string;
}

export interface FavoritesResponse {
  $id?: string;
  $values: FavoriteProperty[];
}

@Injectable({
  providedIn: 'root'
})
export class PropertyService {
  private apiUrl = 'http://digitalpropertyapi.runasp.net/api';

  constructor(
    private http: HttpClient,
    private authService: AuthService
  ) { }

  // Get all properties with pagination and filters
  getProperties(filters?: PropertyFilters): Observable<{ pageIndex: number; pageSize: number; totalCount: number; data: Property[] }> {
    let params = new HttpParams();
    
    // Set default pagination if not provided
    const pageSize = filters?.pageSize || 12;
    const pageIndex = filters?.pageIndex || 1;
    
    params = params.set('PageSize', pageSize.toString());
    params = params.set('PageIndex', pageIndex.toString());
    
    if (filters) {
      if (filters.propertyType) params = params.set('PropertyType', filters.propertyType);
      if (filters.city) params = params.set('City', filters.city);
      if (filters.governate) params = params.set('Governate', filters.governate);
      if (filters.bedrooms) params = params.set('Bedrooms', filters.bedrooms.toString());
      if (filters.bathrooms) params = params.set('Bathrooms', filters.bathrooms.toString());
      if (filters.size) params = params.set('Size', filters.size.toString());
      if (filters.minPrice) params = params.set('MinPrice', filters.minPrice.toString());
      if (filters.maxPrice) params = params.set('MaxPrice', filters.maxPrice.toString());
      if (filters.sortBy) params = params.set('SortBy', filters.sortBy);
      if (filters.userId) params = params.set('UserId', filters.userId.toString());
      
      if (filters.internalAmenityIds) {
        filters.internalAmenityIds.forEach(id => {
          params = params.append('InternalAmenityIds', id.toString());
        });
      }
      if (filters.externalAmenityIds) {
        filters.externalAmenityIds.forEach(id => {
          params = params.append('ExternalAmenityIds', id.toString());
        });
      }
      if (filters.accessibilityAmenityIds) {
        filters.accessibilityAmenityIds.forEach(id => {
          params = params.append('AccessibilityAmenityIds', id.toString());
        });
      }
    }

    console.log('🔍 Fetching properties with params:', params.toString());

    return this.http.get<PropertyResponse>(`${this.apiUrl}/Properties/GetAll`, { 
      params,
      headers: new HttpHeaders({
        'Accept': '*/*'
      })
    }).pipe(
      tap((response) => {
        console.log('✅ Properties API raw response:', response);
      }),
      map((response: PropertyResponse) => {
        // Handle the response structure with $id and $values
        const properties = response.data?.$values || [];
        const formattedProperties = properties.map(property => this.formatProperty(property));
        
        console.log('✅ Formatted properties:', formattedProperties);
        
        return {
          pageIndex: response.pageIndex,
          pageSize: response.pageSize,
          totalCount: response.totalCount,
          data: formattedProperties
        };
      }),
      catchError((error) => {
        console.error('❌ Error loading properties:', error);
        // Return empty result instead of mock data
        return of({
          pageIndex: 1,
          pageSize: 12,
          totalCount: 0,
          data: []
        });
      })
    );
  }

  // Get property by ID - using GetAll with filter
  getPropertyById(id: number): Observable<Property> {
    console.log('🔍 Getting property by ID:', id);
    
    return this.getProperties({ pageSize: 1000 }).pipe(
      map((response) => {
        const property = response.data.find(p => p.propertyId === id);
        if (!property) {
          throw new Error(`Property with ID ${id} not found`);
        }
        return property;
      }),
      catchError((error) => {
        console.error('❌ Error loading property by ID:', error);
        throw error;
      })
    );
  }

  // Add property method
  addProperty(propertyData: FormData): Observable<any> {
    console.log('🚀 Creating property with real API...');
    
    // عرض محتويات FormData للتشخيص
    console.log('📦 FormData contents:');
    for (let pair of (propertyData as any).entries()) {
      console.log(`  ${pair[0]}:`, pair[1]);
    }
    
    return this.http.post(`${this.apiUrl}/Properties/Create`, propertyData, {
      headers: new HttpHeaders({
        'Authorization': `Bearer ${this.getToken()}`
      })
    }).pipe(
      tap((response) => {
        console.log('✅ Property created successfully:', response);
      }),
      catchError((error) => {
        console.error('❌ Error adding property:', error);
        console.log('📊 Full error details:', {
          status: error.status,
          statusText: error.statusText,
          message: error.message,
          url: error.url,
          error: error.error
        });
        
        let errorMessage = 'Failed to add property. Please try again.';
        
        if (error.status === 400) {
          console.log('🔍 Bad Request (400) - Validation or data issue');
          
          if (error.error && typeof error.error === 'object') {
            if (error.error.message) {
              errorMessage = error.error.message;
            } else if (error.error.errors) {
              const validationErrors = [];
              for (const field in error.error.errors) {
                if (error.error.errors[field] && Array.isArray(error.error.errors[field])) {
                  validationErrors.push(`${field}: ${error.error.errors[field].join(', ')}`);
                }
              }
              if (validationErrors.length > 0) {
                errorMessage = `Validation errors: ${validationErrors.join('; ')}`;
              }
            } else if (error.error.title) {
              errorMessage = error.error.title;
            }
          } else if (error.error && typeof error.error === 'string') {
            errorMessage = error.error;
          } else {
            errorMessage = 'Invalid data format. Please check all required fields and try again.';
          }
        } else if (error.status === 401) {
          errorMessage = 'Authentication failed. Please login again.';
        } else if (error.status === 403) {
          errorMessage = 'You do not have permission to add properties.';
        } else if (error.status === 413) {
          errorMessage = 'File size too large. Please use smaller images (max 5MB each).';
        } else if (error.status === 415) {
          errorMessage = 'Unsupported file format. Please use JPG, PNG, or WebP images.';
        } else if (error.status === 422) {
          errorMessage = 'Invalid data format. Please check your form data.';
        } else if (error.status === 500) {
          errorMessage = 'Server error. Please try again later or contact support.';
        } else if (error.status === 502) {
          errorMessage = 'Server temporarily unavailable. Please try again in a few minutes.';
        } else if (error.status === 0) {
          errorMessage = 'Network error. Please check your internet connection and try again.';
        }
        
        return throwError(() => ({
          status: error.status,
          error: { 
            message: errorMessage,
            originalError: error.error 
          },
          timestamp: new Date().toISOString()
        }));
      })
    );
  }

  // Update property
  updateProperty(id: number, propertyData: any): Observable<any> {
    return this.http.put(`${this.apiUrl}/Properties/Update/${id}`, propertyData, {
      headers: this.getAuthHeaders()
    }).pipe(
      catchError((error) => {
        console.error('Error updating property:', error);
        throw error;
      })
    );
  }

  // Delete property
  deleteProperty(id: number): Observable<any> {
    return this.http.delete(`${this.apiUrl}/Properties/Delete/${id}`, {
      headers: this.getAuthHeaders()
    }).pipe(
      catchError((error) => {
        console.error('Error deleting property:', error);
        throw error;
      })
    );
  }

  // Add to favorites
  addToFavorites(propertyId: number): Observable<any> {
    console.log('Adding property to favorites:', propertyId);
    
    return this.http.post(`${this.apiUrl}/Favorites/${propertyId}`, {}, {
      headers: this.getAuthHeaders(),
      responseType: 'text'
    }).pipe(
      tap((response) => {
        console.log('Add to favorites response:', response);
      }),
      catchError((error) => {
        console.error('Error adding to favorites:', error);
        
        if (error.status === 200 || (error.error && typeof error.error === 'string' && error.error.includes('added'))) {
          console.log('Actually successful - treating as success');
          return of('Property added to favorites.');
        }
        
        throw error;
      })
    );
  }

  // Remove from favorites
  removeFromFavorites(propertyId: number): Observable<any> {
    console.log('Removing property from favorites:', propertyId);
    
    return this.http.delete(`${this.apiUrl}/Favorites/remove/${propertyId}`, {
      headers: this.getAuthHeaders(),
      responseType: 'text'
    }).pipe(
      tap((response) => {
        console.log('Remove from favorites response:', response);
      }),
      catchError((error) => {
        console.error('Error removing from favorites:', error);
        
        if (error.status === 200 || (error.error && typeof error.error === 'string' && error.error.includes('removed'))) {
          console.log('Actually successful - treating as success');
          return of('Property removed from favorites.');
        }
        
        throw error;
      })
    );
  }

  // Check if property is in favorites
  isPropertyInFavorites(propertyId: number): Observable<boolean> {
    return this.http.get<boolean>(`${this.apiUrl}/Favorites/added/${propertyId}`, {
      headers: this.getAuthHeaders()
    }).pipe(
      tap((response) => {
        console.log(`✅ Property ${propertyId} is in favorites:`, response);
      }),
      catchError((error) => {
        console.error('❌ Error checking favorites:', error);
        return of(false);
      })
    );
  }

  // Get user favorites
  getFavorites(): Observable<Property[]> {
    return this.http.get<FavoritesResponse>(`${this.apiUrl}/Favorites`, {
      headers: this.getAuthHeaders()
    }).pipe(
      tap((response) => {
        console.log('✅ Favorites API raw response:', response);
      }),
      map((response: FavoritesResponse) => {
        const favorites = response.$values || [];
        return favorites.map(fav => this.formatFavoriteToProperty(fav));
      }),
      catchError((error) => {
        console.error('❌ Error loading favorites:', error);
        return of([]);
      })
    );
  }

  // Get property reviews - Enhanced with mock data for development
  getPropertyReviews(propertyId: number): Observable<Review[]> {
    console.log('🔍 Getting reviews for property:', propertyId);
    
    // Mock reviews for development
    const mockReviews: Review[] = [
     
      
      
    ];
    
    console.log('📝 Returning mock reviews:', mockReviews);
    return of(mockReviews).pipe(delay(500));
  }

  // Add review - Enhanced with better error handling
  addReview(propertyId: number, review: { rating: number; comment: string }): Observable<any> {
    console.log('📝 Adding review for property:', propertyId, 'Review data:', review);
    
    // Get user data and extract proper userId
    const userData = this.authService.getUserData();
    console.log('👤 Current user data:', userData);
    
    // Try to get userId from different possible fields
    const userId = this.extractUserId(userData);
    console.log('🆔 Using userId:', userId);
    
    const reviewDto = {
      rating: review.rating,
      comment: review.comment
    };
    
    console.log('📤 Sending review request to:', `${this.apiUrl}/Reviews/${userId}/${propertyId}`);
    console.log('📦 Review payload:', reviewDto);
    
    return this.http.post(`${this.apiUrl}/Reviews/${userId}/${propertyId}`, reviewDto, {
      headers: this.getAuthHeaders()
    }).pipe(
      tap((response) => {
        console.log('✅ Review added successfully:', response);
      }),
      catchError((error) => {
        console.error('❌ Error adding review:', error);
        console.log('📊 Error details:', {
          status: error.status,
          statusText: error.statusText,
          message: error.message,
          url: error.url,
          error: error.error
        });
        
        let errorMessage = 'Failed to add review. Please try again.';
        
        if (error.status === 0) {
          errorMessage = 'Connection error. Please check your network and try again.';
          console.log('🌐 CORS or network error detected');
        } else if (error.status === 400) {
          errorMessage = 'Invalid review data. Please check your rating and comment.';
        } else if (error.status === 401) {
          errorMessage = 'Please log in again to submit a review.';
        } else if (error.status === 404) {
          errorMessage = 'Property not found or review endpoint unavailable.';
        } else if (error.status === 500) {
          errorMessage = 'Server error. The review feature may be temporarily unavailable.';
          
          // For development: return a mock success response
          console.log('🔄 Server error - returning mock success for development');
          return of({
            success: true,
            message: 'Review submitted (mock response due to server error)',
            reviewId: Math.floor(Math.random() * 1000),
            isTemporary: true
          });
        }
        
        return throwError(() => ({
          status: error.status,
          error: { message: errorMessage }
        }));
      })
    );
  }

  // Helper method to extract user ID from various possible fields
  private extractUserId(userData: any): string {
    if (!userData) {
      console.log('⚠️ No user data available');
      return '1';
    }
    
    const possibleIds = [
      userData.userId,
      userData.id, 
      userData.user_id,
      userData.sub, // JWT standard claim
      userData.nameid, // .NET Identity claim
      userData['http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier'] // Full .NET claim
    ];
    
    for (const id of possibleIds) {
      if (id) {
        console.log('✅ Found user ID:', id);
        return String(id);
      }
    }
    
    console.log('⚠️ No user ID found in any field, using fallback');
    return '1';
  }

  updateReview(propertyId: number, reviewId: number, review: { rating: number; comment: string }): Observable<any> {
    const userData = this.authService.getUserData();
    const userId = this.extractUserId(userData);
    
    const reviewDto = {
      rating: review.rating,
      comment: review.comment
    };
    
    return this.http.put(`${this.apiUrl}/Reviews/${userId}/${reviewId}`, reviewDto, {
      headers: this.getAuthHeaders()
    }).pipe(
      catchError((error) => {
        console.error('Error updating review:', error);
        throw error;
      })
    );
  }

  deleteReview(propertyId: number, reviewId: number): Observable<any> {
    const userData = this.authService.getUserData();
    const userId = this.extractUserId(userData);
    
    return this.http.delete(`${this.apiUrl}/Reviews/${userId}/${reviewId}`, {
      headers: this.getAuthHeaders()
    }).pipe(
      catchError((error) => {
        console.error('Error deleting review:', error);
        throw error;
      })
    );
  }

  // Helper methods
  private getAuthHeaders(): HttpHeaders {
    const token = this.getToken();
    return new HttpHeaders({
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json',
      'Accept': '*/*'
    });
  }

  private getToken(): string {
    return this.authService.getAuthHeaders().get('Authorization')?.replace('Bearer ', '') || '';
  }

  // Format property data for display
  formatProperty(property: any): Property {
    return {
      propertyId: property.propertyId || property.id,
      title: property.title || 'Property Title',
      description: property.description || 'No description available',
      price: property.price || 0,
      propertyType: property.propertyType || 'Unknown',
      size: property.size || 0,
      bedrooms: property.bedrooms || 0,
      bathrooms: property.bathrooms || 0,
      street: property.street || '',
      city: property.city || '',
      governate: property.governate || '',
      listedAt: property.listedAt || property.createdAt || new Date().toISOString(),
      propertyImages: property.propertyImages?.$values || property.propertyImages || [],
      ownerInfo: property.ownerInfo || {
        firstName: 'Owner',
        lastName: 'Name',
        email: 'owner@email.com',
        phoneNumber: '+201234567890'
      },
      internalAmenities: property.internalAmenities?.$values || property.internalAmenities || [],
      externalAmenities: property.externalAmenities?.$values || property.externalAmenities || [],
      accessibilityAmenities: property.accessibilityAmenities?.$values || property.accessibilityAmenities || [],
      isFavorite: false
    };
  }

  // Convert favorite response to property format
  private formatFavoriteToProperty(favorite: FavoriteProperty): Property {
    return {
      propertyId: favorite.propertyId,
      title: favorite.title,
      description: 'Favorite property',
      price: favorite.price,
      propertyType: favorite.listingType || 'Property',
      size: 0,
      bedrooms: 0,
      bathrooms: 0,
      street: '',
      city: favorite.city,
      governate: favorite.governate,
      listedAt: favorite.addedToFavoritesAt,
      propertyImages: [favorite.mainImageUrl],
      ownerInfo: {
        firstName: 'Owner',
        lastName: 'Name',
        email: 'owner@email.com',
        phoneNumber: '+201234567890'
      },
      internalAmenities: [],
      externalAmenities: [],
      accessibilityAmenities: [],
      isFavorite: true
    };
  }

  // Search properties
  searchProperties(searchTerm: string, filters?: PropertyFilters): Observable<{ pageIndex: number; pageSize: number; totalCount: number; data: Property[] }> {
    const searchFilters = {
      ...filters,
      searchTerm: searchTerm,
      pageIndex: 1,
      pageSize: 20
    };
    return this.getProperties(searchFilters);
  }
  // إضافة هذا الـ method في PropertyService

// Get user's own properties
getUserProperties(): Observable<Property[]> {
  console.log('🔍 Fetching user properties...');
  
  return this.http.get<any>(`${this.apiUrl}/Properties/get-user-properties`, {
    headers: this.getAuthHeaders()
  }).pipe(
    tap((response) => {
      console.log('✅ User properties API raw response:', response);
    }),
    map((response: any) => {
      // Handle different possible response structures
      let properties: any[] = [];
      
      if (response) {
        if (response.$values) {
          // Response has $values wrapper
          properties = response.$values;
        } else if (response.data && response.data.$values) {
          // Response has data.$values wrapper
          properties = response.data.$values;
        } else if (Array.isArray(response)) {
          // Response is direct array
          properties = response;
        } else if (response.data && Array.isArray(response.data)) {
          // Response has data array
          properties = response.data;
        } else {
          console.log('⚠️ Unexpected response structure:', response);
          properties = [];
        }
      }
      
      const formattedProperties = properties.map(property => this.formatProperty(property));
      console.log('✅ Formatted user properties:', formattedProperties);
      
      return formattedProperties;
    }),
    catchError((error) => {
      console.error('❌ Error loading user properties:', error);
      
      if (error.status === 404) {
        console.log('📝 No properties found for user (404)');
        return of([]); // Return empty array if no properties found
      } else if (error.status === 401) {
        console.error('🔐 Authentication error - user needs to login');
        throw new Error('Please login again to view your properties.');
      } else if (error.status === 500) {
        console.error('🔥 Server error');
        throw new Error('Server error. Please try again later.');
      }
      
      throw new Error('Failed to load your properties. Please try again.');
    })
  );
}
}



================================================
File: app/sign-up/sign-up.component.css
================================================
/* General styles for the signup page */
.container {
    display: flex;
    height: 100vh;
    width: 100%;
    font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);

}

/* Left side - Form inputs */
.form-side {
    width: 50%;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding: 40px;
  overflow-y: auto;
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
}

.form-container {
    width: 100%;
    max-width: 480px;
}

.title {
    font-size: 2.5rem;
  color: #0c2b7a;
  margin-bottom: 10px;
  font-weight: 700;
  text-align: center;
}

/* Form row for split inputs */
.form-row {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
}

.form-group {
    margin-bottom: 20px;
}

.half {
    width: 50%;
}

label {
     display: block;
  font-size: 0.95rem;
  color: #0c2b7a;
  margin-bottom: 8px;
  font-weight: 600;
}

.form-control {
   
  width: 100%;
  padding: 15px 20px;
  border: 2px solid #e0e0e0;
  border-radius: 12px;
  font-size: 16px;
  outline: none;
  transition: all 0.3s ease;
  background-color: #fafbfc;
  font-family: inherit;
}

.form-control:focus {
    border-color: #0c2b7a;
  background-color: white;
  box-shadow: 0 0 0 3px rgba(12, 43, 122, 0.1);
  transform: translateY(-1px);
}

.form-control.invalid {
    border-color: #ff3860;
}

.error-message {
    color: #ff3860;
    font-size: 14px;
    margin-top: 5px;
}

/* Phone input with country code */
.phone-input {
   display: flex;
  gap: 10px;
}

.country-code {
    width: 100px;
}

.code-select {
    width: 100%;
  padding: 15px 10px;
  border: 2px solid #e0e0e0;
  border-radius: 12px;
  font-size: 16px;
  outline: none;
  background-color: #fafbfc;
  transition: all 0.3s ease;
  cursor: pointer;
}
.code-select:focus {
  border-color: #0c2b7a;
  background-color: white;
  box-shadow: 0 0 0 3px rgba(12, 43, 122, 0.1);
}

.phone {
    flex: 1;
}

/* Dropdown styles */
.dropdown {
    position: relative;
}

.dropdown-icon {
  position: absolute;
  right: 15px;
  top: 50%;
  transform: translateY(-50%);
  color: #6c757d;
  pointer-events: none;
  transition: transform 0.3s ease;
}

.dropdown select:focus + .dropdown-icon {
  transform: translateY(-50%) rotate(180deg);
}

/* Date input styles */
.date-input {
    position: relative;
}

.calendar-icon {
    position: absolute;
  top: 50%;
  right: 15px;
  transform: translateY(-50%);
  color: #6c757d;
  pointer-events: none;
  font-size: 1.1rem;
}

/* Password input styles */
.password-input {
    position: relative;
}

.toggle-password {
    position: absolute;
  top: 50%;
  right: 15px;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: #6c757d;
  cursor: pointer;
  padding: 5px;
  border-radius: 4px;
  transition: all 0.3s ease;
}
.toggle-password:hover {
  color: #0c2b7a;
  background-color: rgba(12, 43, 122, 0.1);
}

.toggle-password:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}


/* Terms checkbox styles */
.terms-group {
    margin-bottom: 30px;
}

.checkbox-container {
    display: flex;
  align-items: flex-start;
  gap: 12px;
}

.checkbox {
     width: 20px;
  height: 20px;
  accent-color: #0c2b7a;
  cursor: pointer;
  margin-top: 2px;
  flex-shrink: 0;
}

.terms-label {
   font-size: 0.95rem;
  color: #333;
  line-height: 1.5;
  cursor: pointer;
}

.terms-link {
    color: #0c2b7a;
  text-decoration: none;
  font-weight: 600;
  transition: color 0.3s ease;
}
.terms-link:hover {
  color: #061a5f;
  text-decoration: underline;
}
/* Signup button */
.signup-btn {
    width: 100%;
  padding: 16px 24px;
  background: linear-gradient(135deg, #0c2b7a, #1e3c72);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  margin-bottom: 25px;
  position: relative;
  overflow: hidden;
}

.signup-btn:hover {
    background-color: #091e55;
}
signup-btn:not(:disabled):hover {
  background: linear-gradient(135deg, #1e3c72, #0c2b7a);
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(12, 43, 122, 0.3);
}

.signup-btn:disabled {
  opacity: 0.7;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

.signup-btn.loading {
  pointer-events: none;
}

/* Google signup */
.google-signup {
    margin-bottom: 20px;
}
.btn-content {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}
.google-btn {
    width: 100%;
    padding: 15px;
    background-color: white;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    transition: background-color 0.3s;
}

.google-btn:hover {
    background-color: #f5f5f5;
}

.google-btn img {
    width: 20px;
    height: 20px;
}

/* Login link */
.login-link {
    text-align: center;
    font-size: 16px;
}

.login-link span {
    color: #666;
}

.login-link a {
    color: #0c2b7a;
    font-weight: bold;
    text-decoration: none;
    margin-left: 5px;
}

/* Right side - Blue background with image */
.image-side {
    width: 50%;
    background-color: #0c2b7a; /* Deep blue color from the design */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
}

.close-button {
    position: absolute;
    top: 20px;
    right: 20px;
}

.close-btn {
    background: transparent;
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
}

.image-container {
    width: 70%;
    max-width: 400px;
    display: flex;
    justify-content: center;
}

.image-container img {
    max-width: 100%;
    height: auto;
}

/* Loading states */
.animate-spin {
    animation: spin 1s linear infinite;
}
.spinner {
  width: 20px;
  height: 20px;
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-top: 2px solid white;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

@keyframes spin {
    from {
        transform: rotate(0deg);
    }
    to {
        transform: rotate(360deg);
    }
}
@keyframes slideInLeft {
  from {
    opacity: 0;
    transform: translateX(-30px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}
.signup-btn:disabled,
.google-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

.form-control:disabled,
.code-select:disabled,
.checkbox:disabled {
    background-color: #f5f5f5;
    opacity: 0.6;
}

/* Responsive design */
@media (max-width: 768px) {
    .container {
        flex-direction: column-reverse;
    }
    
    .image-side {
        width: 100%;
        height: 30vh;
    }
    
    .form-side {
        width: 100%;
        height: 70vh;
        padding: 20px;
    }
    
    .form-row {
        flex-direction: column;
        gap: 0;
    }
    
    .half {
        width: 100%;
    }
}


================================================
File: app/sign-up/sign-up.component.html
================================================
<!-- Signup Component HTML - Fixed disabled attributes -->
<div class="container">
    <!-- Left side (Form inputs) -->
    <div class="form-side">
      <div class="form-container">
        <h1 class="title">Sign Up</h1>
  
        <form (ngSubmit)="onSubmit()" [formGroup]="signupForm">
          <!-- Name inputs in a row -->
          <div class="form-row">
            <div class="form-group half">
              <label for="firstName">First Name</label>
              <input 
                type="text" 
                id="firstName"
                formControlName="firstName" 
                placeholder="ex: Ahmed"
                class="form-control"
                [ngClass]="{'invalid': submitted && f['firstName'].errors}"
              >
              <div *ngIf="submitted && f['firstName'].errors" class="error-message">
                <div *ngIf="f['firstName'].errors['required']">First name is required</div>
                <div *ngIf="f['firstName'].errors['minlength']">First name must be at least 2 characters</div>
              </div>
            </div>
  
            <div class="form-group half">
              <label for="lastName">Last Name</label>
              <input 
                type="text" 
                id="lastName"
                formControlName="lastName" 
                placeholder="ex: Wagdy"
                class="form-control"
                [ngClass]="{'invalid': submitted && f['lastName'].errors}"
              >
              <div *ngIf="submitted && f['lastName'].errors" class="error-message">
                <div *ngIf="f['lastName'].errors['required']">Last name is required</div>
                <div *ngIf="f['lastName'].errors['minlength']">Last name must be at least 2 characters</div>
              </div>
            </div>
          </div>
  
          <!-- Email input -->
          <div class="form-group">
            <label for="email">Email</label>
            <input 
              type="email" 
              id="email"
              formControlName="email" 
              placeholder="ex: ahmedwagdy@email.com"
              class="form-control"
              [ngClass]="{'invalid': submitted && f['email'].errors}"
            >
            <div *ngIf="submitted && f['email'].errors" class="error-message">
              <div *ngIf="f['email'].errors['required']">Email is required</div>
              <div *ngIf="f['email'].errors['email']">Enter a valid email</div>
            </div>
          </div>
  
          <!-- Phone number with country code -->
          <div class="form-group">
            <label for="phone">Phone Number</label>
            <div class="phone-input">
              <div class="country-code">
                <select formControlName="countryCode" class="code-select">
                  <option value="+20">+20</option>
                  <option value="+1">+1</option>
                  <option value="+44">+44</option>
                  <option value="+33">+33</option>
                  <option value="+49">+49</option>
                </select>
              </div>
              <input 
                type="tel" 
                id="phone"
                formControlName="phone" 
                placeholder="ex: 1007559638"
                class="form-control phone"
                [ngClass]="{'invalid': submitted && f['phone'].errors}"
              >
            </div>
            <div *ngIf="submitted && f['phone'].errors" class="error-message">
              <div *ngIf="f['phone'].errors['required']">Phone number is required</div>
              <div *ngIf="f['phone'].errors['pattern']">Enter a valid phone number (10-11 digits)</div>
            </div>
          </div>
  
          <!-- City dropdown -->
          <div class="form-group">
            <label for="city">City</label>
            <div class="dropdown">
              <select formControlName="city" id="city" class="form-control">
                <option value="" disabled selected>ex: Cairo</option>
                <option value="Cairo">Cairo</option>
                <option value="Alexandria">Alexandria</option>
                <option value="Giza">Giza</option>
                <option value="Luxor">Luxor</option>
                <option value="Aswan">Aswan</option>
                <option value="Mansoura">Mansoura</option>
                <option value="Hurghada">Hurghada</option>
              </select>
            </div>
            <div *ngIf="submitted && f['city'].errors" class="error-message">
              <div *ngIf="f['city'].errors['required']">City is required</div>
            </div>
          </div>
  
          <!-- Date of birth -->
          <div class="form-group">
            <label for="dob">Birth of date</label>
            <div class="date-input">
              <input 
                type="date" 
                id="dob"
                formControlName="dob" 
                class="form-control"
                [ngClass]="{'invalid': submitted && f['dob'].errors}"
              >
              <div class="calendar-icon">
                <i class="bi bi-calendar"></i>
              </div>
            </div>
            <div *ngIf="submitted && f['dob'].errors" class="error-message">
              <div *ngIf="f['dob'].errors['required']">Date of birth is required</div>
            </div>
          </div>
  
          <!-- Password input -->
          <div class="form-group">
            <label for="password">Password</label>
            <div class="password-input">
              <input 
                [type]="showPassword ? 'text' : 'password'" 
                id="password"
                formControlName="password" 
                placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                class="form-control"
                [ngClass]="{'invalid': submitted && f['password'].errors}"
              >
              <div class="toggle-password" (click)="togglePasswordVisibility()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path *ngIf="!showPassword" d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <path *ngIf="showPassword" d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                  <circle *ngIf="!showPassword" cx="12" cy="12" r="3"></circle>
                  <line *ngIf="showPassword" x1="1" y1="1" x2="23" y2="23"></line>
                </svg>
              </div>
            </div>
            <div *ngIf="submitted && f['password'].errors" class="error-message">
              <div *ngIf="f['password'].errors['required']">Password is required</div>
              <div *ngIf="f['password'].errors['minlength']">Password must be at least 6 characters</div>
            </div>
          </div>
  
          <!-- Confirm password input -->
          <div class="form-group">
            <label for="confirmPassword">Confirm password</label>
            <div class="password-input">
              <input 
                [type]="showConfirmPassword ? 'text' : 'password'" 
                id="confirmPassword"
                formControlName="confirmPassword" 
                placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                class="form-control"
                [ngClass]="{'invalid': submitted && f['confirmPassword'].errors}"
              >
              <div class="toggle-password" (click)="toggleConfirmPasswordVisibility()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path *ngIf="!showConfirmPassword" d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <path *ngIf="showConfirmPassword" d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                  <circle *ngIf="!showConfirmPassword" cx="12" cy="12" r="3"></circle>
                  <line *ngIf="showConfirmPassword" x1="1" y1="1" x2="23" y2="23"></line>
                </svg>
              </div>
            </div>
            <div *ngIf="submitted && f['confirmPassword'].errors" class="error-message">
              <div *ngIf="f['confirmPassword'].errors['required']">Confirm password is required</div>
              <div *ngIf="f['confirmPassword'].errors['matching']">Passwords must match</div>
            </div>
          </div>
  
          <!-- Terms checkbox -->
          <div class="form-group terms-group">
            <div class="checkbox-container">
              <input 
                type="checkbox" 
                id="terms"
                formControlName="terms" 
                class="checkbox"
              >
              <label for="terms" class="terms-label">I understood the <span class="terms-link">terms & policy</span>.</label>
            </div>
            <div *ngIf="submitted && f['terms'].errors" class="error-message">
              <div *ngIf="f['terms'].errors['required']">You must accept the terms and policy</div>
            </div>
          </div>
          
          <!-- Sign up button -->
          <button type="submit" class="signup-btn" [disabled]="isLoading">
            <span *ngIf="!isLoading">Sign up</span>
            <span *ngIf="isLoading">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="animate-spin">
                <line x1="12" y1="2" x2="12" y2="6"></line>
                <line x1="12" y1="18" x2="12" y2="22"></line>
                <line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line>
                <line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line>
                <line x1="2" y1="12" x2="6" y2="12"></line>
                <line x1="18" y1="12" x2="22" y2="12"></line>
                <line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line>
                <line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line>
              </svg>
              Creating account...
            </span>
          </button>
        </form>
  
        <!-- Google sign up -->
        <div class="google-signup">
          <button class="google-btn" (click)="signupWithGoogle()" [disabled]="isLoading">
            <img src="../../assets/images/google.png" alt="Google">
            Sign up with Google
          </button>
        </div>
  
        <!-- Login link -->
        <div class="login-link">
          <span>Do you have an account?</span>
          <a [routerLink]="['/log-in']">Login</a>
        </div>
      </div>
    </div>
  
    <!-- Right side (Blue background with image) -->
    <div class="image-side">
      <div class="close-button">
        <button class="close-btn" (click)="goToHome()">âœ•</button>
      </div>
      <div class="image-container">
        <img src="../../assets/images/signup.png" alt="Sign up illustration">
      </div>
    </div>
  </div>
  
  <!-- Add CSS for loading animation -->
  <style>
    .animate-spin {
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      from {
        transform: rotate(0deg);
      }
      to {
        transform: rotate(360deg);
      }
    }
    
    .signup-btn:disabled,
    .google-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
  </style>


================================================
File: app/sign-up/sign-up.component.spec.ts
================================================
import { ComponentFixture, TestBed } from '@angular/core/testing';

import { SignUpComponent } from './sign-up.component';

describe('SignUpComponent', () => {
  let component: SignUpComponent;
  let fixture: ComponentFixture<SignUpComponent>;

  beforeEach(async () => {
    await TestBed.configureTestingModule({
      imports: [SignUpComponent]
    })
    .compileComponents();
    
    fixture = TestBed.createComponent(SignUpComponent);
    component = fixture.componentInstance;
    fixture.detectChanges();
  });

  it('should create', () => {
    expect(component).toBeTruthy();
  });
});



================================================
File: app/sign-up/sign-up.component.ts
================================================
import { Component, OnInit } from '@angular/core';
import { FormBuilder, FormGroup, Validators, ReactiveFormsModule, AbstractControl, ValidationErrors } from '@angular/forms';
import { Router, RouterModule } from '@angular/router';
import { CommonModule } from '@angular/common';
import Swal from 'sweetalert2';
import { AuthService, SignupRequest } from '../services/auth.service';

@Component({
  selector: 'app-sign-up',
  templateUrl: './sign-up.component.html',
  styleUrls: ['./sign-up.component.css'],
  standalone: true,
  imports: [CommonModule, ReactiveFormsModule, RouterModule]
})
export class SignUpComponent implements OnInit {
  signupForm!: FormGroup;
  submitted = false;
  showPassword = false;
  showConfirmPassword = false;
  isLoading = false;

  constructor(
    private formBuilder: FormBuilder,
    private router: Router,
    private authService: AuthService
  ) { }

  ngOnInit(): void {
    // Check if user is already logged in
    if (this.authService.isLoggedIn()) {
      this.router.navigate(['/home']);
      return;
    }
    
    this.signupForm = this.formBuilder.group({
      firstName: ['', [Validators.required, Validators.minLength(2)]],
      lastName: ['', [Validators.required, Validators.minLength(2)]],
      email: ['', [Validators.required, Validators.email]],
      countryCode: ['+20', Validators.required],
      phone: ['', [Validators.required, Validators.pattern('^[0-9]{10,11}$')]],
      city: ['', Validators.required],
      dob: ['', Validators.required],
      password: ['', [Validators.required, Validators.minLength(6)]],
      confirmPassword: ['', Validators.required],
      terms: [false, Validators.requiredTrue]
    }, {
      validators: this.passwordMatchValidator
    });
  }

  // Getter for easy access to form fields
  get f() { return this.signupForm.controls; }

  // Custom validator for password matching
  passwordMatchValidator(control: AbstractControl): ValidationErrors | null {
    const password = control.get('password');
    const confirmPassword = control.get('confirmPassword');

    if (password && confirmPassword && password.value !== confirmPassword.value) {
      confirmPassword.setErrors({ matching: true });
      return { matching: true };
    }
    return null;
  }

  onSubmit(): void {
    this.submitted = true;

    // Stop if form is invalid
    if (this.signupForm.invalid) {
      // Find and focus on the first invalid field
      const firstInvalidField = Object.keys(this.signupForm.controls).find(
        key => this.signupForm.get(key)?.invalid
      );
      
      if (firstInvalidField) {
        const element = document.getElementById(firstInvalidField);
        if (element) {
          element.focus();
          element.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      }
      return;
    }

    this.isLoading = true;
    this.signupForm.disable(); // ðŸ”¥ Disable form during submission

    // Prepare signup request according to API structure
    const formValues = this.signupForm.value;
    const signupRequest: SignupRequest = {
      firstName: formValues.firstName,
      lastName: formValues.lastName,
      email: formValues.email,
      phoneNumber: `${formValues.countryCode}${formValues.phone}`,
      city: formValues.city,
      birthOfDate: formValues.dob,
      password: formValues.password,
      confirmPassword: formValues.confirmPassword,
      isTermsAccepted: formValues.terms
    };

    // Call the signup API
    this.authService.signup(signupRequest).subscribe({
      next: (response) => {
        this.isLoading = false;
        this.signupForm.enable(); // ðŸ”¥ Re-enable form
        
        // Show success message and redirect to OTP verification
        Swal.fire({
          icon: 'success',
          title: 'Registration Successful',
          text: 'Account created successfully! Please check your email for the OTP verification code.',
          confirmButtonColor: '#08227B',
          confirmButtonText: 'Continue to Verification'
        }).then(() => {
          // Navigate to OTP verification page with the email
          this.router.navigate(['/otp-verification'], { 
            queryParams: { 
              email: formValues.email,
              type: 'signup'
            } 
          });
        });
      },
      error: (error) => {
        this.isLoading = false;
        this.signupForm.enable(); // ðŸ”¥ Re-enable form on error
        console.error('Signup error:', error);
        
        // Handle different types of errors
        let errorMessage = 'Registration failed. Please try again.';
        
        if (error.status === 400) {
          // Handle validation errors
          if (error.error && error.error.errors) {
            const validationErrors = error.error.errors;
            const errorMessages = [];
            
            // Extract validation error messages
            for (const field in validationErrors) {
              if (validationErrors[field] && Array.isArray(validationErrors[field])) {
                errorMessages.push(...validationErrors[field]);
              }
            }
            
            if (errorMessages.length > 0) {
              errorMessage = errorMessages.join('\n');
            }
          } else if (error.error && error.error.message) {
            errorMessage = error.error.message;
          }
        } else if (error.status === 409) {
          errorMessage = 'An account with this email already exists.';
        } else if (error.status === 0) {
          errorMessage = 'Unable to connect to server. Please check your internet connection.';
        }

        Swal.fire({
          icon: 'error',
          title: 'Registration Failed',
          text: errorMessage,
          confirmButtonColor: '#08227B'
        });
      }
    });
  }

  togglePasswordVisibility(): void {
    this.showPassword = !this.showPassword;
  }

  toggleConfirmPasswordVisibility(): void {
    this.showConfirmPassword = !this.showConfirmPassword;
  }

  signupWithGoogle(): void {
    // Google signup implementation will be added later
    Swal.fire({
      icon: 'info',
      title: 'Coming Soon',
      text: 'Google signup will be available in a future update.',
      confirmButtonColor: '#08227B'
    });
  }

  goToHome(): void {
    this.router.navigate(['/log-in']);
  }
}


================================================
File: assets/.gitkeep
================================================



================================================
File: assets/images/background.webp
================================================
[Non-text file]

