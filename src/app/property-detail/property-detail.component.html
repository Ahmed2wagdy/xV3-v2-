<!-- Property Detail Component HTML - Fixed disabled attributes -->
<div class="container py-4" *ngIf="!isLoading && property">
  <!-- Back Button -->
  <div class="mb-3">
    <button class="btn btn-outline-primary" (click)="goBack()">
      <i class="bi bi-arrow-left"></i> Back to Properties
    </button>
  </div>

  <!-- Property Header -->
  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-start mb-3">
        <div>
          <h1 class="property-title">{{ property.title }}</h1>
          <p class="text-muted mb-2">
            <i class="bi bi-geo-alt"></i> {{ property.street }}, {{ property.city }}, {{ property.governate }}
          </p>
          <div class="property-meta">
            <span class="badge bg-primary me-2">{{ property.propertyType }}</span>
            <span class="text-muted">Listed {{ formatDate(property.listedAt) }}</span>
          </div>
        </div>
        <div class="text-end">
          <h2 class="price-tag mb-3">{{ formatPrice(property.price) }}</h2>
          <button 
            class="btn" 
            [ngClass]="{
              'btn-danger': property.isFavorite,
              'btn-outline-danger': !property.isFavorite
            }"
            (click)="toggleFavorite()"
            [disabled]="isFavoriteLoading"
          >
            <span *ngIf="!isFavoriteLoading">
              <i class="bi" [ngClass]="{'bi-heart': !property.isFavorite, 'bi-heart-fill': property.isFavorite}"></i>
              {{ property.isFavorite ? 'Remove from Favorites' : 'Add to Favorites' }}
            </span>
            <span *ngIf="isFavoriteLoading">
              <span class="spinner-border spinner-border-sm me-2"></span>
              Updating...
            </span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Image Gallery - Carousel -->
  <div class="row mb-4">
    <div class="col-lg-8">
      <div class="image-gallery">
        <!-- Carousel -->
        <div *ngIf="property.propertyImages && property.propertyImages.length > 0; else noImages">
          <div id="propertyCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
              <div *ngFor="let image of property.propertyImages; let i = index" 
                   class="carousel-item" [class.active]="i === 0">
                <img [src]="image" class="d-block w-100" 
                     [alt]="property.title + ' - Image ' + (i + 1)"
                     (error)="onImageError($event)" loading="lazy">
              </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#propertyCarousel" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#propertyCarousel" data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Next</span>
            </button>
          </div>
        </div>
        
        <!-- No Images Template -->
        <ng-template #noImages>
          <div class="main-image-container">
            <img 
              src="assets/images/apartment.avif" 
              [alt]="property.title"
              class="main-image"
            >
            <div class="no-images-overlay">
              <p class="text-white">No images available</p>
            </div>
          </div>
        </ng-template>
      </div>
    </div>
    
    <!-- Property Info Sidebar -->
    <div class="col-lg-4">
      <div class="property-info-card">
        <h4>Property Details</h4>
        <div class="property-details">
          <div class="detail-row">
            <span class="detail-label">Size:</span>
            <span class="detail-value">{{ property.size }} m²</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Bedrooms:</span>
            <span class="detail-value">{{ property.bedrooms }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Bathrooms:</span>
            <span class="detail-value">{{ property.bathrooms }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Type:</span>
            <span class="detail-value">{{ property.propertyType }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">Listed:</span>
            <span class="detail-value">{{ formatDate(property.listedAt) }}</span>
          </div>
        </div>

        <!-- Owner Info -->
        <div class="owner-info mt-4">
          <h5>Owner Information</h5>
          <p class="mb-1">
            <strong>{{ property.ownerInfo.firstName }} {{ property.ownerInfo.lastName }}</strong>
          </p>
          <p class="mb-1">
            <i class="bi bi-envelope"></i> {{ property.ownerInfo.email }}
          </p>
          <p class="mb-3">
            <i class="bi bi-phone"></i> {{ property.ownerInfo.phoneNumber }}
          </p>
          <button class="btn btn-success w-100" (click)="contactOwner()">
            <i class="bi bi-whatsapp"></i> Contact via WhatsApp
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Property Description -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="description-section">
        <h3>Description</h3>
        <p>{{ property.description }}</p>
      </div>
    </div>
  </div>

  <!-- Amenities -->
  <div class="row mb-4" *ngIf="property.internalAmenities.length > 0 || property.externalAmenities.length > 0 || property.accessibilityAmenities.length > 0">
    <div class="col-12">
      <div class="amenities-section">
        <h3>Amenities</h3>
        <div class="row">
          <div class="col-md-4" *ngIf="property.internalAmenities.length > 0">
            <h5>Internal Amenities</h5>
            <ul class="amenities-list">
              <li *ngFor="let amenity of property.internalAmenities">
                <i class="bi bi-check-circle text-success"></i> {{ amenity }}
              </li>
            </ul>
          </div>
          <div class="col-md-4" *ngIf="property.externalAmenities.length > 0">
            <h5>External Amenities</h5>
            <ul class="amenities-list">
              <li *ngFor="let amenity of property.externalAmenities">
                <i class="bi bi-check-circle text-success"></i> {{ amenity }}
              </li>
            </ul>
          </div>
          <div class="col-md-4" *ngIf="property.accessibilityAmenities.length > 0">
            <h5>Accessibility Features</h5>
            <ul class="amenities-list">
              <li *ngFor="let amenity of property.accessibilityAmenities">
                <i class="bi bi-check-circle text-success"></i> {{ amenity }}
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Reviews Section -->
  <div class="row mt-5">
    <div class="col-12">
      <div class="reviews-section bg-white rounded-4 shadow-sm p-4">
        <h3 class="mb-4 pb-2 border-bottom border-2 border-primary-subtle">
          <i class="bi bi-chat-square-text-fill me-2 text-primary"></i>Customer Reviews
        </h3>
        
        <!-- Add Review Form -->
        <div class="add-review-card mb-5 p-4 bg-light rounded-4" *ngIf="isLoggedIn">
          <h5 class="mb-3 text-primary">
            <i class="bi bi-pencil-square me-2"></i>Share Your Experience
          </h5>
          <form [formGroup]="reviewForm" (ngSubmit)="submitReview()">
            <div class="mb-3">
              <label class="form-label fw-medium">Your Rating</label>
              <div class="star-rating d-flex">
                <div class="star-input">
                  <input type="radio" formControlName="rating" value="1" id="star1" class="d-none">
                  <label for="star1" class="star-label fs-3 mx-1">☆</label>
                  <input type="radio" formControlName="rating" value="2" id="star2" class="d-none">
                  <label for="star2" class="star-label fs-3 mx-1">☆</label>
                  <input type="radio" formControlName="rating" value="3" id="star3" class="d-none">
                  <label for="star3" class="star-label fs-3 mx-1">☆</label>
                  <input type="radio" formControlName="rating" value="4" id="star4" class="d-none">
                  <label for="star4" class="star-label fs-3 mx-1">☆</label>
                  <input type="radio" formControlName="rating" value="5" id="star5" class="d-none">
                  <label for="star5" class="star-label fs-3 mx-1">☆</label>
                </div>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label fw-medium">Your Comment</label>
              <textarea 
                class="form-control border-2 py-3 px-4" 
                formControlName="comment" 
                rows="3" 
                placeholder="Share your thoughts about this property..."
              ></textarea>
              <div *ngIf="reviewForm.get('comment')?.invalid && reviewForm.get('comment')?.touched" 
                   class="text-danger small mt-2">
                <i class="bi bi-exclamation-circle me-1"></i>Comment must be at least 10 characters
              </div>
            </div>
            <div class="d-flex justify-content-end">
              <button 
                type="submit" 
                class="btn btn-primary px-4 py-2 rounded-pill fw-medium"
                [disabled]="reviewForm.invalid || isSubmittingReview"
              >
                <span *ngIf="!isSubmittingReview">
                  <i class="bi bi-send me-2"></i>Post Review
                </span>
                <span *ngIf="isSubmittingReview">
                  <span class="spinner-border spinner-border-sm me-2"></span>
                  Submitting...
                </span>
              </button>
            </div>
          </form>
        </div>

        <!-- Login prompt for guests -->
        <div class="alert alert-info rounded-4 mb-4" *ngIf="!isLoggedIn">
          <div class="d-flex align-items-center">
            <i class="bi bi-info-circle-fill fs-5 me-3"></i>
            <div>
              Please <a [routerLink]="['/log-in']" class="alert-link fw-medium">log in</a> 
              to leave a review or add to favorites.
            </div>
          </div>
        </div>

        <!-- Reviews List -->
        <div class="reviews-list">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h5 class="mb-0">Customer Reviews ({{reviews.length}})</h5>
            <div class="dropdown">
              <button class="btn btn-outline-secondary dropdown-toggle rounded-pill" 
                      type="button" 
                      data-bs-toggle="dropdown">
                <i class="bi bi-filter me-2"></i>Sort by
              </button>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">Newest First</a></li>
                <li><a class="dropdown-item" href="#">Highest Rated</a></li>
                <li><a class="dropdown-item" href="#">Lowest Rated</a></li>
              </ul>
            </div>
          </div>
          
          <div class="review-card bg-white rounded-4 p-4 mb-4 shadow-sm" 
               *ngFor="let review of reviews">
            <div class="review-header mb-3">
              <div class="d-flex justify-content-between">
                <div class="reviewer-info d-flex align-items-center">
                  <div class="avatar bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3"
                       style="width: 40px; height: 40px;">
                    {{ review.userName?.charAt(0) || 'A' }}
                  </div>
                  <div>
                    <strong>{{ review.userName || 'Anonymous' }}</strong>
                    <div class="rating text-warning">
                      <span *ngFor="let star of getStarArray(review.rating)" class="star filled">★</span>
                      <span *ngFor="let star of getStarArray(5 - review.rating)" class="star">☆</span>
                    </div>
                  </div>
                </div>
                <small class="text-muted align-self-center">{{ formatDate(review.reviewDate || '') }}</small>
              </div>
            </div>
            <p class="review-comment text-secondary mb-0">
              {{ review.comment }}
            </p>
          </div>
          
          <div *ngIf="reviews.length === 0" class="no-reviews text-center py-5">
            <i class="bi bi-chat-left-quote fs-1 text-muted mb-3"></i>
            <p class="text-muted fs-5">No reviews yet. Be the first to review this property!</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading State -->
<div class="loading-container text-center py-5" *ngIf="isLoading">
  <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
  <p class="mt-3">Loading property details...</p>
</div>

  <!-- Reviews Section -->


      <!-- Login prompt for guests -->
      <div class="alert alert-info rounded-4 mb-4" *ngIf="!isLoggedIn">
        <div class="d-flex align-items-center">
          <i class="bi bi-info-circle-fill fs-5 me-3"></i>
          <div>
            Please <a [routerLink]="['/log-in']" class="alert-link fw-medium">log in</a> 
            to leave a review or add to favorites.
          </div>
        </div>
      </div>

      <!-- Reviews List -->
     

       
       
  


<!-- Loading State -->
<div class="loading-container text-center py-5" *ngIf="isLoading">
  <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
  <p class="mt-3">Loading property details...</p>
</div>